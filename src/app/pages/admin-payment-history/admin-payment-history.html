<div class="space-y-8">
  <!-- Header -->
  <div>
    <h1 class="text-3xl font-bold text-slate-100">Historial de Pagos</h1>
    <p class="mt-2 text-sm text-slate-400">Revisa todos los pagos procesados en la plataforma.</p>
  </div>

  <!-- Filters -->
  <div class="bg-slate-800/50 rounded-lg p-6">
    <form [formGroup]="filterForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">Estado del Pago</label>
        <select formControlName="status" (change)="onFilterChange()"
          class="w-full px-4 py-2 border border-slate-600 bg-slate-700 text-white rounded-lg focus:ring-2 focus:ring-lime-400">
          <option value="all">Todos</option>
          <option value="pending">Pendiente</option>
          <option value="processing">Procesando</option>
          <option value="completed">Completado</option>
          <option value="failed">Fallido</option>
          <option value="cancelled">Cancelado</option>
        </select>
      </div>
      <!-- Add more filters like instructor search if needed -->
    </form>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-lime-400"></div>
  </div>
  }

  <!-- Success Message -->
  @if (success()) {
  <div class="bg-green-500/10 border border-green-500/20 text-green-300 px-4 py-3 rounded-lg text-sm">
    {{ success() }}
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="bg-red-500/10 border border-red-500/20 text-red-300 px-4 py-3 rounded-lg text-sm">
    {{ error() }}
  </div>
  }

  <!-- Table -->
  @if (!isLoading() && payments().length > 0) {
  <div class="bg-slate-800/50 rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-700">
        <thead class="bg-slate-800">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">Instructor</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">Fecha de Creaci√≥n</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">Monto</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">M√©todo</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">Estado</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase">ID Transacci√≥n</th>
            <th class="px-6 py-3 text-right text-xs font-medium text-slate-400 uppercase">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-slate-800/50 divide-y divide-slate-700">
          @for (payment of payments(); track payment._id) {
          <tr class="hover:bg-slate-700/50 transition-colors">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <img [src]="getInstructorAvatar(payment.instructor)" [alt]="payment.instructor.name"
                  class="h-10 w-10 rounded-full object-cover border-2 border-slate-600">
                <div class="ml-4">
                  <div class="text-sm font-medium text-slate-200">{{payment.instructor.name}}
                    {{payment.instructor.surname}}</div>
                  <div class="text-sm text-slate-400">{{payment.instructor.email}}</div>
                </div>
              </div>
            </td>
            <td class="h-px w-px whitespace-nowrap px-6 py-3 text-sm text-slate-400">
              {{formatDate(payment.created_by_admin_at || payment.createdAt || '')}}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-lime-400">
              {{formatCurrency(payment.final_amount)}}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">{{payment.payment_method}}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                [class]="'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ' + getStatusBadgeClass(payment.status)">
                {{getStatusLabel(payment.status)}}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 font-mono">
              @if (payment.payment_method === 'paypal' && payment.payment_details?.paypal_transaction_id) {
              {{payment.payment_details.paypal_transaction_id}}
              } @else if (payment.payment_method === 'bank_transfer' && payment.payment_details?.transfer_reference) {
              {{payment.payment_details.transfer_reference}}
              } @else {
              N/A
              }
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              @if (payment.status === 'pending') {
              <button (click)="viewPaymentDetails(payment)"
                class="inline-flex items-center px-3 py-1.5 bg-sky-600 text-white text-xs font-medium rounded-lg hover:bg-sky-700 transition-colors">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                  </path>
                </svg>
                Ver Detalles
              </button>
              }
              @if (payment.status === 'processing') {
              <button (click)="openCompleteModal(payment._id)"
                class="inline-flex items-center px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded-lg hover:bg-green-700 transition-colors">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Completar
              </button>
              }
              @if (payment.status === 'completed') {
              <span class="text-xs text-slate-500">Finalizado</span>
              }
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    <!-- Pagination would go here -->
  </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && payments().length === 0) {
  <div class="bg-slate-800/50 rounded-lg p-12 text-center">
    <svg class="mx-auto h-12 w-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    <h3 class="mt-2 text-sm font-medium text-slate-200">No hay pagos</h3>
    <p class="mt-1 text-sm text-slate-400">No se encontraron pagos con los filtros aplicados.</p>
  </div>
  }

  <!-- Modal: Ver Detalles del Pago -->
  @if (showDetailsModal() && selectedPayment()) {
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <!-- Header -->
      <div class="sticky top-0 bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
        <h3 class="text-xl font-semibold text-slate-100">Detalles del Pago</h3>
        <button (click)="closeModals()" class="text-slate-400 hover:text-slate-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-6 space-y-6">
        <!-- Informaci√≥n del Instructor -->
        <div class="bg-slate-900/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-slate-300 mb-3">Instructor</h4>
          <div class="flex items-center gap-4">
            <img [src]="getInstructorAvatar(selectedPayment()?.instructor)" [alt]="selectedPayment()?.instructor?.name"
              class="h-12 w-12 rounded-full object-cover border-2 border-slate-600">
            <div>
              <div class="text-base font-medium text-slate-100">{{selectedPayment()?.instructor?.name}}
                {{selectedPayment()?.instructor?.surname}}</div>
              <div class="text-sm text-slate-400">{{selectedPayment()?.instructor?.email}}</div>
            </div>
          </div>
        </div>

        <!-- Montos -->
        <div class="bg-slate-900/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-slate-300 mb-3">Montos</h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-slate-400">Total Ganancias:</span>
              <span
                class="text-sm font-medium text-slate-100">{{formatCurrency(selectedPayment()?.total_earnings)}}</span>
            </div>
            @if (selectedPayment()?.platform_deductions > 0) {
            <div class="flex justify-between">
              <span class="text-sm text-slate-400">Deducciones:</span>
              <span
                class="text-sm font-medium text-red-400">-{{formatCurrency(selectedPayment()?.platform_deductions)}}</span>
            </div>
            }
            <div class="flex justify-between pt-2 border-t border-slate-700">
              <span class="text-base font-medium text-slate-200">Monto Final:</span>
              <span class="text-base font-bold text-lime-400">{{formatCurrency(selectedPayment()?.final_amount)}}</span>
            </div>
          </div>
        </div>

        <!-- M√©todo de Pago CON DATOS COMPLETOS DESENCRIPTADOS -->
        <div class="bg-slate-900/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5 text-lime-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
              </path>
            </svg>
            üîì Datos Bancarios Desencriptados
          </h4>

          @if (isLoadingPaymentMethod()) {
          <!-- Loading state -->
          <div class="flex flex-col items-center justify-center py-8 gap-3">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-lime-400"></div>
            <span class="text-sm text-slate-400">Desencriptando datos bancarios...</span>
          </div>
          } @else if (selectedPaymentMethod()) {
          <!-- DATOS BANCARIOS COMPLETOS -->
          <div class="space-y-4">

            <!-- Indicador de M√©todo Preferido -->
            @if (selectedPaymentMethod()?.preferredMethod) {
            <div class="bg-lime-500/10 border border-lime-500/30 rounded-lg p-3 flex items-center gap-2">
              <svg class="w-4 h-4 text-lime-400" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                </path>
              </svg>
              <span class="text-xs font-medium text-lime-300">‚≠ê M√©todo Preferido por el Instructor</span>
            </div>
            }

            <!-- Icono y T√≠tulo del M√©todo -->
            <div class="flex items-center gap-3">
              @if (selectedPaymentMethod()?.paymentMethod === 'paypal') {
              <div class="h-12 w-12 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg">
                <svg class="h-7 w-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 00-.794.68l-.04.22-.63 3.993-.028.15a.804.804 0 01-.794.68H7.722a.483.483 0 01-.477-.558L9.344 7.5h4.831c1.403 0 2.632.114 3.612.339 1.14.262 1.963.681 2.28 1.639z" />
                </svg>
              </div>
              } @else {
              <div class="h-12 w-12 bg-emerald-600 rounded-lg flex items-center justify-center shadow-lg">
                <svg class="h-7 w-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
              </div>
              }
              <div>
                <span
                  class="text-lg font-semibold text-slate-100">{{getPaymentMethodLabel(selectedPaymentMethod()?.paymentMethod
                  || 'other')}}</span>
                <div class="text-xs text-slate-400">Sistema de pago configurado</div>
              </div>
            </div>

            <!-- PAYPAL -->
            @if (selectedPaymentMethod()?.paymentMethod === 'paypal' && selectedPaymentMethod()?.paymentDetails) {
            <div class="bg-blue-900/20 border-2 border-blue-500/40 rounded-xl p-4 space-y-3">
              <div class="flex items-center gap-2 text-blue-300 text-sm font-medium mb-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Datos completos disponibles
              </div>

              <!-- Email PayPal -->
              <div class="bg-slate-800/70 rounded-lg p-4 border border-blue-500/20">
                <div class="text-xs text-slate-400 mb-2 flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                    </path>
                  </svg>
                  Email de PayPal
                </div>
                <div class="text-base font-mono font-bold text-blue-200 bg-blue-950/50 px-3 py-2 rounded-lg break-all">
                  {{selectedPaymentMethod()?.paymentDetails?.paypal_email || 'No disponible'}}
                </div>
                <button (click)="copyToClipboard(selectedPaymentMethod()?.paymentDetails?.paypal_email)"
                  class="mt-3 w-full px-3 py-2 bg-blue-600/80 hover:bg-blue-600 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                  </svg>
                  Copiar Email
                </button>
              </div>

              <!-- Merchant ID (si existe) -->
              @if (selectedPaymentMethod()?.paymentDetails?.paypal_merchant_id) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-blue-500/20">
                <div class="text-xs text-slate-400 mb-2">ID de Comerciante PayPal</div>
                <div class="text-sm font-mono text-blue-200 bg-blue-950/50 px-3 py-2 rounded-lg break-all">
                  {{selectedPaymentMethod()?.paymentDetails?.paypal_merchant_id}}
                </div>
              </div>
              }
            </div>
            }

            <!-- TRANSFERENCIA BANCARIA -->
            @if (selectedPaymentMethod()?.paymentMethod === 'bank_transfer' && selectedPaymentMethod()?.paymentDetails)
            {
            <div class="bg-emerald-900/20 border-2 border-emerald-500/40 rounded-xl p-4 space-y-3">
              <div class="flex items-center gap-2 text-emerald-300 text-sm font-medium mb-3">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Datos bancarios completos disponibles
              </div>

              <!-- Titular -->
              @if (selectedPaymentMethod()?.paymentDetails?.account_holder_name) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üë§ Titular de la Cuenta</div>
                <div class="text-base font-semibold text-emerald-200">
                  {{selectedPaymentMethod()?.paymentDetails?.account_holder_name}}
                </div>
              </div>
              }

              <!-- Banco -->
              @if (selectedPaymentMethod()?.paymentDetails?.bank_name) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üè¶ Nombre del Banco</div>
                <div class="text-base font-semibold text-emerald-200">
                  {{selectedPaymentMethod()?.paymentDetails?.bank_name}}
                </div>
              </div>
              }

              <!-- N√∫mero de Cuenta DESENCRIPTADO -->
              @if (selectedPaymentMethod()?.paymentDetails?.account_number) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2 flex items-center gap-1">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                  </svg>
                  üí≥ N√∫mero de Cuenta Completo
                </div>
                <div
                  class="text-lg font-mono font-bold text-emerald-100 bg-emerald-950/50 px-3 py-2 rounded-lg break-all">
                  {{selectedPaymentMethod()?.paymentDetails?.account_number}}
                </div>
                <button (click)="copyToClipboard(selectedPaymentMethod()?.paymentDetails?.account_number)"
                  class="mt-3 w-full px-3 py-2 bg-emerald-600/80 hover:bg-emerald-600 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                  </svg>
                  Copiar N√∫mero de Cuenta
                </button>
              </div>
              }

              <!-- CLABE DESENCRIPTADA -->
              @if (selectedPaymentMethod()?.paymentDetails?.clabe) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üî¢ CLABE Interbancaria</div>
                <div
                  class="text-base font-mono font-bold text-emerald-100 bg-emerald-950/50 px-3 py-2 rounded-lg break-all">
                  {{selectedPaymentMethod()?.paymentDetails?.clabe}}
                </div>
                <button (click)="copyToClipboard(selectedPaymentMethod()?.paymentDetails?.clabe)"
                  class="mt-3 w-full px-3 py-2 bg-emerald-600/80 hover:bg-emerald-600 text-white text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                  </svg>
                  Copiar CLABE
                </button>
              </div>
              }

              <!-- Tipo de Cuenta -->
              @if (selectedPaymentMethod()?.paymentDetails?.account_type) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üìÇ Tipo de Cuenta</div>
                <div class="text-sm font-medium text-emerald-200 capitalize">
                  {{selectedPaymentMethod()?.paymentDetails?.account_type}}
                </div>
              </div>
              }

              <!-- Marca de Tarjeta -->
              @if (selectedPaymentMethod()?.paymentDetails?.card_brand) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üíé Marca de Tarjeta</div>
                <div class="text-sm font-medium text-emerald-200">
                  {{selectedPaymentMethod()?.paymentDetails?.card_brand}}
                </div>
              </div>
              }

              <!-- C√≥digo SWIFT -->
              @if (selectedPaymentMethod()?.paymentDetails?.swift_code) {
              <div class="bg-slate-800/70 rounded-lg p-4 border border-emerald-500/20">
                <div class="text-xs text-slate-400 mb-2">üåç C√≥digo SWIFT/BIC</div>
                <div class="text-sm font-mono text-emerald-200 bg-emerald-950/50 px-3 py-2 rounded-lg">
                  {{selectedPaymentMethod()?.paymentDetails?.swift_code}}
                </div>
              </div>
              }
            </div>
            }

            <!-- Advertencia de Seguridad -->
            <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-3 flex items-start gap-2">
              <svg class="w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                </path>
              </svg>
              <div class="text-xs text-orange-300">
                <p class="font-medium">‚ö†Ô∏è Informaci√≥n Sensible</p>
                <p class="mt-1 text-orange-300/80">Estos datos son confidenciales y est√°n desencriptados temporalmente
                  para facilitar el procesamiento del pago.</p>
              </div>
            </div>
          </div>
          } @else {
          <!-- No hay datos disponibles -->
          <div class="text-center py-6">
            <svg class="mx-auto h-12 w-12 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="mt-2 text-sm text-slate-400">No hay datos de pago configurados</p>
          </div>
          }
        </div>

        <!-- Notas del Admin -->
        @if (selectedPayment()?.admin_notes) {
        <div class="bg-slate-900/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-slate-300 mb-2">Notas</h4>
          <p class="text-sm text-slate-400">{{selectedPayment()?.admin_notes}}</p>
        </div>
        }

        <!-- ID de Transacci√≥n y Comprobante -->
        @if (selectedPayment()?.payment_details?.paypal_transaction_id ||
        selectedPayment()?.payment_details?.transfer_reference || selectedPayment()?.payment_details?.transfer_receipt)
        {
        <div class="bg-slate-900/50 rounded-lg p-4">
          <h4 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
              </path>
            </svg>
            Informaci√≥n de la Transacci√≥n
          </h4>
          <div class="space-y-3">
            <!-- ID de Transacci√≥n PayPal -->
            @if (selectedPayment()?.payment_details?.paypal_transaction_id) {
            <div class="bg-slate-800/70 rounded-lg p-3 border border-sky-500/20">
              <div class="text-xs text-slate-400 mb-1">üé´ ID de Transacci√≥n PayPal</div>
              <div class="text-sm font-mono text-sky-200 bg-sky-950/30 px-3 py-2 rounded break-all">
                {{selectedPayment()?.payment_details?.paypal_transaction_id}}
              </div>
              <button (click)="copyToClipboard(selectedPayment()?.payment_details?.paypal_transaction_id)"
                class="mt-2 text-xs text-sky-400 hover:text-sky-300 flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                  </path>
                </svg>
                Copiar ID
              </button>
            </div>
            }

            <!-- Referencia Bancaria -->
            @if (selectedPayment()?.payment_details?.transfer_reference) {
            <div class="bg-slate-800/70 rounded-lg p-3 border border-emerald-500/20">
              <div class="text-xs text-slate-400 mb-1">üé´ Referencia de Transferencia</div>
              <div class="text-sm font-mono text-emerald-200 bg-emerald-950/30 px-3 py-2 rounded break-all">
                {{selectedPayment()?.payment_details?.transfer_reference}}
              </div>
              <button (click)="copyToClipboard(selectedPayment()?.payment_details?.transfer_reference)"
                class="mt-2 text-xs text-emerald-400 hover:text-emerald-300 flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                  </path>
                </svg>
                Copiar Referencia
              </button>
            </div>
            }

            <!-- Comprobante -->
            @if (selectedPayment()?.payment_details?.transfer_receipt) {
            <div class="bg-slate-800/70 rounded-lg p-3 border border-purple-500/20">
              <div class="text-xs text-slate-400 mb-2">üìé Comprobante de Pago</div>
              <a [href]="selectedPayment()?.payment_details?.transfer_receipt" target="_blank"
                class="inline-flex items-center gap-2 px-3 py-2 bg-purple-600/80 hover:bg-purple-600 text-white text-xs font-medium rounded-lg transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                </svg>
                Ver Comprobante
              </a>
            </div>
            }
          </div>
        </div>
        }
      </div>

      <!-- Footer con acci√≥n -->
      <div class="sticky bottom-0 bg-slate-800 border-t border-slate-700 px-6 py-4 flex gap-3">
        <button (click)="closeModals()"
          class="flex-1 px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 font-medium transition-colors">
          Cerrar
        </button>
        @if (selectedPayment()?.status === 'pending') {
        <button (click)="openProcessModalFromDetails()"
          class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
            </path>
          </svg>
          Procesar Pago
        </button>
        }
      </div>
    </div>
  </div>
  }

  <!-- Modal: Procesar Pago -->
  @if (showProcessModal()) {
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-slate-800 rounded-lg shadow-xl max-w-md w-full p-6 border border-slate-700">
      <h3 class="text-xl font-semibold text-slate-100 mb-4">Procesar Pago</h3>
      <p class="text-sm text-slate-400 mb-4">
        Marca este pago como "En Proceso" e ingresa el ID de transacci√≥n (opcional).
      </p>

      <form #processForm="ngForm" (ngSubmit)="processPayment(transactionId.value, receiptUrl.value)">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">
              ID de Transacci√≥n (Opcional)
            </label>
            <input #transactionId type="text"
              class="w-full px-4 py-2 border border-slate-600 bg-slate-700 text-white rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none"
              placeholder="TXN123456 o referencia bancaria" />
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">
              URL del Comprobante (Opcional)
            </label>
            <input #receiptUrl type="url"
              class="w-full px-4 py-2 border border-slate-600 bg-slate-700 text-white rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none"
              placeholder="https://..." />
          </div>
        </div>

        <div class="flex gap-3 mt-6">
          <button type="button" (click)="closeModals()" [disabled]="isProcessing()"
            class="flex-1 px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 font-medium transition-colors disabled:opacity-50">
            Cancelar
          </button>
          <button type="submit" [disabled]="isProcessing()"
            class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors disabled:opacity-50">
            @if (isProcessing()) {
            <span>Procesando...</span>
            } @else {
            <span>Procesar Pago</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Modal: Completar Pago -->
  @if (showCompleteModal()) {
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-slate-800 rounded-lg shadow-xl max-w-md w-full p-6 border border-slate-700">
      <div class="flex items-start mb-4">
        <div class="flex-shrink-0">
          <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
        <div class="ml-3 flex-1">
          <h3 class="text-lg font-medium text-slate-100">
            Completar Pago
          </h3>
          <div class="mt-2 text-sm text-slate-400">
            <p>¬øEst√°s seguro de que deseas marcar este pago como completado?</p>
            <p class="mt-2 font-medium text-slate-300">Esta acci√≥n indica que el instructor ya recibi√≥ el dinero.</p>
          </div>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button (click)="closeModals()" [disabled]="isProcessing()"
          class="flex-1 px-4 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 font-medium transition-colors disabled:opacity-50">
          Cancelar
        </button>
        <button (click)="completePayment()" [disabled]="isProcessing()"
          class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-colors disabled:opacity-50">
          @if (isProcessing()) {
          <span>Completando...</span>
          } @else {
          <span>Completar Pago</span>
          }
        </button>
      </div>
    </div>
  </div>
  }
</div>