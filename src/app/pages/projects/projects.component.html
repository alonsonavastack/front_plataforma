<div class="space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-bold text-white">Gestión de Proyectos</h2>
    <button
      (click)="openCreateModal()"
      class="h-10 px-5 rounded-xl bg-lime-400 text-slate-900 font-bold hover:bg-lime-300 transition"
    >
      Crear Proyecto
    </button>
  </div>

  <!-- Filters -->
  <div class="flex flex-col md:flex-row gap-4">
    <!-- Search -->
    <div class="flex-1">
      <input
        type="text"
        placeholder="Buscar proyectos..."
        (input)="onSearch($event)"
        [value]="searchTerm()"
        class="w-full border text-sm rounded-lg p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
      />
    </div>

    <!-- Category Filter -->
    <div class="w-full md:w-64">
      <select
        (change)="onCategoryFilter($event)"
        [value]="selectedCategory()"
        class="w-full border text-sm rounded-lg p-2.5 bg-slate-700 border-slate-600 text-white focus:ring-lime-500 focus:border-lime-500"
      >
        <option value="">Todas las categorías</option>
        @for (category of categories(); track category._id) {
          <option [value]="category._id">{{ category.title }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-lime-400"></div>
    </div>
  }

  <!-- Projects Grid -->
  @if (!isLoading() && projects().length > 0) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (project of projects(); track project._id) {
        <div class="rounded-lg shadow-md overflow-hidden border border-white/10 bg-slate-800/50 hover:bg-slate-700/50 transition-colors">
          <!-- Project Image -->
          <div class="h-48 bg-slate-900 overflow-hidden">
            @if (project.imagen) {
              <img
                [src]="buildImageUrl(project.imagen)"
                [alt]="project.title"
                class="w-full h-full object-cover"
              />
            } @else {
              <div class="w-full h-full flex items-center justify-center text-gray-600">
                <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
              </div>
            }
          </div>

          <!-- Project Content -->
          <div class="p-5">
            <!-- State Badge -->
            <div class="mb-3">
              <span [class]="'px-3 py-1 text-xs font-medium rounded-full ' + getStateBadgeClass(project.state)">
                {{ getStateText(project.state) }}
              </span>
            </div>

            <!-- Title -->
            <h3 class="text-xl font-semibold text-white mb-2 line-clamp-2">
              {{ project.title }}
            </h3>

            <!-- Subtitle -->
            <p class="text-sm text-gray-400 mb-3 line-clamp-2">
              {{ project.subtitle }}
            </p>

            <!-- Category -->
            <div class="flex items-center gap-2 mb-3">
              <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
              </svg>
              <span class="text-sm text-gray-400">{{ project.categorie.title }}</span>
            </div>

            <!-- Prices -->
            <div class="flex items-center gap-3 mb-4">
              <div class="text-lg font-bold text-lime-400">
                ${{ project.price_usd }}
              </div>
              <div class="text-sm font-bold text-gray-400">
                ${{ project.price_mxn }} MXN
              </div>
            </div>

            <!-- Instructor -->
            @if (project.user) {
              <div class="flex items-center gap-2 mb-4 pb-4 border-b border-slate-700">
                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span class="text-sm text-gray-400">{{ project.user.name }} {{ project.user.surname }}</span>
              </div>
            }

            <!-- Actions -->
            <div class="flex gap-2">
              <button
                (click)="openEditModal(project)"
                class="flex-1 px-4 py-2 rounded-lg font-medium text-sm text-lime-400 hover:bg-slate-900 transition-colors"
              >
                Editar
              </button>
              <button
                (click)="deleteProject(project)"
                class="flex-1 px-4 py-2 rounded-lg font-medium text-sm text-red-400 hover:bg-slate-900 transition-colors"
              >
                Eliminar
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && projects().length === 0) {
    <div class="text-center py-12 rounded-lg border border-white/10 bg-slate-800/50">
      <svg class="mx-auto h-24 w-24 text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
      </svg>
      <h3 class="text-xl font-semibold text-white mb-2">No hay proyectos</h3>
      <p class="text-gray-400 mb-6">Comienza creando tu primer proyecto</p>
      <button
        (click)="openCreateModal()"
        class="px-6 py-2 bg-lime-400 text-slate-900 rounded-lg hover:bg-lime-300 transition-colors font-medium"
      >
        Crear Proyecto
      </button>
    </div>
  }
</div>

<!-- Modal -->
@if (isModalOpen()) {
  <!-- Backdrop -->
  <div (click)="closeModal()" class="fixed inset-0 z-40 bg-gray-900/50 backdrop-blur-sm"></div>

  <!-- Modal -->
  <div class="fixed top-0 right-0 left-0 z-50 justify-center items-start w-full md:inset-0 h-modal md:h-full flex pt-8">
    <div class="relative p-4 w-full max-w-2xl max-h-[90vh]">
      <div class="relative rounded-lg shadow bg-slate-800 border border-white/10 flex flex-col h-full">
        <button
          (click)="closeModal()"
          type="button"
          class="absolute top-3 right-2.5 text-gray-400 bg-transparent rounded-lg text-sm p-1.5 ml-auto inline-flex items-center hover:bg-gray-600 hover:text-white"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
          <span class="sr-only">Cerrar modal</span>
        </button>

        <!-- Modal Header -->
        <div class="py-6 px-6 lg:px-8 border-b border-slate-700">
          <h3 class="text-xl font-medium text-white">
            {{ isEditing() ? 'Editar Proyecto' : 'Nuevo Proyecto' }}
          </h3>
        </div>

        <!-- Modal Body -->
        <div class="flex-grow overflow-y-auto p-6 lg:p-8">
          <form id="project-form" [formGroup]="projectForm" (ngSubmit)="saveProject()" class="space-y-6">
            <!-- Title -->
            <div>
              <label for="title" class="block mb-2 text-sm font-medium text-gray-300">
                Título <span class="text-red-400">*</span>
              </label>
              <input
                type="text"
                id="title"
                formControlName="title"
                class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
                placeholder="Nombre del proyecto"
              />
              @if (projectForm.get('title')?.invalid && projectForm.get('title')?.touched) {
                <div class="text-red-400 text-sm mt-1">
                  El título es requerido
                </div>
              }
            </div>

            <!-- Subtitle -->
            <div>
              <label for="subtitle" class="block mb-2 text-sm font-medium text-gray-300">
                Subtítulo <span class="text-red-400">*</span>
              </label>
              <input
                type="text"
                id="subtitle"
                formControlName="subtitle"
                class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
                placeholder="Breve descripción del proyecto"
              />
              @if (projectForm.get('subtitle')?.invalid && projectForm.get('subtitle')?.touched) {
                <div class="text-red-400 text-sm mt-1">
                  El subtítulo es requerido
                </div>
              }
            </div>

            <!-- Description -->
            <div>
              <label for="description" class="block mb-2 text-sm font-medium text-gray-300">
                Descripción <span class="text-red-400">*</span>
              </label>
              <textarea
                id="description"
                formControlName="description"
                rows="4"
                class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500 resize-none"
                placeholder="Describe tu proyecto en detalle"
              ></textarea>
              @if (projectForm.get('description')?.invalid && projectForm.get('description')?.touched) {
                <div class="text-red-400 text-sm mt-1">
                  La descripción es requerida
                </div>
              }
            </div>

            <!-- Category and State -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="categorie" class="block mb-2 text-sm font-medium text-gray-300">
                  Categoría <span class="text-red-400">*</span>
                </label>
                <select
                  id="categorie"
                  formControlName="categorie"
                  class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 text-white focus:ring-lime-500 focus:border-lime-500"
                >
                  <option value="">Selecciona una categoría</option>
                  @for (category of categories(); track category._id) {
                    <option [value]="category._id">{{ category.title }}</option>
                  }
                </select>
                @if (projectForm.get('categorie')?.invalid && projectForm.get('categorie')?.touched) {
                  <div class="text-red-400 text-sm mt-1">
                    La categoría es requerida
                  </div>
                }
              </div>

              <div>
                <label for="state" class="block mb-2 text-sm font-medium text-gray-300">
                  Estado <span class="text-red-400">*</span>
                </label>
                <select
                  id="state"
                  formControlName="state"
                  class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 text-white focus:ring-lime-500 focus:border-lime-500"
                >
                  <option [value]="1">Borrador</option>
                  <option [value]="2">Público</option>
                  <option [value]="3">Anulado</option>
                </select>
              </div>
            </div>

            <!-- Prices -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="price_usd" class="block mb-2 text-sm font-medium text-gray-300">
                  Precio USD <span class="text-red-400">*</span>
                </label>
                <input
                  type="number"
                  id="price_usd"
                  formControlName="price_usd"
                  min="0"
                  step="0.01"
                  class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
                  placeholder="0.00"
                />
              </div>
              <div>
                <label for="price_mxn" class="block mb-2 text-sm font-medium text-gray-300">
                  Precio MXN <span class="text-red-400">*</span>
                </label>
                <input
                  type="number"
                  id="price_mxn"
                  formControlName="price_mxn"
                  min="0"
                  step="0.01"
                  class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
                  placeholder="0.00"
                />
              </div>
            </div>

            <!-- Video URL -->
            <div>
              <label for="url_video" class="block mb-2 text-sm font-medium text-gray-300">
                URL del Video (Opcional)
              </label>
              <input
                type="url"
                id="url_video"
                formControlName="url_video"
                class="border text-sm rounded-lg block w-full p-2.5 bg-slate-700 border-slate-600 placeholder-gray-400 text-white focus:ring-lime-500 focus:border-lime-500"
                placeholder="https://youtube.com/watch?v=..."
              />
            </div>

            <!-- Image Upload -->
            <div>
              <label for="portada" class="block mb-2 text-sm font-medium text-gray-300">
                Imagen de portada
              </label>
              <input
                type="file"
                id="portada"
                accept="image/*"
                (change)="onImageChange($event)"
                class="block w-full text-sm border rounded-lg cursor-pointer text-gray-400 focus:outline-none bg-slate-700 border-slate-600 placeholder-gray-400"
              />
              @if (imagePreview()) {
                <div class="mt-4">
                  <img [src]="imagePreview()" alt="Preview" class="w-full h-40 object-cover rounded-lg" />
                </div>
              }
            </div>
          </form>
        </div>

        <!-- Modal Footer -->
        <div class="p-6 border-t border-slate-700">
          <button
            type="submit"
            form="project-form"
            [disabled]="isLoading()"
            class="w-full text-slate-900 bg-lime-400 hover:bg-lime-500 focus:ring-4 focus:outline-none focus:ring-lime-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center disabled:bg-slate-600 disabled:cursor-not-allowed"
          >
            {{ isLoading() ? 'Guardando...' : (isEditing() ? 'Guardar Cambios' : 'Crear Proyecto') }}
          </button>
        </div>
      </div>
    </div>
  </div>
}
