import{b as R}from"./chunk-W4HGVXKG.js";import{c as M,e as S}from"./chunk-UKUKXRH6.js";import"./chunk-TCGJFX72.js";import{w as V}from"./chunk-SDJWNAN2.js";import"./chunk-ESTJS734.js";import{$ as f,Eb as x,Gb as r,Hb as b,Ib as w,Jb as _,Ma as a,Ta as E,Xa as y,_ as p,ec as h,hb as m,ib as u,ja as d,rb as i,sb as s,tb as c,vb as C,xb as v,yb as g}from"./chunk-6JS7X5LE.js";import"./chunk-I4MTPUBM.js";function D(o,n){if(o&1&&(i(0,"p",9),r(1),s()),o&2){let t=g();a(),w(" \u{1F4F1} ",t.maskedPhone()," ")}}function O(o,n){if(o&1&&(i(0,"div",10)(1,"p",28),p(),i(2,"svg",29),c(3,"path",30),s(),f(),i(4,"span"),r(5),s()()()),o&2){let t=g();a(5),b(t.errorMessage())}}function k(o,n){if(o&1&&(i(0,"div",11)(1,"p",31),p(),i(2,"svg",29),c(3,"path",32),s(),f(),i(4,"span"),r(5),s()()()),o&2){let t=g();a(5),b(t.successMessage())}}function N(o,n){if(o&1&&(i(0,"p",15),r(1),s()),o&2){let t=g();a(),_(" \u26A0\uFE0F Te quedan ",t.attemptsRemaining()," ",t.attemptsRemaining()===1?"intento":"intentos"," ")}}function F(o,n){if(o&1&&(i(0,"div",16)(1,"p",33),p(),i(2,"svg",34),c(3,"path",35),s(),f(),i(4,"span"),r(5,"Expira en: "),i(6,"strong",36),r(7),s()()()()),o&2){let t=g();a(7),b(t.timeRemaining())}}function L(o,n){o&1&&(i(0,"div",16)(1,"p",37),r(2," \u23F0 El c\xF3digo ha expirado "),s()())}function z(o,n){o&1&&(i(0,"span",18),p(),i(1,"svg",38),c(2,"circle",39)(3,"path",40),s(),f(),i(4,"span"),r(5,"Verificando..."),s()())}function P(o,n){o&1&&(i(0,"span"),r(1,"Verificar C\xF3digo"),s())}function H(o,n){o&1&&(i(0,"span",18),p(),i(1,"svg",38),c(2,"circle",39)(3,"path",40),s(),f(),i(4,"span"),r(5,"Reenviando..."),s()())}function j(o,n){if(o&1&&(i(0,"span"),r(1),s()),o&2){let t=g();a(),w("Reenviar en ",t.resendTimeRemaining())}}function A(o,n){o&1&&(p(),i(0,"svg",41),c(1,"path",42),s())}function $(o,n){if(o&1&&(i(0,"span",18),m(1,A,2,0,":svg:svg",41),i(2,"span"),r(3,"Reenviar C\xF3digo"),s()()),o&2){let t,e=g();a(),u(e.canResend()&&((t=e.errorMessage())!=null&&t.includes("inicial"))?1:-1)}}var I=class o{constructor(n,t,e){this.authService=n;this.router=t;this.route=e}otpCode=d("");userId=d(null);phone=d(null);isVerifying=d(!1);isResending=d(!1);canResend=d(!1);countdown=d(600);resendCountdown=d(0);errorMessage=d(null);successMessage=d(null);attemptsRemaining=d(3);countdownInterval;resendInterval;timeRemaining=h(()=>{let n=this.countdown(),t=Math.floor(n/60),e=n%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`});resendTimeRemaining=h(()=>`${this.resendCountdown()}s`);maskedPhone=h(()=>{let n=this.phone();if(!n||n.length<10)return n;let t=n.substring(0,2),e=n.substring(2,5),l=n.substring(n.length-4);return`+${t} ${e} XXXX ${l}`});isCodeValid=h(()=>{let n=this.otpCode();return n.length===6&&/^\d+$/.test(n)});ngOnInit(){this.route.queryParams.subscribe(n=>{let t=n.userId,e=n.phone,l=n.error;if(!t){this.router.navigate(["/register"]);return}this.userId.set(t),this.phone.set(e||null),l==="otp_not_sent"&&(this.errorMessage.set('\u26A0\uFE0F No se pudo enviar el c\xF3digo inicial. Por favor, haz clic en "Reenviar C\xF3digo".'),this.canResend.set(!0))}),this.startExpirationCountdown()}ngOnDestroy(){this.clearTimers()}startExpirationCountdown(){this.clearTimers(),this.countdownInterval=setInterval(()=>{let n=this.countdown();n>0?this.countdown.set(n-1):(this.clearTimers(),this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."))},1e3)}startResendCountdown(){this.resendInterval&&clearInterval(this.resendInterval),this.canResend.set(!1),this.resendCountdown.set(60),this.resendInterval=setInterval(()=>{let n=this.resendCountdown();n>1?this.resendCountdown.set(n-1):(clearInterval(this.resendInterval),this.resendCountdown.set(0),this.canResend.set(!0))},1e3)}clearTimers(){this.countdownInterval&&clearInterval(this.countdownInterval),this.resendInterval&&clearInterval(this.resendInterval)}onOtpInput(n){let e=n.target.value.replace(/\D/g,"");e.length>6&&(e=e.substring(0,6)),this.otpCode.set(e),this.errorMessage.set(null)}verifyCode(){if(!this.isCodeValid()){this.errorMessage.set("Por favor, ingresa un c\xF3digo de 6 d\xEDgitos");return}let n=this.userId();if(!n){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isVerifying.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.verifyOtp(n,this.otpCode()).subscribe({next:t=>{this.successMessage.set(t.message||"\xA1Cuenta verificada exitosamente!"),this.clearTimers(),setTimeout(()=>{},2e3)},error:t=>{this.isVerifying.set(!1),t.status===400?(this.errorMessage.set(t.error.message_text||"C\xF3digo incorrecto"),t.error.attemptsRemaining!==void 0&&(this.attemptsRemaining.set(t.error.attemptsRemaining),t.error.attemptsRemaining===0&&this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."))):t.status===403?(this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."),this.attemptsRemaining.set(0)):t.status===410?(this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."),this.clearTimers()):this.errorMessage.set(t.error?.message_text||"Ocurri\xF3 un error. Int\xE9ntalo de nuevo."),this.otpCode.set("")},complete:()=>{this.isVerifying.set(!1)}})}resendCode(){if(!this.canResend()&&this.resendCountdown()>0){this.errorMessage.set(`Debes esperar ${this.resendCountdown()} segundos antes de reenviar`);return}let n=this.userId();if(!n){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isResending.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.resendOtp(n).subscribe({next:t=>{this.successMessage.set(t.message||"C\xF3digo reenviado exitosamente"),this.countdown.set(600),this.startExpirationCountdown(),this.startResendCountdown(),this.attemptsRemaining.set(3),this.otpCode.set("")},error:t=>{t.status===429?t.error.waitSeconds?(this.errorMessage.set(t.error.message_text),this.resendCountdown.set(t.error.waitSeconds),this.startResendCountdown()):this.errorMessage.set(t.error.message_text||"Has alcanzado el l\xEDmite de reenv\xEDos"):this.errorMessage.set(t.error?.message_text||"Error al reenviar el c\xF3digo")},complete:()=>{this.isResending.set(!1)}})}goToRegister(){this.clearTimers(),this.router.navigate(["/register"])}static \u0275fac=function(t){return new(t||o)(E(R),E(S),E(M))};static \u0275cmp=y({type:o,selectors:[["app-verify-otp"]],decls:40,vars:41,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","py-8","sm:py-12","px-4"],[1,"w-full","max-w-md","mx-auto"],[1,"bg-slate-800","border","border-white/10","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"w-16","h-16","bg-lime-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-lime-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-300","text-sm"],[1,"text-lime-400","font-mono","text-sm","mt-2"],[1,"mb-4","p-4","bg-red-500/10","border","border-red-500/30","rounded-lg"],[1,"mb-4","p-4","bg-lime-500/10","border","border-lime-500/30","rounded-lg"],[1,"mb-6"],[1,"block","text-slate-300","text-sm","font-medium","mb-3"],["type","text","inputmode","numeric","maxlength","6","placeholder","000000","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","rounded-lg","text-white","text-center","text-2xl","font-mono","tracking-widest","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:border-transparent","transition-all",3,"input","value","disabled"],[1,"text-yellow-400","text-xs","mt-2","text-center"],[1,"mb-6","text-center"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"relative","my-6"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-slate-700"],[1,"relative","flex","justify-center","text-sm"],[1,"px-2","bg-slate-800","text-slate-400"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","border-2","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mt-6","text-center"],["type","button",1,"text-slate-400","hover:text-white","text-sm","transition-colors",3,"click"],[1,"text-slate-500","text-xs"],[1,"text-red-400","text-sm","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-lime-400","text-sm","flex","items-center","gap-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-slate-400","text-sm","flex","items-center","justify-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-white","font-mono"],[1,"text-red-400","text-sm","font-medium"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"]],template:function(t,e){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(),i(5,"svg",5),c(6,"path",6),s()(),f(),i(7,"h1",7),r(8,"Verificaci\xF3n de Cuenta"),s(),i(9,"p",8),r(10," Ingresa el c\xF3digo de 6 d\xEDgitos enviado a tu Telegram "),s(),m(11,D,2,1,"p",9),s(),m(12,O,6,1,"div",10),m(13,k,6,1,"div",11),i(14,"div",12)(15,"label",13),r(16," C\xF3digo de Verificaci\xF3n "),s(),i(17,"input",14),v("input",function(T){return e.onOtpInput(T)}),s(),m(18,N,2,2,"p",15),s(),m(19,F,8,1,"div",16)(20,L,3,0,"div",16),i(21,"button",17),v("click",function(){return e.verifyCode()}),m(22,z,6,0,"span",18)(23,P,2,0,"span"),s(),i(24,"div",19)(25,"div",20),c(26,"div",21),s(),i(27,"div",22)(28,"span",23),r(29,"\xBFNo recibiste el c\xF3digo?"),s()()(),i(30,"button",24),v("click",function(){return e.resendCode()}),m(31,H,6,0,"span",18)(32,j,2,1,"span")(33,$,4,1,"span",18),s(),i(34,"div",25)(35,"button",26),v("click",function(){return e.goToRegister()}),r(36," \u2190 Volver al registro "),s()()(),i(37,"div",25)(38,"p",27),r(39," Si no recibes el c\xF3digo, verifica que tu Telegram est\xE9 activo "),s()()()()),t&2){let l;a(11),u(e.maskedPhone()?11:-1),a(),u(e.errorMessage()?12:-1),a(),u(e.successMessage()?13:-1),a(4),x("border-slate-700",!e.errorMessage())("border-red-500",e.errorMessage()),C("value",e.otpCode())("disabled",e.isVerifying()||e.countdown()===0),a(),u(e.attemptsRemaining()<3&&e.attemptsRemaining()>0?18:-1),a(),u(e.countdown()>0?19:20),a(2),x("bg-lime-500",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("hover:bg-lime-600",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("text-slate-900",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("bg-slate-700",!e.isCodeValid()||e.isVerifying()||e.countdown()===0)("text-slate-400",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),C("disabled",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),a(),u(e.isVerifying()?22:23),a(8),x("border-cyan-500",e.canResend()||e.resendCountdown()===0)("text-cyan-400",e.canResend()||e.resendCountdown()===0)("hover:bg-cyan-500/10",e.canResend()||e.resendCountdown()===0)("focus:ring-cyan-400",e.canResend()||e.resendCountdown()===0)("border-slate-700",!e.canResend()&&e.resendCountdown()>0)("text-slate-500",!e.canResend()&&e.resendCountdown()>0)("focus:ring-slate-400",!e.canResend()&&e.resendCountdown()>0)("animate-pulse",e.canResend()&&((l=e.errorMessage())==null?null:l.includes("inicial"))),C("disabled",e.isResending()||!e.canResend()&&e.resendCountdown()>0),a(),u(e.isResending()?31:!e.canResend()&&e.resendCountdown()>0?32:33)}},dependencies:[V],encapsulation:2})};export{I as VerifyOtpComponent};
