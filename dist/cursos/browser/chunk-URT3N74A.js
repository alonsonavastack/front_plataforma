import{b as P}from"./chunk-VTEZJ5OF.js";import{a as s}from"./chunk-XM5I3GUE.js";import{Gc as _,Jc as h,O as f,T as m,ec as u,fc as p,ja as v,n as y,o as g}from"./chunk-6JS7X5LE.js";import{a as b}from"./chunk-I4MTPUBM.js";var D=class l{http=m(h);API_URL=`${s.url}checkout`;configReloadTrigger=v(0);paymentConfigResource=p({loader:()=>(this.configReloadTrigger(),g(this.http.get(`${s.url}payment-settings/public`)))});countriesResource=p({loader:()=>(this.configReloadTrigger(),g(this.http.get(`${s.url}system-config/supported-countries`)))});paymentConfig=u(()=>this.paymentConfigResource.value()?.settings??null);supportedCountries=u(()=>this.countriesResource.value()?.countries??[]);isLoadingConfig=u(()=>this.paymentConfigResource.isLoading()||this.countriesResource.isLoading());availablePaymentMethods=u(()=>{let t=this.paymentConfig();if(!t){let e=[{id:"wallet",name:"Billetera Digital",icon:"\u{1F4B0}",description:"Usa tu saldo disponible de forma instant\xE1nea"}];return s.paypal&&s.paypal.clientId&&e.push({id:"paypal",name:"PayPal",icon:"\u{1F17F}\uFE0F",description:"Paga de forma segura con PayPal"}),e}return[{id:"wallet",name:"Billetera Digital",icon:"\u{1F4B0}",description:"Usa tu saldo disponible de forma instant\xE1nea"},{id:"paypal",name:"PayPal",icon:"\u{1F17F}\uFE0F",description:"Paga de forma segura con PayPal"}].filter(e=>e.id==="wallet"?!0:e.id==="paypal"?t.paypal?.active===!0||!!(s.paypal&&s.paypal.clientId):!1)});processSale(t){return this.http.post(`${this.API_URL}/register`,t)}processWalletPayment(t){return t.method_payment="wallet",this.processSale(t)}generateTransactionNumber(){let t=Date.now(),r=Math.random().toString(36).substring(2,10).toUpperCase();return`TXN-${t}-${r}`}getExchangeRate(){return 3.66}reloadConfig(){this.configReloadTrigger.update(t=>t+1)}async createPaypalOrder(t,r){let e=r||{n_transaccion:t},i=await g(this.http.post(`${this.API_URL}/paypal/create`,e));return{orderId:i.orderId,links:i.links}}async capturePaypalOrder(t,r,e){let i=Object.assign({n_transaccion:t,orderId:r},e||{});return await g(this.http.post(`${this.API_URL}/paypal/capture`,i))}static \u0275fac=function(r){return new(r||l)};static \u0275prov=f({token:l,factory:l.\u0275fac,providedIn:"root"})};var R=class l{http=m(h);authService=m(P);API_URL=`${s.url}profile-student`;profileResource=p({loader:async()=>{if(!this.authService.token())return null;let r=Date.now();return await y(this.http.get(`${this.API_URL}/client?_=${r}`))}});refundsResource=p({loader:async()=>{if(!this.authService.token())return[];let r=Date.now();return await y(this.http.get(`${s.url}refunds/list?_=${r}`))}});profileData=u(()=>{let t=this.profileResource.value(),r=this.refundsResource.value();if(!t)return null;if(!r||r.length===0)return t;let e=b({},t);if(e.enrolled_courses?.length>0){let i=new Map;r.forEach(n=>{if(n.status==="completed"&&n.course){let o=typeof n.course=="string"?n.course:n.course._id,a=new Date(n.completedAt||n.createdAt);o&&i.set(o,a)}}),e.enrolled_courses=e.enrolled_courses.filter(n=>{let o=n.course._id,a=new Date(n.createdAt);if(!i.has(o))return!0;let c=i.get(o);return a>c}),e.enrolled_course_count=e.enrolled_courses.length,e.actived_course_count=e.enrolled_courses.filter(n=>n.state===1).length,e.termined_course_count=e.enrolled_courses.filter(n=>n.state===2).length}if(e.projects?.length>0){let i=new Map;r.forEach(o=>{if(o.status==="completed"&&o.project){let a=typeof o.project=="string"?o.project:o.project._id,c=new Date(o.completedAt||o.createdAt);a&&i.set(a,c)}});let n=new Map;e.sales?.forEach(o=>{o.detail?.forEach(a=>{if(a.product_type==="project"){let c=typeof a.product=="string"?a.product:a.product?._id,d=new Date(o.createdAt);c&&(!n.has(c)||d>n.get(c))&&n.set(c,d)}})}),e.projects=e.projects.filter(o=>{let a=o._id;if(!i.has(a))return!0;let c=i.get(a),d=n.get(a);return d&&d>c})}return e});isLoading=u(()=>this.profileResource.isLoading()||this.refundsResource.isLoading());refunds=u(()=>this.refundsResource.value()||[]);reloadProfile(){this.profileResource.reload(),this.refundsResource.reload()}loadProfile(){return this.http.get(`${this.API_URL}/client?_=${Date.now()}`)}loadTransactions(){return this.http.get(`${this.API_URL}/transactions`)}requestRefund(t,r){let e=new _({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}),i={sale_id:t,product_id:r.product_id,product_type:r.product_type,reason_type:r.reason_type,reason_description:r.reason_description};return this.http.post(`${this.API_URL}/request-refund`,i,{headers:e})}uploadVoucher(t,r){let e=new FormData;return e.append("sale_id",t),e.append("imagen",r),this.http.post(`${this.API_URL}/upload-voucher`,e)}loadRefunds(){return this.http.get(`${s.url}refunds/list`)}deleteAccount(t){let r=new _({Authorization:`Bearer ${localStorage.getItem("token")}`});return this.http.delete(`${s.url}users/delete-my-account`,{headers:r,body:{password:t}})}static \u0275fac=function(r){return new(r||l)};static \u0275prov=f({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a,R as b};
