import{a as q}from"./chunk-AQ5EL62J.js";import{a as T,c as A,d as N}from"./chunk-R5HHEV5R.js";import{a as M}from"./chunk-TCGJFX72.js";import{a as O,b as U,c as L,d as G,e as P,j,k as $,n as z,o as B,v as H,x as R}from"./chunk-SDJWNAN2.js";import{a as V}from"./chunk-ESTJS734.js";import{$ as E,Gb as l,Ha as D,Hb as h,Ib as I,K as w,Ma as s,T as C,Xa as k,Y as c,Z as u,_ as S,hb as g,ib as _,ja as b,lb as y,mb as F,nb as f,ob as t,pb as i,qb as x,ub as v,wb as m,yb as d}from"./chunk-6JS7X5LE.js";var K=(a,n)=>n._id;function Q(a,n){a&1&&(t(0,"div",5),l(1,"Cargando im\xE1genes..."),i())}function W(a,n){a&1&&(t(0,"div",6)(1,"p",3),l(2,"No hay im\xE1genes en el carrusel."),i(),t(3,"p",9),l(4,'Haz clic en "A\xF1adir Imagen" para empezar.'),i()())}function X(a,n){if(a&1&&(t(0,"div",24),l(1),i()),a&2){let e=d().$implicit;s(),h(e.subtitle)}}function Y(a,n){a&1&&(t(0,"span",25),l(1,"Activo"),i())}function Z(a,n){a&1&&(t(0,"span",26),l(1,"Inactivo"),i())}function ee(a,n){if(a&1){let e=v();t(0,"tr",15)(1,"td",16)(2,"div",17),S(),t(3,"svg",18),x(4,"path",19),i(),E(),t(5,"span"),l(6),i()()(),t(7,"td",20),x(8,"img",21),i(),t(9,"td",22)(10,"div",23),l(11),i(),g(12,X,2,1,"div",24),i(),t(13,"td",22),g(14,Y,2,0,"span",25)(15,Z,2,0,"span",26),i(),t(16,"td",27)(17,"button",28),m("click",function(){let r=c(e).$implicit,p=d(2);return u(p.openEditModal(r))}),l(18,"Editar"),i(),t(19,"button",29),m("click",function(){let r=c(e).$implicit,p=d(2);return u(p.openDeleteModal(r))}),l(20,"Eliminar"),i()()()}if(a&2){let e=n.$implicit,o=d(2);f("cdkDragData",e),s(6),h(e.order),s(2),f("src",o.imagesUrl+e.imageUrl,D)("alt",e.title),s(3),h(e.title),s(),_(e.subtitle?12:-1),s(2),_(e.isActive?14:15)}}function te(a,n){if(a&1){let e=v();t(0,"div",7)(1,"table",10)(2,"thead",11)(3,"tr")(4,"th",12),l(5,"Orden"),i(),t(6,"th",12),l(7,"Imagen"),i(),t(8,"th",12),l(9,"T\xEDtulo"),i(),t(10,"th",12),l(11,"Estado"),i(),t(12,"th",13),l(13,"Acciones"),i()()(),t(14,"tbody",14),m("cdkDropListDropped",function(r){c(e);let p=d();return u(p.drop(r))}),y(15,ee,21,7,"tr",15,K),i()()()}if(a&2){let e=d();s(15),F(e.images())}}function ie(a,n){if(a&1&&x(0,"img",44),a&2){let e=d(2);f("src",e.imagePreview(),D)}}function ne(a,n){a&1&&l(0," Guardando... ")}function re(a,n){a&1&&l(0," Guardar Cambios ")}function le(a,n){if(a&1){let e=v();t(0,"div",30),m("click",function(){c(e);let r=d();return u(r.closeModal())}),t(1,"div",31),m("click",function(r){return c(e),u(r.stopPropagation())}),t(2,"form",32),m("ngSubmit",function(){c(e);let r=d();return u(r.saveImage())}),t(3,"div",33)(4,"h3",34),l(5),i()(),t(6,"div",35)(7,"div")(8,"label",36),l(9,"T\xEDtulo"),i(),x(10,"input",37),i(),t(11,"div")(12,"label",38),l(13,"Subt\xEDtulo (opcional)"),i(),x(14,"input",39),i(),t(15,"div")(16,"label",40),l(17,"URL de Enlace (opcional)"),i(),x(18,"input",41),i(),t(19,"div")(20,"label",42),l(21,"Imagen"),i(),t(22,"input",43),m("change",function(r){c(e);let p=d();return u(p.onFileChange(r))}),i(),g(23,ie,1,1,"img",44),i(),t(24,"div",45)(25,"div")(26,"label",46),l(27,"Orden"),i(),x(28,"input",47),i(),t(29,"div",48)(30,"label",49),x(31,"input",50),t(32,"span",51),l(33,"Activo"),i()()()()(),t(34,"div",52)(35,"button",53),m("click",function(){c(e);let r=d();return u(r.closeModal())}),l(36,"Cancelar"),i(),t(37,"button",54),g(38,ne,1,0)(39,re,1,0),i()()()()()}if(a&2){let e=d();s(2),f("formGroup",e.imageForm),s(3),h(e.currentImage()?"Editar Imagen":"A\xF1adir Nueva Imagen"),s(18),_(e.imagePreview()?23:-1),s(14),f("disabled",e.imageForm.invalid||e.isSaving()),s(),_(e.isSaving()?38:39)}}function ae(a,n){if(a&1){let e=v();t(0,"div",30),m("click",function(){c(e);let r=d();return u(r.closeDeleteModal())}),t(1,"div",55),m("click",function(r){return c(e),u(r.stopPropagation())}),t(2,"div",33)(3,"h3",34),l(4,"Confirmar Eliminaci\xF3n"),i()(),t(5,"div",56)(6,"p",57),l(7),i(),t(8,"p",58),l(9,"Esta acci\xF3n no se puede deshacer."),i()(),t(10,"div",52)(11,"button",53),m("click",function(){c(e);let r=d();return u(r.closeDeleteModal())}),l(12,"Cancelar"),i(),t(13,"button",59),m("click",function(){c(e);let r=d();return u(r.deleteImage())}),l(14," S\xED, Eliminar "),i()()()()}if(a&2){let e,o=d();s(7),I('\xBFEst\xE1s seguro de que quieres eliminar la imagen "',(e=o.currentImage())==null?null:e.title,'"?')}}var J=class a{carouselService=C(q);fb=C(H);toast=C(M);images=this.carouselService.allImages;isLoading=this.carouselService.isLoading;isModalOpen=b(!1);isDeleteModalOpen=b(!1);currentImage=b(null);imagePreview=b(null);isSaving=b(!1);imageForm;imagesUrl=`${V.url}carousel/imagen/`;ngOnInit(){this.carouselService.loadAllImages().subscribe(),this.initForm()}initForm(n){this.imageForm=this.fb.group({_id:[n?._id||null],title:[n?.title||"",L.required],subtitle:[n?.subtitle||""],linkUrl:[n?.linkUrl||""],order:[n?.order||0],isActive:[n?.isActive??!0],imageFile:[null]})}openCreateModal(){this.currentImage.set(null),this.initForm(),this.imagePreview.set(null),this.isModalOpen.set(!0)}openEditModal(n){this.currentImage.set(n),this.initForm(n),this.imagePreview.set(this.imagesUrl+n.imageUrl),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}openDeleteModal(n){this.currentImage.set(n),this.isDeleteModalOpen.set(!0)}closeDeleteModal(){this.isDeleteModalOpen.set(!1)}onFileChange(n){let e=n.target;if(e.files&&e.files[0]){let o=e.files[0];this.imageForm.patchValue({imageFile:o}),this.imageForm.get("imageFile")?.updateValueAndValidity();let r=new FileReader;r.onload=()=>this.imagePreview.set(r.result),r.readAsDataURL(o)}}saveImage(){if(this.imageForm.invalid)return;this.isSaving.set(!0);let n=new FormData,e=this.imageForm.value;Object.keys(e).forEach(r=>{r!=="imageFile"&&e[r]!==null&&n.append(r,e[r])}),e.imageFile&&n.append("image",e.imageFile),(e._id?this.carouselService.update(e._id,n):this.carouselService.register(n)).pipe(w(()=>this.carouselService.loadAllImages().subscribe())).subscribe({next:()=>{this.isSaving.set(!1),this.closeModal()},error:r=>{this.isSaving.set(!1)}})}deleteImage(){let n=this.currentImage()?._id;n&&this.carouselService.remove(n).pipe(w(()=>this.carouselService.loadAllImages().subscribe())).subscribe(()=>this.closeDeleteModal())}drop(n){let e=[...this.images()];T(e,n.previousIndex,n.currentIndex);let o=e.map((r,p)=>(r.order=p,{_id:r._id,order:p}));this.carouselService.updateLocalOrder(e),this.carouselService.updateOrder(o).subscribe({next:()=>this.toast.success("Orden actualizado en el backend."),error:r=>{this.carouselService.loadAllImages().subscribe()}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-carousel-dashboard"]],decls:14,vars:3,consts:[[1,"p-4","sm:p-6","lg:p-8","bg-slate-900","min-h-screen","text-white"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold"],[1,"text-slate-400"],[1,"px-4","py-2","rounded-lg","bg-lime-500","text-slate-900","font-bold","hover:bg-lime-400","transition",3,"click"],[1,"text-center","py-12","text-slate-400"],[1,"text-center","py-12","border-2","border-dashed","border-slate-700","rounded-lg"],[1,"overflow-x-auto","bg-slate-800/50","border","border-slate-700","rounded-xl"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","p-4"],[1,"text-sm","text-slate-500"],[1,"min-w-full","divide-y","divide-slate-700"],[1,"bg-slate-800"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-slate-300","uppercase","tracking-wider"],[1,"px-6","py-3","text-right","text-xs","font-medium","text-slate-300","uppercase","tracking-wider"],["cdkDropList","",1,"divide-y","divide-slate-700",3,"cdkDropListDropped"],["cdkDrag","",1,"hover:bg-slate-700/50","transition-colors",3,"cdkDragData"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-slate-400"],["cdkDragHandle","",1,"cursor-move","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],[1,"px-6","py-4"],[1,"w-24","h-12","object-cover","rounded-md",3,"src","alt"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-white"],[1,"text-xs","text-slate-400"],[1,"px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full","bg-green-500/20","text-green-300"],[1,"px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full","bg-red-500/20","text-red-300"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium","space-x-2"],[1,"text-blue-400","hover:text-blue-300",3,"click"],[1,"text-red-400","hover:text-red-300",3,"click"],[1,"fixed","inset-0","z-50","bg-black/70","backdrop-blur-sm","flex","items-center","justify-center","p-4",3,"click"],[1,"bg-slate-800","rounded-xl","shadow-2xl","w-full","max-w-2xl",3,"click"],[3,"ngSubmit","formGroup"],[1,"px-6","py-4","border-b","border-slate-700"],[1,"text-lg","font-semibold","text-white"],[1,"p-6","space-y-4","max-h-[70vh]","overflow-y-auto"],["for","title",1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","text","id","title","formControlName","title",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","p-2.5","text-white","focus:ring-lime-500","focus:border-lime-500"],["for","subtitle",1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","text","id","subtitle","formControlName","subtitle",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","p-2.5","text-white","focus:ring-lime-500","focus:border-lime-500"],["for","linkUrl",1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","url","id","linkUrl","formControlName","linkUrl","placeholder","https://...",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","p-2.5","text-white","focus:ring-lime-500","focus:border-lime-500"],["for","imageFile",1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","file","id","imageFile","accept","image/png, image/jpeg, image/webp",1,"block","w-full","text-sm","text-slate-400","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-lime-500/10","file:text-lime-300","hover:file:bg-lime-500/20",3,"change"],["alt","Vista previa",1,"mt-4","rounded-lg","max-h-48",3,"src"],[1,"grid","grid-cols-2","gap-4"],["for","order",1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","number","id","order","formControlName","order",1,"w-full","bg-slate-700","border","border-slate-600","rounded-lg","p-2.5","text-white","focus:ring-lime-500","focus:border-lime-500"],[1,"flex","items-end","pb-2"],[1,"flex","items-center","gap-2","cursor-pointer"],["type","checkbox","formControlName","isActive",1,"w-4","h-4","rounded","border-slate-500","bg-slate-600","text-lime-400","focus:ring-lime-500","focus:ring-offset-slate-800"],[1,"text-sm","text-slate-300"],[1,"px-6","py-4","border-t","border-slate-700","flex","justify-end","gap-3"],["type","button",1,"px-4","py-2","rounded-lg","border","border-slate-600","text-slate-300","hover:bg-slate-700","transition",3,"click"],["type","submit",1,"px-4","py-2","rounded-lg","bg-lime-500","text-slate-900","font-bold","hover:bg-lime-400","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"bg-slate-800","rounded-xl","shadow-2xl","w-full","max-w-md",3,"click"],[1,"p-6"],[1,"text-slate-300"],[1,"text-sm","text-slate-400","mt-1"],[1,"px-4","py-2","rounded-lg","bg-red-600","text-white","font-bold","hover:bg-red-500","transition",3,"click"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),l(4,"Gesti\xF3n del Carrusel"),i(),t(5,"p",3),l(6,"A\xF1ade, edita y reordena las im\xE1genes del carrusel de la p\xE1gina de inicio."),i()(),t(7,"button",4),m("click",function(){return o.openCreateModal()}),l(8," A\xF1adir Imagen "),i()(),g(9,Q,2,0,"div",5)(10,W,5,0,"div",6)(11,te,17,0,"div",7),g(12,le,40,5,"div",8),g(13,ae,15,1,"div",8),i()),e&2&&(s(9),_(o.isLoading()&&o.images().length===0?9:!o.isLoading()&&o.images().length===0?10:11),s(3),_(o.isModalOpen()?12:-1),s(),_(o.isDeleteModalOpen()?13:-1))},dependencies:[R,j,U,$,O,G,P,B,z,N,A],encapsulation:2})};export{J as a};
