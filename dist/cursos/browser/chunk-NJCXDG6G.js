import{b as f}from"./chunk-EU5OEAP5.js";import{a as l}from"./chunk-J56UX4WA.js";import{Jc as c,O as u,S as p,T as g,ec as s,ja as d}from"./chunk-6JS7X5LE.js";import{a as n,b as i}from"./chunk-I4MTPUBM.js";var m=class a{http=g(c);authService=g(f);API_URL=l.url;state=d({categories:[],isLoading:!1,error:null});categories=s(()=>this.state().categories);isLoading=s(()=>this.state().isLoading);reload(){this.state.update(t=>i(n({},t),{isLoading:!0}));let e=this.authService.user()?`${this.API_URL}categories/list`:`${this.API_URL}categories/list-public`;this.http.get(e).subscribe({next:t=>{this.state.update(r=>i(n({},r),{categories:t.categories,isLoading:!1}))},error:t=>{this.state.update(r=>i(n({},r),{isLoading:!1,error:t}))}})}register(e){return this.http.post(`${this.API_URL}categories/register`,e)}update(e){return this.http.put(`${this.API_URL}categories/update`,e)}remove(e){return this.http.delete(`${this.API_URL}categories/remove/${e}`)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};var h=class a{constructor(e){this.http=e}url=l.url;state=d({refunds:[],isLoading:!1,error:null});refunds=s(()=>this.state().refunds);isLoading=s(()=>this.state().isLoading);error=s(()=>this.state().error);pendingRefunds=s(()=>this.refunds().filter(e=>e.status==="pending"));processingRefunds=s(()=>this.refunds().filter(e=>e.status==="processing"));completedRefunds=s(()=>this.refunds().filter(e=>e.status==="completed"));totalRefunds=s(()=>this.refunds().length);totalOriginalAmount=s(()=>this.refunds().reduce((e,t)=>e+t.originalAmount,0));totalRefundedAmount=s(()=>this.refunds().reduce((e,t)=>e+(t.calculations?.refundAmount||0),0));async loadRefunds(){this.state.update(e=>i(n({},e),{isLoading:!0,error:null}));try{let e=await this.http.get(`${this.url}refunds/list`).toPromise();this.state.update(t=>i(n({},t),{refunds:e||[],isLoading:!1}))}catch(e){this.state.update(t=>i(n({},t),{isLoading:!1,error:e.message||"Error al cargar reembolsos"}))}}async checkEligibility(e){try{return await this.http.get(`${this.url}refunds/check-eligibility?sale_id=${e}`).toPromise()||null}catch(t){throw t}}async calculatePreview(e){try{return await this.http.get(`${this.url}refunds/calculate-preview?sale_id=${e}`).toPromise()}catch(t){throw t}}async createRefund(e){try{let t=await this.http.post(`${this.url}refunds/create`,e).toPromise();return await this.loadRefunds(),t}catch(t){throw t}}async reviewRefund(e,t,r){try{let o=await this.http.put(`${this.url}refunds/review/${e}`,{status:t,admin_notes:r}).toPromise();return await this.loadRefunds(),o}catch(o){throw o}}async markCompleted(e,t,r){try{let o=await this.http.put(`${this.url}refunds/complete/${e}`,{receipt_number:t,receipt_image:r}).toPromise();return await this.loadRefunds(),o}catch(o){throw o}}async loadStatistics(){try{return await this.http.get(`${this.url}refunds/statistics`).toPromise()}catch(e){throw e}}hasCourseRefund(e){return this.refunds().filter(r=>r.status==="completed"&&r.course?._id===e).length>0}hasProjectRefund(e){return this.refunds().filter(r=>r.status==="completed"&&r.project?._id===e).length>0}hasSaleRefund(e){return this.refunds().some(r=>r.status==="completed"&&r.sale?._id===e)}static \u0275fac=function(t){return new(t||a)(p(c))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a,h as b};
