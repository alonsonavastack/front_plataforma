import{b as D,d as F,e as I,j as T,n as A,o as L,p as R,q as G,r as K,s as V,w as O,y as j}from"./chunk-QA5A7GBQ.js";import{a as P}from"./chunk-ZGVWU7EJ.js";import{Ac as M,E as v,Gb as o,Ib as S,Jc as N,Ma as s,O as h,T as d,Xa as _,Y as x,Z as k,ab as c,ec as g,fc as y,ja as l,nb as a,o as f,ob as n,pb as t,qb as m,ub as C,vc as E,wb as w,yb as p}from"./chunk-6JS7X5LE.js";var u=class i{http=d(N);apiUrl=`${P.url}payment-settings`;reloadTrigger=l(0);adminSettingsResource=y({loader:()=>(this.reloadTrigger(),f(this.http.get(`${this.apiUrl}/admin`)))});adminSettings=g(()=>this.adminSettingsResource.value()?.settings??null);isLoadingAdminSettings=g(()=>this.adminSettingsResource.isLoading());adminSettingsError=g(()=>this.adminSettingsResource.error());publicReloadTrigger=l(0);publicSettingsResource=y({loader:()=>(this.publicReloadTrigger(),f(this.http.get(`${this.apiUrl}/public`)))});publicSettings=g(()=>this.publicSettingsResource.value()?.settings??null);isLoadingPublicSettings=g(()=>this.publicSettingsResource.isLoading());publicSettingsError=g(()=>this.publicSettingsResource.error());reloadAdminSettings(){this.reloadTrigger.update(r=>r+1)}reloadPublicSettings(){this.publicReloadTrigger.update(r=>r+1)}updateSettings(r){return this.http.put(`${this.apiUrl}/admin`,r)}getSettings(){return this.http.get(`${this.apiUrl}/admin`)}getPublicSettings(){return this.http.get(`${this.apiUrl}/public`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})};function J(i,r){i&1&&(n(0,"div",6),m(1,"div",7),t())}function z(i,r){if(i&1&&(n(0,"div",26)(1,"span",27),o(2,"\xA1\xC9xito!"),t(),o(3),t()),i&2){let e=p(2);s(3),S(" ",e.successMessage()," ")}}function H(i,r){if(i&1&&(n(0,"div",28)(1,"span",27),o(2,"Error!"),t(),o(3),t()),i&2){let e=p(2);s(3),S(" ",e.errorMessage()," ")}}function W(i,r){i&1&&(n(0,"span"),o(1,"Guardando..."),t())}function q(i,r){i&1&&(n(0,"span"),o(1,"Guardar Configuraci\xF3n"),t())}function Q(i,r){if(i&1){let e=C();n(0,"form",8),w("ngSubmit",function(){x(e);let $=p();return k($.saveSettings())}),n(1,"div",9)(2,"div",10)(3,"div")(4,"label",11),o(5,"Modo"),t(),n(6,"select",12)(7,"option",13),o(8,"Test (Pruebas)"),t(),n(9,"option",14),o(10,"Live (Producci\xF3n)"),t()()()(),n(11,"div",15)(12,"h4",16)(13,"span"),o(14,"\u{1F4B3}"),t(),o(15," Claves de API de Stripe "),t(),n(16,"div",17)(17,"div")(18,"label",11),o(19,"Secret Key (sk_...)"),t(),m(20,"input",18),t(),n(21,"div")(22,"label",11),o(23,"Publishable Key (pk_...)"),t(),m(24,"input",19),t(),n(25,"div",20)(26,"label",11),o(27,"Webhook Secret (whsec_...)"),t(),m(28,"input",21),t()()()(),c(29,z,4,1,"div",22)(30,H,4,1,"div",23),n(31,"button",24),c(32,W,2,0,"span",25)(33,q,2,0,"span",25),t()()}if(i&2){let e=p();a("formGroup",e.settingsForm),s(29),a("ngIf",e.successMessage()),s(),a("ngIf",e.errorMessage()),s(),a("disabled",e.isSaving()),s(),a("ngIf",e.isSaving()),s(),a("ngIf",!e.isSaving())}}var U=class i{paymentSettingsService=d(u);fb=d(O);settingsForm;isLoading=l(!1);isSaving=l(!1);successMessage=l("");errorMessage=l("");constructor(){this.settingsForm=this.fb.group({stripe:this.fb.group({mode:["test"],active:[!0],secretKey:[""],publishableKey:[""],webhookSecret:[""]})})}ngOnInit(){this.loadSettings()}loadSettings(){this.isLoading.set(!0),this.paymentSettingsService.getSettings().pipe(v(()=>this.isLoading.set(!1))).subscribe({next:r=>{let e=r.settings;console.log("\u{1F4E5} [loadSettings] Datos recibidos del backend:",JSON.stringify(e?.stripe,null,2)),e?.stripe&&(this.settingsForm.get("stripe")?.patchValue({mode:e.stripe.mode||"test",active:e.stripe.active??!0,secretKey:e.stripe.secretKey||"",publishableKey:e.stripe.publishableKey||"",webhookSecret:e.stripe.webhookSecret||""}),console.log("\u{1F4DD} [loadSettings] Form luego del patchValue:",JSON.stringify(this.settingsForm.value,null,2)))},error:r=>{console.error("Error loading settings",r),this.errorMessage.set("Error al cargar la configuraci\xF3n")}})}saveSettings(){this.settingsForm.invalid||(console.log("\u{1F4E4} [PaymentSettings] Enviando al backend:",JSON.stringify(this.settingsForm.value,null,2)),this.isSaving.set(!0),this.successMessage.set(""),this.errorMessage.set(""),this.paymentSettingsService.updateSettings(this.settingsForm.value).pipe(v(()=>this.isSaving.set(!1))).subscribe({next:r=>{this.successMessage.set("Configuraci\xF3n guardada correctamente"),setTimeout(()=>this.successMessage.set(""),3e3)},error:r=>{console.error("Error saving settings",r),this.errorMessage.set("Error al guardar la configuraci\xF3n")}}))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-admin-payment-settings"]],decls:8,vars:2,consts:[[1,"p-6"],[1,"mb-6"],[1,"text-2xl","font-bold","text-gray-800","dark:text-white"],[1,"text-gray-600","dark:text-gray-400"],["class","flex justify-center py-10",4,"ngIf"],["autocomplete","off",3,"formGroup","ngSubmit",4,"ngIf"],[1,"flex","justify-center","py-10"],[1,"animate-spin","rounded-full","h-10","w-10","border-b-2","border-violet-600"],["autocomplete","off",3,"ngSubmit","formGroup"],["formGroupName","stripe",1,"space-y-6"],[1,"grid","gap-6","mb-6","md:grid-cols-2"],[1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["formControlName","mode",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-violet-500","focus:border-violet-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white"],["value","test"],["value","live"],[1,"p-4","border","border-violet-500/30","bg-violet-500/5","rounded-lg","mb-6"],[1,"text-violet-400","font-bold","mb-4","flex","items-center","gap-2"],[1,"grid","gap-6","md:grid-cols-2"],["type","password","formControlName","secretKey","placeholder","sk_test_... o sk_live_...","autocomplete","new-password",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-violet-500","focus:border-violet-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white"],["type","text","formControlName","publishableKey","placeholder","pk_test_... o pk_live_...",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-violet-500","focus:border-violet-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white"],[1,"md:col-span-2"],["type","password","formControlName","webhookSecret","placeholder","whsec_...","autocomplete","new-password",1,"bg-gray-50","border","border-gray-300","text-gray-900","text-sm","rounded-lg","focus:ring-violet-500","focus:border-violet-500","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white"],["class","p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400","role","alert",4,"ngIf"],["class","p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400","role","alert",4,"ngIf"],["type","submit",1,"text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","w-full","sm:w-auto","px-5","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800","disabled:opacity-50",3,"disabled"],[4,"ngIf"],["role","alert",1,"p-4","mb-4","text-sm","text-green-800","rounded-lg","bg-green-50","dark:bg-gray-800","dark:text-green-400"],[1,"font-medium"],["role","alert",1,"p-4","mb-4","text-sm","text-red-800","rounded-lg","bg-red-50","dark:bg-gray-800","dark:text-red-400"]],template:function(e,b){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"\u{1F4B3} Configuraci\xF3n de Stripe"),t(),n(4,"p",3),o(5,"Gestiona las credenciales de Stripe. Se usa para cobros en el checkout y para pagar a instructores."),t()(),c(6,J,2,0,"div",4)(7,Q,34,6,"form",5),t()),e&2&&(s(6),a("ngIf",b.isLoading()),s(),a("ngIf",!b.isLoading()))},dependencies:[M,E,j,T,K,V,D,G,F,I,R,L,A],encapsulation:2})};export{U as a};
