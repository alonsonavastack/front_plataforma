import{a as ne}from"./chunk-JYA6XITJ.js";import{b as Y}from"./chunk-W4HGVXKG.js";import{a as q}from"./chunk-TCGJFX72.js";import{b as J,d as K,e as Q,g as X,i as Z,j as ee,u as te,w as ie}from"./chunk-SDJWNAN2.js";import{a as H}from"./chunk-ESTJS734.js";import{$ as E,Db as U,Eb as j,Gb as d,Hb as f,Ib as b,Jc as z,Kb as W,Lb as V,Ma as a,Mb as M,Nb as I,O as A,Sb as N,T as S,Ub as P,Xa as O,Y as u,Z as C,_ as v,ea as B,ec as F,fb as D,hb as m,ib as p,ja as x,jb as $,kb as T,lb as R,ma as L,mb as y,nb as w,ob as o,pb as n,qb as c,ub as h,wb as g,yb as l}from"./chunk-6JS7X5LE.js";var G=class i{http=S(z);baseUrl=`${H.url}reviews`;createReview(t){return this.http.post(`${this.baseUrl}/create`,t)}getReviewsByProduct(t,e,r=1,s=5){return this.http.get(`${this.baseUrl}/product/${t}/${e}?page=${r}&limit=${s}`)}updateReview(t,e,r){return this.http.put(`${this.baseUrl}/update/${t}`,{rating:e,description:r})}deleteReview(t){return this.http.delete(`${this.baseUrl}/delete/${t}`)}canRateProduct(t,e){return this.http.get(`${this.baseUrl}/can-rate/${t}/${e}`)}generateStars(t){let e=[],r=Math.floor(t),s=t%1!==0;for(let k=0;k<r;k++)e.push("full");s&&e.push("half");let _=5-Math.ceil(t);for(let k=0;k<_;k++)e.push("empty");return e}calculateRatingPercentage(t,e){return e===0?{5:0,4:0,3:0,2:0,1:0}:{5:Math.round(t[5]/e*100),4:Math.round(t[4]/e*100),3:Math.round(t[3]/e*100),2:Math.round(t[2]/e*100),1:Math.round(t[1]/e*100)}}addReply(t,e){return this.http.post(`${this.baseUrl}/reply/${t}`,{description:e})}updateReply(t,e){return this.http.put(`${this.baseUrl}/reply/${t}`,{description:e})}deleteReply(t){return this.http.delete(`${this.baseUrl}/reply/${t}`)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=A({token:i,factory:i.\u0275fac,providedIn:"root"})};var se=()=>[5,4,3,2,1],re=()=>[1,2,3,4,5],le=()=>[1,2,3],de=(i,t)=>t._id;function ce(i,t){i&1&&(v(),o(0,"svg",14),c(1,"path",16),n())}function me(i,t){if(i&1&&(v(),o(0,"svg",14)(1,"defs")(2,"linearGradient",17),c(3,"stop",18)(4,"stop",19),n()(),c(5,"path",16),n()),i&2){let e=l().$index;a(2),w("id",N("half-",e)),a(3),D("fill","url(#half-"+e+")")}}function pe(i,t){i&1&&(v(),o(0,"svg",15),c(1,"path",20),n())}function _e(i,t){if(i&1&&m(0,ce,2,0,":svg:svg",14)(1,me,6,3,":svg:svg",14)(2,pe,2,0,":svg:svg",15),i&2){let e=t.$implicit;p(e==="full"?0:e==="half"?1:2)}}function ue(i,t){if(i&1&&(o(0,"div",13)(1,"span",21),d(2),n(),v(),o(3,"svg",22),c(4,"path",16),n(),E(),o(5,"div",23),c(6,"div",24),n(),o(7,"span",25),d(8),n()()),i&2){let e=t.$implicit,r=l(2);a(2),f(e),a(4),U("width",r.getRatingPercentage(e),"%"),a(2),f(r.getRatingCount(e))}}function Ce(i,t){if(i&1&&(o(0,"div",1)(1,"div",7)(2,"div",8)(3,"div",9),d(4),n(),o(5,"div",10),R(6,_e,3,1,null,null,$),n(),o(8,"div",11),d(9),n()(),o(10,"div",12),R(11,ue,9,4,"div",13,T),n()()()),i&2){let e=l();a(4),f(e.statistics().average_rating),a(2),y(e.generateStars(e.statistics().average_rating)),a(3),b("",e.statistics().total_reviews," calificaciones"),a(2),y(P(2,se))}}function ve(i,t){i&1&&(o(0,"div",27),c(1,"div",28),o(2,"p",29),d(3,"Enviando calificaci\xF3n..."),n()())}function ge(i,t){i&1&&(v(),o(0,"svg",41),c(1,"path",16),n())}function xe(i,t){i&1&&(v(),o(0,"svg",42),c(1,"path",20),n())}function we(i,t){if(i&1){let e=h();o(0,"button",40),g("click",function(){let s=u(e).$implicit,_=l(4);return C(_.setRating(s))}),m(1,ge,2,0,":svg:svg",41)(2,xe,2,0,":svg:svg",42),n()}if(i&2){let e=t.$implicit,r=l(4);a(),p(e<=r.selectedRating()?1:2)}}function he(i,t){if(i&1&&(o(0,"p",39),d(1),n()),i&2){let e=l(4);a(),b(" ",e.getRatingText(e.selectedRating())," ")}}function fe(i,t){if(i&1&&(o(0,"div")(1,"label",36),d(2,"Tu calificaci\xF3n"),n(),o(3,"div",37),R(4,we,3,1,"button",38,T),n(),m(6,he,2,1,"p",39),n()),i&2){let e=l(3);a(4),y(P(1,re)),a(2),p(e.selectedRating()>0?6:-1)}}function be(i,t){if(i&1){let e=h();o(0,"form",30),g("ngSubmit",function(){u(e);let s=l(2);return C(s.onSubmit())}),m(1,fe,7,2,"div"),o(2,"div")(3,"label",31),d(4," Tu comentario "),n(),o(5,"textarea",32),I("ngModelChange",function(s){u(e);let _=l(2);return M(_.reviewDescription,s)||(_.reviewDescription=s),C(s)}),n()(),o(6,"div",33)(7,"button",34),d(8," Enviar calificaci\xF3n "),n(),o(9,"button",35),g("click",function(){u(e);let s=l(2);return C(s.resetForm())}),d(10," Cancelar "),n()()()}if(i&2){let e=l(2);a(),p(e.enableRating?1:-1),a(4),V("ngModel",e.reviewDescription),a(2),w("disabled",e.enableRating&&e.selectedRating()===0||!e.reviewDescription.trim())}}function Re(i,t){if(i&1&&(o(0,"div",1)(1,"h3",26),d(2,"Califica este curso"),n(),m(3,ve,4,0,"div",27)(4,be,11,3,"form",3),n()),i&2){let e=l();a(3),p(e.isSubmitting()?3:4)}}function ye(i,t){i&1&&(o(0,"div",27),c(1,"div",28),o(2,"p",29),d(3,"Actualizando calificaci\xF3n..."),n()())}function Se(i,t){i&1&&(v(),o(0,"svg",41),c(1,"path",16),n())}function Ee(i,t){i&1&&(v(),o(0,"svg",42),c(1,"path",20),n())}function Te(i,t){if(i&1){let e=h();o(0,"button",40),g("click",function(){let s=u(e).$implicit,_=l(4);return C(_.setRating(s))}),m(1,Se,2,0,":svg:svg",41)(2,Ee,2,0,":svg:svg",42),n()}if(i&2){let e=t.$implicit,r=l(4);a(),p(e<=r.selectedRating()?1:2)}}function Fe(i,t){if(i&1&&(o(0,"p",39),d(1),n()),i&2){let e=l(4);a(),b(" ",e.getRatingText(e.selectedRating())," ")}}function ke(i,t){if(i&1&&(o(0,"div")(1,"label",36),d(2,"Tu calificaci\xF3n"),n(),o(3,"div",37),R(4,Te,3,1,"button",38,T),n(),m(6,Fe,2,1,"p",39),n()),i&2){let e=l(3);a(4),y(P(1,re)),a(2),p(e.selectedRating()>0?6:-1)}}function Ve(i,t){if(i&1){let e=h();o(0,"form",30),g("ngSubmit",function(){u(e);let s=l(2);return C(s.onSubmit())}),m(1,ke,7,2,"div"),o(2,"div")(3,"label",43),d(4," Tu comentario "),n(),o(5,"textarea",44),I("ngModelChange",function(s){u(e);let _=l(2);return M(_.reviewDescription,s)||(_.reviewDescription=s),C(s)}),n()(),o(6,"div",33)(7,"button",34),d(8," Actualizar calificaci\xF3n "),n(),o(9,"button",35),g("click",function(){u(e);let s=l(2);return C(s.resetForm())}),d(10," Cancelar edici\xF3n "),n()()()}if(i&2){let e=l(2);a(),p(e.enableRating?1:-1),a(4),V("ngModel",e.reviewDescription),a(2),w("disabled",e.enableRating&&e.selectedRating()===0||!e.reviewDescription.trim())}}function Me(i,t){if(i&1&&(o(0,"div",2)(1,"h3",26),d(2,"Editar tu calificaci\xF3n"),n(),m(3,ye,4,0,"div",27)(4,Ve,11,3,"form",3),n()),i&2){let e=l();a(3),p(e.isSubmitting()?3:4)}}function Ie(i,t){i&1&&(v(),o(0,"svg",45),c(1,"path",20),n())}function Pe(i,t){i&1&&(v(),o(0,"svg",45),c(1,"path",51),n())}function De(i,t){i&1&&(v(),o(0,"svg",54),c(1,"path",16),n())}function $e(i,t){if(i&1&&(v(),o(0,"svg",54)(1,"defs")(2,"linearGradient",17),c(3,"stop",18)(4,"stop",19),n()(),c(5,"path",16),n()),i&2){let e=l().$index;a(2),w("id",N("existing-half-",e)),a(3),D("fill","url(#existing-half-"+e+")")}}function Ne(i,t){i&1&&(v(),o(0,"svg",55),c(1,"path",20),n())}function Ge(i,t){if(i&1&&m(0,De,2,0,":svg:svg",54)(1,$e,6,3,":svg:svg",54)(2,Ne,2,0,":svg:svg",55),i&2){let e=t.$implicit;p(e==="full"?0:e==="half"?1:2)}}function Be(i,t){if(i&1&&(o(0,"p",52),d(1,"Tu calificaci\xF3n:"),n(),o(2,"div",53)(3,"div",37),R(4,Ge,3,1,null,null,$),n()()),i&2){let e=l(2);a(4),y(e.generateStars(e.canRateResponse().existing_review.rating))}}function Ae(i,t){if(i&1){let e=h();o(0,"div",1)(1,"div",8),m(2,Ie,2,0,":svg:svg",45)(3,Pe,2,0,":svg:svg",45),o(4,"h3",46),d(5),n(),o(6,"p",47),d(7,"Gracias por compartir tu opini\xF3n"),n(),o(8,"div",48),m(9,Be,6,0),o(10,"p",49),d(11),n(),o(12,"button",50),g("click",function(){u(e);let s=l();return C(s.editExistingReview())}),d(13),n()()()()}if(i&2){let e=l();a(2),p(e.enableRating?2:3),a(3),f(e.enableRating?"Ya calificaste este curso":"Ya comentaste este proyecto"),a(4),p(e.enableRating?9:-1),a(2),f(e.canRateResponse().existing_review.description),a(2),b(" \u270F\uFE0F ",e.enableRating?"Editar mi calificaci\xF3n":"Editar mi comentario"," ")}}function Le(i,t){i&1&&(v(),o(0,"svg",56),c(1,"path",20),n(),E(),o(2,"h3",46),d(3,"No puedes calificar este curso"),n())}function Oe(i,t){i&1&&(v(),o(0,"svg",56),c(1,"path",51),n(),E(),o(2,"h3",46),d(3,"No puedes comentar este proyecto"),n())}function Ue(i,t){if(i&1&&(o(0,"div",1)(1,"div",8),m(2,Le,4,0)(3,Oe,4,0),o(4,"p",47),d(5),n()()()),i&2){let e=l();a(2),p(e.enableRating?2:3),a(3),f(e.enableRating?e.canRateResponse().reason:e.canRateResponse().reason.replace("calificar","comentar").replace("este producto","este proyecto").replace("este curso","este proyecto"))}}function je(i,t){i&1&&(o(0,"div",57)(1,"div",58),c(2,"div",59),o(3,"div",60),c(4,"div",61)(5,"div",62),n()(),o(6,"div",63),c(7,"div",64)(8,"div",65),n()())}function We(i,t){i&1&&(o(0,"div",3),R(1,je,9,0,"div",57,T),n()),i&2&&(a(),y(P(0,le)))}function ze(i,t){i&1&&(v(),o(0,"svg",56),c(1,"path",20),n(),E(),o(2,"h3",46),d(3,"Sin calificaciones a\xFAn"),n(),o(4,"p",47),d(5,"S\xE9 el primero en calificar este curso"),n())}function He(i,t){i&1&&(v(),o(0,"svg",56),c(1,"path",51),n(),E(),o(2,"h3",46),d(3,"Sin comentarios a\xFAn"),n(),o(4,"p",47),d(5,"S\xE9 el primero en comentar este proyecto"),n())}function qe(i,t){if(i&1&&(o(0,"div",5),m(1,ze,6,0)(2,He,6,0),n()),i&2){let e=l();a(),p(e.enableRating?1:2)}}function Ye(i,t){i&1&&(v(),o(0,"svg",76),c(1,"path",16),n())}function Je(i,t){if(i&1&&(v(),o(0,"svg",76)(1,"defs")(2,"linearGradient",17),c(3,"stop",18)(4,"stop",19),n()(),c(5,"path",16),n()),i&2){let e=l().$index;a(2),w("id",N("review-half-",e)),a(3),D("fill","url(#review-half-"+e+")")}}function Ke(i,t){i&1&&(v(),o(0,"svg",15),c(1,"path",20),n())}function Qe(i,t){if(i&1&&m(0,Ye,2,0,":svg:svg",76)(1,Je,6,3,":svg:svg",76)(2,Ke,2,0,":svg:svg",15),i&2){let e=t.$implicit;p(e==="full"?0:e==="half"?1:2)}}function Xe(i,t){if(i&1&&R(0,Qe,3,1,null,null,$),i&2){let e=l().$implicit,r=l(2);y(r.generateStars(e.rating))}}function Ze(i,t){i&1&&(o(0,"span",13),c(1,"div",84),d(2," Guardando... "),n())}function et(i,t){i&1&&d(0," Guardar cambios ")}function tt(i,t){if(i&1){let e=h();o(0,"div",63)(1,"textarea",80),I("ngModelChange",function(s){u(e);let _=l(4);return M(_.replyText,s)||(_.replyText=s),C(s)}),n(),o(2,"div",81)(3,"button",82),g("click",function(){u(e);let s=l(2).$implicit,_=l(2);return C(_.submitReply(s._id))}),m(4,Ze,3,0,"span",13)(5,et,1,0),n(),o(6,"button",83),g("click",function(){u(e);let s=l(4);return C(s.cancelReply())}),d(7," Cancelar "),n()()()}if(i&2){let e=l(4);a(),V("ngModel",e.replyText),a(2),w("disabled",e.isSubmittingReply()||!e.replyText().trim()),a(),p(e.isSubmittingReply()?4:5)}}function it(i,t){if(i&1){let e=h();o(0,"div",86)(1,"button",87),g("click",function(){u(e);let s=l(3).$implicit,_=l(2);return C(_.editReply(s._id,s.reply.description))}),d(2," \u270F\uFE0F Editar "),n(),o(3,"button",88),g("click",function(){u(e);let s=l(3).$implicit,_=l(2);return C(_.deleteReply(s._id))}),d(4," \u{1F5D1}\uFE0F Eliminar "),n()()}if(i&2){let e=l(5);a(3),w("disabled",e.isSubmittingReply())}}function nt(i,t){if(i&1&&(o(0,"p",85),d(1),n(),m(2,it,5,1,"div",86)),i&2){let e=l(2).$implicit,r=l(2);a(),f(e.reply.description),a(),p(r.canReplyToReviews()?2:-1)}}function ot(i,t){if(i&1&&(o(0,"div",74)(1,"div",67)(2,"div",77),d(3),n(),o(4,"div",69)(5,"div",70)(6,"span",78),d(7),n(),o(8,"span",72),d(9),n(),o(10,"span",79),d(11," Instructor "),n()(),m(12,tt,8,3,"div",63)(13,nt,3,2),n()()()),i&2){let e,r=l().$implicit,s=l(2);a(3),b(" ",(r.reply.instructor_info==null||r.reply.instructor_info.full_name==null||(e=r.reply.instructor_info.full_name.charAt(0))==null?null:e.toUpperCase())||"I"," "),a(4),b(" ",(r.reply.instructor_info==null?null:r.reply.instructor_info.full_name)||"Instructor"," "),a(2),b(" \xB7 ",s.formatDate(r.reply.createdAt)," "),a(3),p(s.editingReplyFor()===r._id?12:13)}}function rt(i,t){if(i&1){let e=h();o(0,"div",75)(1,"button",89),g("click",function(){u(e);let s=l().$implicit,_=l(2);return C(_.startReply(s._id))}),v(),o(2,"svg",90),c(3,"path",91),n(),d(4," Responder a esta rese\xF1a "),n()()}}function at(i,t){i&1&&(o(0,"span",13),c(1,"div",97),d(2," Enviando... "),n())}function st(i,t){i&1&&d(0," Enviar respuesta ")}function lt(i,t){if(i&1){let e=h();o(0,"div",74)(1,"div",92)(2,"div",13)(3,"div",77),d(4),n(),o(5,"span",93),d(6,"Tu respuesta como instructor"),n()(),o(7,"textarea",94),I("ngModelChange",function(s){u(e);let _=l(3);return M(_.replyText,s)||(_.replyText=s),C(s)}),n(),o(8,"div",81)(9,"button",95),g("click",function(){u(e);let s=l().$implicit,_=l(2);return C(_.submitReply(s._id))}),m(10,at,3,0,"span",13)(11,st,1,0),n(),o(12,"button",96),g("click",function(){u(e);let s=l(3);return C(s.cancelReply())}),d(13," Cancelar "),n()()()()}if(i&2){let e,r=l(3);a(4),b(" ",((e=r.authService.user())==null||e.name==null||(e=e.name.charAt(0))==null?null:e.toUpperCase())||"I"," "),a(3),V("ngModel",r.replyText),a(2),w("disabled",r.isSubmittingReply()||!r.replyText().trim()),a(),p(r.isSubmittingReply()?10:11),a(2),w("disabled",r.isSubmittingReply())}}function dt(i,t){if(i&1&&(o(0,"div",66)(1,"div",67)(2,"div",68),d(3),n(),o(4,"div",69)(5,"div",70)(6,"span",71),d(7),n(),o(8,"div",37),m(9,Xe,2,0),n(),o(10,"span",72),d(11),n()(),o(12,"p",73),d(13),n(),m(14,ot,14,4,"div",74),m(15,rt,5,0,"div",75),m(16,lt,14,5,"div",74),n()()()),i&2){let e=t.$implicit,r=l(2);a(3),b(" ",e.user_info.full_name.charAt(0).toUpperCase()," "),a(4),f(e.user_info.full_name),a(2),p(r.enableRating?9:-1),a(2),f(r.formatDate(e.createdAt)),a(2),f(e.description),a(),p(e.reply?14:-1),a(),p(r.canReplyToReviews()&&!e.reply&&r.replyingTo()!==e._id?15:-1),a(),p(r.replyingTo()===e._id&&!e.reply?16:-1)}}function ct(i,t){if(i&1&&(o(0,"div",3),R(1,dt,17,8,"div",66,de),n()),i&2){let e=l();a(),y(e.reviews())}}function mt(i,t){i&1&&(o(0,"span",101),d(1,"..."),n())}function pt(i,t){if(i&1){let e=h();o(0,"button",103),g("click",function(){u(e);let s=l().$implicit,_=l(2);return C(_.onPageChange(s))}),d(1),n()}if(i&2){let e=l().$implicit,r=l(2);j("bg-lime-500",e===r.currentPage())("text-slate-900",e===r.currentPage())("bg-slate-700",e!==r.currentPage())("text-slate-300",e!==r.currentPage()),a(),b(" ",e," ")}}function _t(i,t){if(i&1&&m(0,mt,2,0,"span",101)(1,pt,2,9,"button",102),i&2){let e=t.$implicit;p(e===-1?0:1)}}function ut(i,t){if(i&1){let e=h();o(0,"div",6)(1,"div",98),d(2),n(),o(3,"div",99)(4,"button",100),g("click",function(){u(e);let s=l();return C(s.onPageChange(s.currentPage()-1))}),d(5," \u2190 Anterior "),n(),R(6,_t,2,1,null,null,T),o(8,"button",100),g("click",function(){u(e);let s=l();return C(s.onPageChange(s.currentPage()+1))}),d(9," Siguiente \u2192 "),n()()()}if(i&2){let e=l();a(2),W(" P\xE1gina ",e.currentPage()," de ",e.totalPages()," (",e.totalItems()," rese\xF1as) "),a(2),w("disabled",e.currentPage()===1),a(2),y(e.getPageNumbers()),a(2),w("disabled",e.currentPage()===e.totalPages())}}var oe=class i{productId;productType="course";showStatistics=!0;enableRating=!0;reviewAdded=new B;reviewUpdated=new B;reviewService=S(G);authService=S(Y);reviewNotificationsService=S(ne);toastService=S(q);reviews=x([]);statistics=x(null);isLoading=x(!1);isSubmitting=x(!1);canRateResponse=x(null);currentPage=x(1);totalPages=x(1);totalItems=x(0);limit=5;isEditing=x(!1);editingReviewId=x(null);selectedRating=x(0);reviewDescription="";replyingTo=x(null);replyText=x("");isSubmittingReply=x(!1);editingReplyFor=x(null);canRate=F(()=>this.canRateResponse()?.can_rate??!1);shouldShowCreateForm=F(()=>{let t=this.canRateResponse();return t?t.can_rate&&!t.existing_review&&!this.isEditing():!1});shouldShowAlreadyRatedMessage=F(()=>{let t=this.canRateResponse();return t?t.can_rate&&!!t.existing_review&&!this.isEditing():!1});shouldShowEditForm=F(()=>this.isEditing()&&this.editingReviewId()!==null);ngOnInit(){this.productId&&(this.loadReviews(),this.checkCanRate())}ngOnChanges(t){t.productId&&this.productId&&(this.loadReviews(),this.checkCanRate())}async loadReviews(t=1){if(this.productId){this.isLoading.set(!0);try{let e=await this.reviewService.getReviewsByProduct(this.productId,this.productType,t,this.limit).toPromise();e&&(this.reviews.set(e.reviews),this.statistics.set(e.statistics),e.pagination&&(this.currentPage.set(e.pagination.page),this.totalPages.set(e.pagination.pages),this.totalItems.set(e.pagination.total)))}catch{}finally{this.isLoading.set(!1)}}}async checkCanRate(){if(this.productId)try{let t=await this.reviewService.canRateProduct(this.productId,this.productType).toPromise();this.canRateResponse.set(t||null)}catch{}}setRating(t){this.selectedRating.set(t)}getRatingText(t){return{1:"Muy malo",2:"Malo",3:"Regular",4:"Bueno",5:"Excelente"}[t]||""}async onSubmit(){if(!this.enableRating&&this.selectedRating()===0&&this.selectedRating.set(5),this.selectedRating()===0&&this.enableRating||!this.reviewDescription.trim()||!this.productId){this.toastService.error("Error","Por favor completa todos los campos");return}this.isSubmitting.set(!0);try{if(this.isEditing()&&this.editingReviewId()){let t=await this.reviewService.updateReview(this.editingReviewId(),this.selectedRating(),this.reviewDescription.trim()).toPromise();t&&(this.reviewUpdated.emit(t.review),this.resetForm(),await this.loadReviews(this.currentPage()),await this.checkCanRate(),this.resetForm(),await this.loadReviews(this.currentPage()),await this.checkCanRate())}else{let t=await this.reviewService.createReview({product_id:this.productId,product_type:this.productType,rating:this.selectedRating(),description:this.reviewDescription.trim()}).toPromise();t&&(this.reviewAdded.emit(t.review),this.resetForm(),await this.loadReviews(1),await this.checkCanRate(),this.resetForm(),await this.loadReviews(1),await this.checkCanRate())}}catch(t){let e=t?.error?.message_text||"Error al enviar la calificaci\xF3n";this.toastService.error("Error",e)}finally{this.isSubmitting.set(!1)}}resetForm(){this.selectedRating.set(0),this.reviewDescription="",this.isEditing.set(!1),this.editingReviewId.set(null)}editExistingReview(){if(this.canRateResponse()?.existing_review){let t=this.canRateResponse().existing_review;this.isEditing.set(!0),this.editingReviewId.set(t._id),this.selectedRating.set(t.rating),this.reviewDescription=t.description}}generateStars(t){return this.reviewService.generateStars(t)}getRatingPercentage(t){if(!this.statistics())return 0;let e=this.statistics().total_reviews;if(e===0)return 0;let r=this.statistics().rating_distribution;return Math.round(r[t]/e*100)}onPageChange(t){t<1||t>this.totalPages()||this.loadReviews(t)}getPageNumbers(){let t=[],e=this.totalPages(),r=this.currentPage();if(e<=7)for(let s=1;s<=e;s++)t.push(s);else if(r<=4){for(let s=1;s<=5;s++)t.push(s);t.push(-1),t.push(e)}else if(r>=e-3){t.push(1),t.push(-1);for(let s=e-4;s<=e;s++)t.push(s)}else{t.push(1),t.push(-1);for(let s=r-1;s<=r+1;s++)t.push(s);t.push(-1),t.push(e)}return t}getRatingCount(t){return this.statistics()?this.statistics().rating_distribution[t]:0}formatDate(t){return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}canReplyToReviews=F(()=>{let t=this.authService.user();return t?t.rol==="admin"||t.rol==="instructor":!1});startReply(t){this.replyingTo.set(t),this.replyText.set(""),this.editingReplyFor.set(null)}editReply(t,e){this.replyingTo.set(t),this.replyText.set(e),this.editingReplyFor.set(t)}cancelReply(){this.replyingTo.set(null),this.replyText.set(""),this.editingReplyFor.set(null)}async submitReply(t){if(!this.replyText().trim()){this.toastService.warning("Atenci\xF3n","Por favor escribe una respuesta");return}if(!this.canReplyToReviews()&&!this.canReplyToReviews()){this.toastService.error("Error","No tienes permisos para responder a reviews");return}this.isSubmittingReply.set(!0);try{let e=this.editingReplyFor()===t;e?await this.reviewService.updateReply(t,this.replyText().trim()).toPromise():(await this.reviewService.addReply(t,this.replyText().trim()).toPromise(),this.reviewNotificationsService.markAsReplied(t)),await this.loadReviews(this.currentPage()),this.cancelReply(),this.toastService.success(e?"Actualizado":"Enviado",e?"Respuesta actualizada exitosamente":"Respuesta enviada exitosamente")}catch(e){let r=e?.error?.message_text||e?.message||"Error al enviar la respuesta";this.toastService.error("Error",r)}finally{this.isSubmittingReply.set(!1)}}async deleteReply(t){if(confirm("\xBFEst\xE1s seguro de eliminar esta respuesta?")){this.isSubmittingReply.set(!0);try{await this.reviewService.deleteReply(t).toPromise(),await this.loadReviews(this.currentPage()),this.toastService.success("Eliminado","Respuesta eliminada exitosamente")}catch(e){let r=e?.error?.message_text||"Error al eliminar la respuesta";this.toastService.error("Error",r)}finally{this.isSubmittingReply.set(!1)}}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-course-reviews"]],inputs:{productId:"productId",productType:"productType",showStatistics:"showStatistics",enableRating:"enableRating"},outputs:{reviewAdded:"reviewAdded",reviewUpdated:"reviewUpdated"},features:[L],decls:13,vars:8,consts:[[1,"space-y-6"],[1,"rounded-xl","border","border-white/10","bg-white/5","p-6"],[1,"rounded-xl","border","border-lime-400/40","bg-lime-500/5","p-6"],[1,"space-y-4"],[1,"text-lg","font-semibold","text-white"],[1,"rounded-xl","border","border-white/10","bg-white/5","p-8","text-center"],[1,"bg-slate-800/50","rounded-lg","px-6","py-4","flex","items-center","justify-between"],[1,"flex","items-center","gap-4","mb-4"],[1,"text-center"],[1,"text-3xl","font-bold","text-lime-300"],[1,"flex","items-center","justify-center","gap-1","text-yellow-400"],[1,"text-sm","text-white/70"],[1,"flex-1","space-y-2"],[1,"flex","items-center","gap-2"],["viewBox","0 0 24 24",1,"w-4","h-4","fill-current"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-4","h-4","text-white/30"],["d","M12 17l-5 3 1.5-5.5L4 9l5.5-.5L12 3l2.5 5.5L20 9l-4.5 5.5L17 20z"],[3,"id"],["offset","50%","stop-color","currentColor"],["offset","50%","stop-color","transparent"],["stroke-width","2","d","M12 17l-5 3 1.5-5.5L4 9l5.5-.5L12 3l2.5 5.5L20 9l-4.5 5.5L17 20z"],[1,"text-sm","text-white/70","w-2"],["viewBox","0 0 24 24","fill","currentColor",1,"w-4","h-4","text-yellow-400"],[1,"flex-1","bg-white/10","rounded-full","h-2"],[1,"bg-yellow-400","h-2","rounded-full","transition-all","duration-300"],[1,"text-xs","text-white/60","w-8"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"text-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-lime-400","mx-auto"],[1,"text-white/70","mt-2"],[1,"space-y-4",3,"ngSubmit"],["for","description",1,"block","text-sm","font-medium","text-white/90","mb-2"],["id","description","name","description","rows","4","placeholder","Comparte tu experiencia con este curso...","required","",1,"w-full","px-3","py-2","bg-white/5","border","border-white/10","rounded-lg","text-white","placeholder-white/50","focus:outline-none","focus:ring-2","focus:ring-lime-400/50","focus:border-lime-400/50",3,"ngModelChange","ngModel"],[1,"flex","gap-3"],["type","submit",1,"px-6","py-2","bg-lime-500","text-slate-900","font-semibold","rounded-lg","hover:bg-lime-400","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"disabled"],["type","button",1,"px-6","py-2","border","border-white/20","text-white/70","rounded-lg","hover:border-white/40","hover:text-white","transition-colors",3,"click"],[1,"block","text-sm","font-medium","text-white/90","mb-2"],[1,"flex","items-center","gap-1"],["type","button",1,"transition-colors","duration-200"],[1,"text-sm","text-white/70","mt-1"],["type","button",1,"transition-colors","duration-200",3,"click"],["viewBox","0 0 24 24",1,"w-8","h-8","text-yellow-400","fill-current"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-8","h-8","text-white/30","hover:text-yellow-400","transition-colors"],["for","description-edit",1,"block","text-sm","font-medium","text-white/90","mb-2"],["id","description-edit","name","description","rows","4","placeholder","Comparte tu experiencia con este curso...","required","",1,"w-full","px-3","py-2","bg-white/5","border","border-white/10","rounded-lg","text-white","placeholder-white/50","focus:outline-none","focus:ring-2","focus:ring-lime-400/50","focus:border-lime-400/50",3,"ngModelChange","ngModel"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-12","h-12","text-lime-400","mx-auto","mb-3"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-white/70"],[1,"mt-4","p-4","bg-white/5","rounded-lg"],[1,"text-white/80","mt-3","text-sm","whitespace-pre-wrap"],[1,"mt-4","px-4","py-2","bg-lime-500/20","text-lime-300","rounded-lg","hover:bg-lime-500/30","transition-colors","font-medium",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"text-sm","text-white/70","mb-2"],[1,"flex","items-center","justify-center","gap-2"],["viewBox","0 0 24 24",1,"w-5","h-5","text-yellow-400","fill-current"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-5","h-5","text-white/30"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-12","h-12","text-white/30","mx-auto","mb-3"],[1,"rounded-xl","border","border-white/10","bg-white/5","p-4","animate-pulse"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-10","h-10","bg-white/10","rounded-full"],[1,"space-y-1"],[1,"h-4","bg-white/10","rounded","w-24"],[1,"h-3","bg-white/10","rounded","w-16"],[1,"space-y-2"],[1,"h-3","bg-white/10","rounded","w-full"],[1,"h-3","bg-white/10","rounded","w-3/4"],[1,"rounded-xl","border","border-white/10","bg-white/5","p-4"],[1,"flex","items-start","gap-3"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-lime-400","to-lime-600","flex","items-center","justify-center","text-slate-900","font-semibold","text-sm"],[1,"flex-1"],[1,"flex","items-center","gap-2","mb-2"],[1,"font-semibold","text-white"],[1,"text-xs","text-white/60"],[1,"text-white/80","leading-relaxed","whitespace-pre-wrap"],[1,"mt-4","ml-8","pl-4","border-l-2","border-lime-500/30","bg-lime-500/5","rounded-r-lg","p-4"],[1,"mt-4","ml-8"],["viewBox","0 0 24 24",1,"w-4","h-4","text-yellow-400","fill-current"],[1,"w-8","h-8","rounded-full","bg-gradient-to-br","from-purple-400","to-purple-600","flex","items-center","justify-center","text-white","font-semibold","text-xs"],[1,"font-semibold","text-lime-300","text-sm"],[1,"px-2","py-0.5","bg-purple-500/20","text-purple-300","text-xs","rounded"],["rows","3","placeholder","Edita tu respuesta...",1,"w-full","px-3","py-2","bg-white/5","border","border-white/10","rounded-lg","text-white","text-sm","placeholder-white/50","focus:outline-none","focus:ring-2","focus:ring-lime-400/50",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"px-3","py-1","bg-lime-500","text-slate-900","text-sm","font-semibold","rounded","hover:bg-lime-400","disabled:opacity-50","transition-colors",3,"click","disabled"],[1,"px-3","py-1","border","border-white/20","text-white/70","text-sm","rounded","hover:border-white/40","transition-colors",3,"click"],[1,"animate-spin","w-3","h-3","border-2","border-slate-900","border-t-transparent","rounded-full"],[1,"text-white/80","text-sm","leading-relaxed","whitespace-pre-wrap"],[1,"flex","gap-2","mt-2"],[1,"text-xs","text-lime-400","hover:text-lime-300","transition-colors",3,"click"],[1,"text-xs","text-red-400","hover:text-red-300","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-lime-400","hover:text-lime-300","transition-colors","flex","items-center","gap-2",3,"click"],["viewBox","0 0 24 24","fill","none","stroke","currentColor",1,"w-4","h-4"],["stroke-width","2","d","M3 10h10a8 8 0 0 1 8 8v2M3 10l6 6m-6-6l6-6"],[1,"space-y-3"],[1,"text-sm","font-semibold","text-lime-300"],["rows","4","placeholder","Escribe tu respuesta al estudiante...",1,"w-full","px-3","py-2","bg-white/5","border","border-white/10","rounded-lg","text-white","text-sm","placeholder-white/50","focus:outline-none","focus:ring-2","focus:ring-lime-400/50",3,"ngModelChange","ngModel"],[1,"px-4","py-2","bg-lime-500","text-slate-900","text-sm","font-semibold","rounded","hover:bg-lime-400","disabled:opacity-50","transition-colors",3,"click","disabled"],[1,"px-4","py-2","border","border-white/20","text-white/70","text-sm","rounded","hover:border-white/40","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"animate-spin","w-4","h-4","border-2","border-slate-900","border-t-transparent","rounded-full"],[1,"text-sm","text-slate-400"],[1,"flex","gap-1"],[1,"px-3","py-1","rounded","bg-slate-700","text-slate-300","hover:bg-slate-600","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],[1,"px-3","py-1","text-slate-500"],[1,"px-3","py-1","rounded","hover:bg-slate-600","transition-colors",3,"bg-lime-500","text-slate-900","bg-slate-700","text-slate-300"],[1,"px-3","py-1","rounded","hover:bg-slate-600","transition-colors",3,"click"]],template:function(e,r){e&1&&(o(0,"div",0),m(1,Ce,13,3,"div",1),m(2,Re,5,1,"div",1),m(3,Me,5,1,"div",2),m(4,Ae,14,5,"div",1),m(5,Ue,6,2,"div",1),o(6,"div",3)(7,"h3",4),d(8),n(),m(9,We,3,1,"div",3)(10,qe,3,1,"div",5)(11,ct,3,0,"div",3),m(12,ut,10,5,"div",6),n()()),e&2&&(a(),p(r.statistics()&&r.showStatistics?1:-1),a(),p(r.shouldShowCreateForm()?2:-1),a(),p(r.shouldShowEditForm()?3:-1),a(),p(r.shouldShowAlreadyRatedMessage()?4:-1),a(),p(!r.canRate()&&r.canRateResponse()?5:-1),a(3),f(r.enableRating?"Calificaciones de estudiantes":"Comentarios"),a(),p(r.isLoading()?9:r.reviews().length===0?10:11),a(3),p(r.totalPages()>1?12:-1))},dependencies:[ie,ee,J,K,Q,te,Z,X],styles:["textarea[_ngcontent-%COMP%]:focus{outline:none}"]})};export{oe as a};
