import{a as l}from"./chunk-ESTJS734.js";import{Hc as o,Jc as m,O as p,T as d,ec as t,fc as s,ja as a,o as i}from"./chunk-6JS7X5LE.js";var c=class r{http=d(m);apiUrl=`${l.url}instructor`;_paymentConfig=a(null);_isLoadingPaymentConfig=a(!1);_paymentConfigError=a(null);paymentConfig=t(()=>this._paymentConfig());isLoadingPaymentConfig=t(()=>this._isLoadingPaymentConfig());paymentConfigError=t(()=>this._paymentConfigError());earningsStatusInput=a(void 0);earningsStartDateInput=a(void 0);earningsEndDateInput=a(void 0);earningsPageInput=a(1);earningsLimitInput=a(10);earningsResource=s({loader:()=>{let e=new o,n=this.earningsStatusInput();n&&(e=e.set("status",n));let g=this.earningsStartDateInput();g&&(e=e.set("startDate",g));let u=this.earningsEndDateInput();return u&&(e=e.set("endDate",u)),e=e.set("page",this.earningsPageInput().toString()),e=e.set("limit",this.earningsLimitInput().toString()),i(this.http.get(`${this.apiUrl}/earnings`,{params:e}))}});earnings=t(()=>this.earningsResource.value()?.earnings??[]);earningsPagination=t(()=>this.earningsResource.value()?.pagination??null);isLoadingEarnings=t(()=>this.earningsResource.isLoading());earningsError=t(()=>this.earningsResource.error());statsReloadTrigger=a(0);statsResource=s({loader:()=>(this.statsReloadTrigger(),i(this.http.get(`${this.apiUrl}/earnings/stats`)))});earningsStats=t(()=>{let e=this.statsResource.value();if(!e)return null;let n=e.stats;return{pending:n.pending||{total:0,count:0},available:n.available||{total:0,count:0},paid:n.paid||{total:0,count:0},refunds:n.refunds||{total:0,count:0},total:n.total||{total:0,count:0},total_earned:n.total?.total||0,total_sales:n.totalCoursesSold||0,average_per_sale:parseFloat(n.averagePerSale||0),earnings_by_month:n.byMonth||[]}});isLoadingStats=t(()=>this.statsResource.isLoading());statsError=t(()=>this.statsResource.error());paymentHistoryPageInput=a(1);paymentHistoryLimitInput=a(10);paymentHistoryResource=s({loader:()=>{let e=new o().set("page",this.paymentHistoryPageInput().toString()).set("limit",this.paymentHistoryLimitInput().toString());return i(this.http.get(`${this.apiUrl}/payments/history`,{params:e}))}});paymentHistory=t(()=>this.paymentHistoryResource.value()?.payments??[]);paymentHistoryPagination=t(()=>this.paymentHistoryResource.value()?.pagination??null);isLoadingPaymentHistory=t(()=>this.paymentHistoryResource.isLoading());paymentHistoryError=t(()=>this.paymentHistoryResource.error());setEarningsFilters(e){e.status!==void 0&&this.earningsStatusInput.set(e.status),e.startDate!==void 0&&this.earningsStartDateInput.set(e.startDate),e.endDate!==void 0&&this.earningsEndDateInput.set(e.endDate),e.page!==void 0&&this.earningsPageInput.set(e.page),e.limit!==void 0&&this.earningsLimitInput.set(e.limit)}clearEarningsFilters(){this.earningsStatusInput.set(void 0),this.earningsStartDateInput.set(void 0),this.earningsEndDateInput.set(void 0),this.earningsPageInput.set(1),this.earningsLimitInput.set(10)}setPaymentHistoryPage(e){this.paymentHistoryPageInput.set(e)}setPaymentHistoryLimit(e){this.paymentHistoryLimitInput.set(e)}reloadPaymentConfig(){this._isLoadingPaymentConfig.set(!0),this._paymentConfigError.set(null),this.http.get(`${this.apiUrl}/payment-config`).subscribe({next:e=>{this._paymentConfig.set(e.config),this._isLoadingPaymentConfig.set(!1)},error:e=>{console.error("\u274C [Service] Error al cargar config:",e),this._paymentConfigError.set(e),this._isLoadingPaymentConfig.set(!1)}})}reloadEarnings(){this.earningsResource.reload()}reloadStats(){this.statsReloadTrigger.update(e=>e+1)}reloadPaymentHistory(){this.paymentHistoryResource.reload()}connectPaypal(e){return this.http.post(`${this.apiUrl}/payment-config/paypal/connect`,{code:e})}updatePaypalConfig(e){return this.http.post(`${this.apiUrl}/payment-config/paypal`,e)}updatePreferredMethod(e){return this.http.put(`${this.apiUrl}/payment-config`,{preferred_payment_method:e})}deletePaypalConfig(){return this.http.delete(`${this.apiUrl}/payment-config/paypal`)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})};export{c as a};
