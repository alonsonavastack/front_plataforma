import{b as D}from"./chunk-C4QL5PZB.js";import{a as u}from"./chunk-ZGVWU7EJ.js";import{Gc as _,Jc as m,O as f,T as g,ec as c,fc as d,ja as v,n as h,o as y}from"./chunk-6JS7X5LE.js";import{a as b}from"./chunk-I4MTPUBM.js";var R=class l{http=g(m);API_URL=`${u.url}checkout`;configReloadTrigger=v(0);paymentConfigResource=d({loader:()=>(this.configReloadTrigger(),y(this.http.get(`${u.url}payment-settings/public`)))});countriesResource=d({loader:()=>(this.configReloadTrigger(),y(this.http.get(`${u.url}system-config/supported-countries`)))});paymentConfig=c(()=>this.paymentConfigResource.value()?.settings??null);supportedCountries=c(()=>this.countriesResource.value()?.countries??[]);isLoadingConfig=c(()=>this.paymentConfigResource.isLoading()||this.countriesResource.isLoading());availablePaymentMethods=c(()=>{let e=this.paymentConfig();return e?[{id:"wallet",name:"Billetera Digital",icon:"\u{1F4B0}",description:"Usa tu saldo disponible de forma instant\xE1nea"},{id:"stripe",name:"Tarjeta de Cr\xE9dito / D\xE9bito",icon:"\u{1F4B3}",description:"Visa, Mastercard, AMEX \u2014 procesado por Stripe"}].filter(r=>r.id==="wallet"?!0:r.id==="stripe"?e.stripe?.active!==!1:!1):[{id:"wallet",name:"Billetera Digital",icon:"\u{1F4B0}",description:"Usa tu saldo disponible de forma instant\xE1nea"},{id:"stripe",name:"Tarjeta de Cr\xE9dito / D\xE9bito",icon:"\u{1F4B3}",description:"Visa, Mastercard, AMEX \u2014 procesado por Stripe"}]});processSale(e){return this.http.post(`${this.API_URL}/register`,e)}processWalletPayment(e){return e.method_payment="wallet",this.processSale(e)}generateTransactionNumber(){let e=Date.now(),t=Math.random().toString(36).substring(2,10).toUpperCase();return`TXN-${e}-${t}`}getExchangeRate(){return 3.66}reloadConfig(){this.configReloadTrigger.update(e=>e+1)}static \u0275fac=function(t){return new(t||l)};static \u0275prov=f({token:l,factory:l.\u0275fac,providedIn:"root"})};var j=class l{http=g(m);authService=g(D);API_URL=`${u.url}profile-student`;profileResource=d({loader:async()=>{if(!this.authService.token())return null;let t=Date.now();return await h(this.http.get(`${this.API_URL}/client?_=${t}`))}});refundsResource=d({loader:async()=>{if(!this.authService.token())return[];let t=Date.now();return await h(this.http.get(`${u.url}refunds/list?_=${t}`))}});profileData=c(()=>{let e=this.profileResource.value(),t=this.refundsResource.value();if(!e)return null;if(!t||t.length===0)return e;let r=b({},e);if(r.enrolled_courses?.length>0){let a=new Map;t.forEach(n=>{if(n.status==="completed"&&n.course){let o=typeof n.course=="string"?n.course:n.course._id,i=new Date(n.completedAt||n.createdAt);o&&a.set(o,i)}}),r.enrolled_courses=r.enrolled_courses.filter(n=>{let o=n.course._id,i=new Date(n.createdAt);if(!a.has(o))return!0;let s=a.get(o);return i>s}),r.enrolled_course_count=r.enrolled_courses.length,r.actived_course_count=r.enrolled_courses.filter(n=>n.state===1).length,r.termined_course_count=r.enrolled_courses.filter(n=>n.state===2).length}if(r.projects?.length>0){let a=new Map;t.forEach(o=>{if(o.status==="completed"&&o.project){let i=typeof o.project=="string"?o.project:o.project._id,s=new Date(o.completedAt||o.createdAt);i&&a.set(i,s)}});let n=new Map;r.sales?.forEach(o=>{o.detail?.forEach(i=>{if(i.product_type==="project"){let s=typeof i.product=="string"?i.product:i.product?._id,p=new Date(o.createdAt);s&&(!n.has(s)||p>n.get(s))&&n.set(s,p)}})}),r.projects=r.projects.filter(o=>{let i=o._id;if(!a.has(i))return!0;let s=a.get(i),p=n.get(i);return p&&p>s})}return r});isLoading=c(()=>this.profileResource.isLoading()||this.refundsResource.isLoading());refunds=c(()=>this.refundsResource.value()||[]);reloadProfile(){this.profileResource.reload(),this.refundsResource.reload()}loadProfile(){return this.http.get(`${this.API_URL}/client?_=${Date.now()}`)}loadTransactions(){return this.http.get(`${this.API_URL}/transactions`)}requestRefund(e,t){let r=new _({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}),a={sale_id:e,product_id:t.product_id,product_type:t.product_type,reason_type:t.reason_type,reason_description:t.reason_description};return this.http.post(`${this.API_URL}/request-refund`,a,{headers:r})}uploadVoucher(e,t){let r=new FormData;return r.append("sale_id",e),r.append("imagen",t),this.http.post(`${this.API_URL}/upload-voucher`,r)}loadRefunds(){return this.http.get(`${u.url}refunds/list`)}deleteAccount(e){let t=new _({Authorization:`Bearer ${localStorage.getItem("token")}`});return this.http.delete(`${u.url}users/delete-my-account`,{headers:t,body:{password:e}})}static \u0275fac=function(t){return new(t||l)};static \u0275prov=f({token:l,factory:l.\u0275fac,providedIn:"root"})};export{R as a,j as b};
