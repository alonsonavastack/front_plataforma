import{a as b}from"./chunk-6Z75774O.js";import{b as v}from"./chunk-VTEZJ5OF.js";import{Jc as m,K as l,O as f,T as p,ec as s,ja as h}from"./chunk-6JS7X5LE.js";import{a,b as c}from"./chunk-I4MTPUBM.js";var g=class n{http=p(m);authService=p(v);base=b.url;state=h({data:null,isLoading:!1,error:null});profile=s(()=>this.state().data?.profile);isLoading=s(()=>this.state().isLoading);enrolledCourses=s(()=>this.state().data?.enrolled_courses??[]);purchasedProjects=s(()=>this.state().data?.projects??[]);reloadProfile(){this.authService.isLoggedIn()&&(this.state.update(t=>c(a({},t),{isLoading:!0})),this.http.get(`${this.base}profile-student/client`).subscribe({next:t=>this.state.set({data:t,isLoading:!1,error:null}),error:t=>this.state.set({data:null,isLoading:!1,error:t})}))}update(t){let i=this.authService.user(),e="";return i?.rol==="admin"?e="users/update":i?.rol==="instructor"?e="profile-instructor/update":i?.rol==="cliente"?e="profile-student/update":e="users/update",this.http.put(`${this.base}${e}`,t).pipe(l(r=>{let u=r.profile||r.user||r;u&&(this.authService.user.update(o=>a(a({},o),u)),this.reloadProfile())}))}updateAvatar(t){let i=new FormData;i.append("avatar",t);let e=this.authService.user(),r="";return e?.rol==="admin"?r="users/update":e?.rol==="instructor"?r="profile-instructor/update":e?.rol==="cliente"?r="profile-student/update-avatar":r="users/update",(e?.rol==="admin"||e?.rol==="instructor"?this.http.post(`${this.base}${r}`,i):this.http.put(`${this.base}${r}`,i)).pipe(l(o=>{let d=o.user||o;d&&this.authService.user.update(y=>a(a({},y),d))}))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})};export{g as a};
