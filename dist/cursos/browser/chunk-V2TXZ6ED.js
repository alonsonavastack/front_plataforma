import{a as me}from"./chunk-KBA3WCNC.js";import{b as ce}from"./chunk-N2VNJZVV.js";import{a as ve}from"./chunk-NOVASSOE.js";import{c as se,e as de}from"./chunk-UKUKXRH6.js";import{b as ue,d as pe,i as ge,p as _e,q as xe,r as fe,w as he}from"./chunk-SDJWNAN2.js";import{a as B}from"./chunk-M2BUHLXO.js";import{$ as E,$b as k,Ac as le,Eb as J,Gb as l,Ha as H,Hb as v,Hc as z,Ib as C,Jb as Q,Jc as re,K as U,Kb as X,Lb as N,Ma as r,Mb as A,Nb as j,O,Rb as K,Sb as ee,T,Xa as Z,Y as w,Z as I,Zb as te,_ as g,_b as S,ac as F,ec as b,fb as q,fc as ne,hb as m,ib as u,ja as f,ka as Y,kb as G,lb as P,mb as V,nb as _,o as W,ob as i,pb as a,qb as p,ub as M,uc as ie,wb as h,wc as ae,yb as c,yc as oe}from"./chunk-6JS7X5LE.js";var $=class n{http=T(re);API_URL=B.url;searchInput=f("");statusInput=f("");monthInput=f("");yearInput=f("");excludeRefundedInput=f(!1);salesResource=ne({loader:()=>{let t=new z().set("search",this.searchInput()).set("status",this.statusInput()).set("month",this.monthInput()).set("year",this.yearInput()).set("exclude_refunded",this.excludeRefundedInput()?"true":""),e=new z,o=this.searchInput();o&&(e=e.set("search",o));let s=this.statusInput();s&&(e=e.set("status",s));let d=this.monthInput();d&&(e=e.set("month",d));let y=this.yearInput();return y&&(e=e.set("year",y)),this.excludeRefundedInput()&&(e=e.set("exclude_refunded","true")),W(this.http.get(`${this.API_URL}checkout/list`,{params:e}))}});sales=b(()=>this.salesResource.value()?.sales??[]);isLoading=b(()=>this.salesResource.isLoading());error=b(()=>this.salesResource.error());hasError=b(()=>this.salesResource.hasValue()===!1&&!this.salesResource.isLoading());stats=b(()=>{let t=this.sales(),e=t.filter(x=>!x.refund||x.refund.status!=="completed"),o=t.filter(x=>x.refund?.status==="completed"),s=e.filter(x=>x.status==="Pagado").reduce((x,R)=>x+R.total,0),d=o.reduce((x,R)=>x+(R.refund?.calculations?.refundAmount||R.total||0),0),y=s,D=e.length,L={pagado:e.filter(x=>x.status==="Pagado").length,pendiente:e.filter(x=>x.status==="Pendiente").length,anulado:e.filter(x=>x.status==="Anulado").length,reembolsado:o.length};return{totalIngresos:s,totalVentas:D,porEstado:L,totalReembolsado:d,ingresosNetos:y}});statsByInstructor=b(()=>{let t=this.sales(),e=new Map;return t.forEach(o=>{o.status==="Pagado"&&o.detail?.forEach(s=>{if(s.product_type==="course"&&s.product?.user){let d=s.product.user,y,D;if(typeof d=="string"?(y=d,D="Instructor"):(y=d._id||"",D=d.name?`${d.name} ${d.surname||""}`.trim():"Instructor"),!y)return;e.has(y)||e.set(y,{instructorId:y,instructorName:D,totalVentas:0,totalIngresos:0});let L=e.get(y);L.totalVentas+=1,L.totalIngresos+=s.price_unit}})}),Array.from(e.values()).sort((o,s)=>s.totalIngresos-o.totalIngresos)});setFilters(t){t.search!==void 0&&this.searchInput.set(t.search),t.status!==void 0&&this.statusInput.set(t.status),t.month!==void 0&&this.monthInput.set(t.month),t.year!==void 0&&this.yearInput.set(t.year),t.excludeRefunded!==void 0&&this.excludeRefundedInput.set(t.excludeRefunded)}clearFilters(){this.searchInput.set(""),this.statusInput.set(""),this.monthInput.set(""),this.yearInput.set(""),this.excludeRefundedInput.set(!1)}reload(){this.salesResource.reload()}updateSaleStatus(t,e){return this.http.put(`${this.API_URL}checkout/update-status/${t}`,{status:e}).pipe(U(()=>this.reload()))}getMyTransactions(){return this.http.get(`${this.API_URL}checkout/my-transactions`)}getTransactionByNumber(t){return this.http.get(`${this.API_URL}checkout/transaction/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"})};var Se=(n,t,e,o,s)=>({"bg-green-500/10 text-green-400 ring-1 ring-green-500/30":n,"bg-yellow-500/10 text-yellow-400 ring-1 ring-yellow-500/30":t,"bg-blue-500/10 text-blue-400 ring-1 ring-blue-500/30":e,"bg-red-500/10 text-red-400 ring-1 ring-red-500/30":o,"bg-slate-700/50 text-slate-400 ring-1 ring-slate-600":s}),ye=(n,t)=>t.value,we=(n,t)=>t.instructorId,Ie=(n,t)=>t._id,Ee=(n,t)=>t.product._id;function Me(n,t){n&1&&l(0," Ventas de tus cursos y proyectos ")}function Te(n,t){n&1&&l(0," Gestiona y revisa todas las transacciones ")}function ke(n,t){n&1&&(i(0,"div",6),g(),i(1,"svg",53),p(2,"path",54),a(),E(),i(3,"span"),l(4,"Solo se muestran las ventas que incluyen tus productos"),a()())}function Pe(n,t){if(n&1){let e=M();i(0,"button",55),h("click",function(){w(e);let s=c();return I(s.exportSales())}),g(),i(1,"svg",56),p(2,"path",57),a(),l(3," Exportar "),a()}}function Ve(n,t){n&1&&l(0," Mis Ingresos ")}function Fe(n,t){n&1&&l(0," Total Ingresos ")}function De(n,t){if(n&1&&(i(0,"p",15),l(1),S(2,"number"),a()),n&2){let e=c();r(),C(" \u{1F504} Reembolsado: $",F(2,1,e.stats().totalReembolsado,"1.2-2")," ")}}function Ne(n,t){n&1&&l(0," De tus productos ")}function Ae(n,t){n&1&&l(0," Ventas pagadas ")}function je(n,t){if(n&1&&(i(0,"p",16),m(1,Ne,1,0)(2,Ae,1,0),a()),n&2){let e=c();r(),u(e.isInstructor()?1:2)}}function Be(n,t){n&1&&l(0," Mis Ventas ")}function Le(n,t){n&1&&l(0," Total Ventas ")}function Re(n,t){n&1&&l(0," Con tus productos ")}function $e(n,t){n&1&&l(0," Ventas activas ")}function He(n,t){n&1&&(g(),i(0,"svg",62),p(1,"path",64),a())}function Ge(n,t){n&1&&(g(),i(0,"svg",62),p(1,"path",65),a())}function ze(n,t){if(n&1&&(i(0,"div",66)(1,"div",67)(2,"div",68),g(),i(3,"svg",69),p(4,"path",70),a()(),E(),i(5,"div",71)(6,"h4",72),l(7),a()()(),i(8,"div",73)(9,"div",74)(10,"p",75),l(11,"Ventas"),a(),i(12,"p",76),l(13),a()(),i(14,"div",74)(15,"p",75),l(16,"Ingresos"),a(),i(17,"p",77),l(18),S(19,"number"),a()()()()),n&2){let e=t.$implicit;r(7),v(e.instructorName),r(6),v(e.totalVentas),r(5),C("$",F(19,3,e.totalIngresos,"1.2-2"))}}function We(n,t){if(n&1&&(i(0,"div",63),P(1,ze,20,6,"div",66,we),a()),n&2){let e=c(2);r(),V(e.statsByInstructor())}}function Ue(n,t){if(n&1){let e=M();i(0,"div",37)(1,"div",58)(2,"div")(3,"h2",59),l(4,"Ingresos por Instructor"),a(),i(5,"p",60),l(6,"Desglose de ventas por curso"),a()(),i(7,"button",61),h("click",function(){w(e);let s=c();return I(s.toggleInstructorStats())}),m(8,He,2,0,":svg:svg",62)(9,Ge,2,0,":svg:svg",62),a()(),m(10,We,3,0,"div",63),a()}if(n&2){let e=c();r(8),u(e.showInstructorStats()?8:9),r(2),u(e.showInstructorStats()?10:-1)}}function Oe(n,t){if(n&1&&(i(0,"option",48),l(1),a()),n&2){let e=t.$implicit;_("value",e.value),r(),v(e.label)}}function Ye(n,t){if(n&1&&(i(0,"option",48),l(1),a()),n&2){let e=t.$implicit;_("value",e),r(),v(e)}}function Ze(n,t){if(n&1){let e=M();i(0,"div",50)(1,"div",78),l(2),a(),i(3,"div",79)(4,"label",80),l(5,"Mostrar:"),a(),i(6,"select",81),h("change",function(s){w(e);let d=c();return I(d.changePerPage(+s.target.value))}),i(7,"option",48),l(8,"10"),a(),i(9,"option",48),l(10,"15"),a(),i(11,"option",48),l(12,"20"),a()()()()}if(n&2){let e=c();r(2),X(" Mostrando ",(e.currentPage()-1)*e.itemsPerPage()+1," - ",e.Math.min(e.currentPage()*e.itemsPerPage(),e.sales().length)," de ",e.sales().length," ventas "),r(4),_("value",e.itemsPerPage()),r(),_("value",10),r(2),_("value",15),r(2),_("value",20)}}function qe(n,t){n&1&&(i(0,"div",51),p(1,"div",82),i(2,"p",83),l(3,"Cargando ventas..."),a()())}function Je(n,t){n&1&&(i(0,"th",88),l(1,"Acciones"),a())}function Qe(n,t){}function Xe(n,t){if(n&1&&(i(0,"span",101),l(1),S(2,"mxnCurrency"),a()),n&2){let e=c().$implicit;r(),C(" ",k(2,1,e.total)," ")}}function Ke(n,t){if(n&1&&(i(0,"div",102)(1,"span",109),g(),i(2,"svg",110),p(3,"path",111),a(),l(4),S(5,"mxnCurrency"),a(),E(),i(6,"div",112)(7,"span",113),l(8),a(),i(9,"span",114),l(10),S(11,"mxnCurrency"),a(),i(12,"div",115),l(13),S(14,"mxnCurrency"),a()()()),n&2){let e=c().$implicit;r(4),C(" -",k(5,5,e.wallet_amount)," (Wallet) "),r(4),C(" ",e.status==="Pagado"?"Transferencia/Otro":"Por pagar",": "),r(),_("ngClass",e.status==="Pagado"?"text-white":"text-yellow-400"),r(),C(" ",k(11,7,e.total-e.wallet_amount)," "),r(3),C(" ",k(14,9,e.total-e.wallet_amount)," ")}}function et(n,t){if(n&1&&(i(0,"span",103),g(),i(1,"svg",110),p(2,"path",116),a(),l(3),S(4,"number"),a()),n&2){let e=c().$implicit;r(3),C(" $",F(4,1,(e.refund==null||e.refund.calculations==null?null:e.refund.calculations.refundAmount)??e.total,"1.2-2")," ")}}function tt(n,t){n&1&&(i(0,"span",106),g(),i(1,"svg",110),p(2,"path",35),a(),l(3," REEMBOLSADO "),a())}function nt(n,t){if(n&1&&(i(0,"a",119),g(),i(1,"svg",110),p(2,"path",124)(3,"path",125),a(),l(4," Ver Voucher "),a()),n&2){let e=c(3).$implicit,o=c(2);_("href",o.buildVoucherUrl(e.voucher_image),H)}}function it(n,t){n&1&&p(0,"div",123)}function at(n,t){n&1&&(i(0,"span"),l(1,"Aprobar"),a())}function ot(n,t){if(n&1){let e=M();i(0,"button",126),h("click",function(){w(e);let s=c(3).$implicit,d=c(2);return I(d.updateStatus(s._id,"Pagado"))}),m(1,it,1,0,"div",123)(2,at,2,0,"span"),a()}if(n&2){let e=c(3).$implicit,o=c(2);_("disabled",o.updatingStatusId()===e._id),r(),u(o.updatingStatusId()===e._id&&o.currentStatusAction()==="Pagado"?1:2)}}function lt(n,t){n&1&&p(0,"div",123)}function rt(n,t){n&1&&(i(0,"span"),l(1,"Cancelar"),a())}function st(n,t){if(n&1){let e=M();i(0,"div",117),m(1,nt,5,1,"a",119),i(2,"div",120),m(3,ot,3,2,"button",121),i(4,"button",122),h("click",function(){w(e);let s=c(2).$implicit,d=c(2);return I(d.updateStatus(s._id,"Anulado"))}),m(5,lt,1,0,"div",123)(6,rt,2,0,"span"),a()()()}if(n&2){let e=c(2).$implicit,o=c(2);r(),u(e.voucher_image?1:-1),r(2),u(e.status==="En Revisi\xF3n"?3:-1),r(),_("disabled",o.updatingStatusId()===e._id),r(),u(o.updatingStatusId()===e._id&&o.currentStatusAction()==="Anulado"?5:6)}}function dt(n,t){n&1&&(i(0,"span",118),l(1,"-"),a())}function ct(n,t){if(n&1&&(i(0,"td",98),m(1,st,7,4,"div",117)(2,dt,2,0,"span",118),a()),n&2){let e=c().$implicit;r(),u(e.status==="Pendiente"||e.status==="En Revisi\xF3n"?1:2)}}function mt(n,t){if(n&1&&(i(0,"div",130),p(1,"img",131),i(2,"div",132)(3,"p",133),l(4),a(),i(5,"p",78),l(6),a()(),i(7,"div",134)(8,"p",135),l(9),S(10,"mxnCurrency"),a(),i(11,"p",136),l(12),S(13,"mxnCurrency"),a()()()),n&2){let e=t.$implicit,o=c(4);r(),_("alt",K(e.product.title))("src",o.getProductImageUrl(e),H),r(3),v(e.product.title||"Producto no disponible"),r(2),v(e.product_type==="course"?"Curso":"Proyecto"),r(3),v(k(10,7,e.price_unit)),r(3),v(k(13,9,e.price_unit))}}function ut(n,t){if(n&1&&(i(0,"tr",108)(1,"td",127)(2,"h4",128),l(3,"Productos en esta venta:"),a(),i(4,"div",129),P(5,mt,14,11,"div",130,Ee),a()()()),n&2){let e=c().$implicit,o=c(2);r(),q("colspan",o.isAdmin()?7:6),r(4),V(e.detail)}}function pt(n,t){if(n&1){let e=M();i(0,"tr",91)(1,"td",92)(2,"button",93),h("click",function(){let s=w(e).$implicit,d=c(2);return I(d.toggleDetails(s._id))}),l(3),a()(),i(4,"td",94),l(5),a(),i(6,"td",92)(7,"div",95)(8,"div",96)(9,"p",97),l(10),a(),i(11,"p",75),l(12),a()()()(),i(13,"td",98)(14,"div",99)(15,"span",100),l(16),S(17,"mxnCurrency"),a(),m(18,Xe,3,3,"span",101),m(19,Ke,15,11,"div",102),m(20,et,5,4,"span",103),a()(),i(21,"td",98)(22,"div",104)(23,"span",105),l(24),a(),m(25,tt,4,0,"span",106),a()(),i(26,"td",107),l(27),S(28,"date"),a(),m(29,ct,3,1,"td",98),a(),m(30,ut,7,1,"tr",108)}if(n&2){let e=t.$implicit,o=c(2);_("id",ee("sale-",e._id)),r(3),C(" ",o.isDetailsVisible(e._id)?"Ocultar":"Ver"," "),r(2),v(e.n_transaccion),r(5),Q("",e.user.name," ",e.user.surname),r(2),v(e.user.email),r(3),_("ngClass",(e.refund==null?null:e.refund.status)==="completed"?"line-through text-slate-500":"text-white"),r(),C(" ",k(17,18,e.total)," "),r(2),u(e.status!=="Anulado"&&(!e.refund||e.refund.status!=="completed")?18:-1),r(),u(e.wallet_amount>0?19:-1),r(),u((e.refund==null?null:e.refund.status)==="completed"?20:-1),r(3),_("ngClass",te(23,Se,e.status==="Pagado"&&!e.refund,e.status==="Pendiente",e.status==="En Revisi\xF3n",e.status==="Anulado",(e.refund==null?null:e.refund.status)==="completed")),r(),C(" ",e.status," "),r(),u((e.refund==null?null:e.refund.status)==="completed"?25:-1),r(2),v(F(28,20,e.createdAt,"dd/MM/yyyy HH:mm")),r(2),u(o.isAdmin()?29:-1),r(),u(o.isDetailsVisible(e._id)?30:-1)}}function gt(n,t){if(n&1){let e=M();i(0,"button",143),h("click",function(){w(e);let s=c().$implicit,d=c(3);return I(d.changePage(s))}),l(1),a()}if(n&2){let e=c().$implicit,o=c(3);J("bg-lime-400",e===o.currentPage())("text-slate-900",e===o.currentPage())("bg-slate-800",e!==o.currentPage())("text-white",e!==o.currentPage()),r(),C(" ",e," ")}}function _t(n,t){n&1&&(i(0,"span",142),l(1,"\u2026"),a())}function xt(n,t){if(n&1&&m(0,gt,2,9,"button",141)(1,_t,2,0,"span",142),n&2){let e=t.$implicit;u(typeof e=="number"?0:1)}}function ft(n,t){if(n&1){let e=M();i(0,"div",90)(1,"button",137),h("click",function(){w(e);let s=c(2);return I(s.previousPage())}),g(),i(2,"svg",56),p(3,"path",138),a(),E(),i(4,"span"),l(5,"Anterior"),a()(),i(6,"div",139),P(7,xt,2,1,null,null,G),a(),i(9,"button",137),h("click",function(){w(e);let s=c(2);return I(s.nextPage())}),i(10,"span"),l(11,"Siguiente"),a(),g(),i(12,"svg",56),p(13,"path",140),a()()()}if(n&2){let e=c(2);r(),_("disabled",e.currentPage()===1),r(6),V(e.pageNumbers()),r(2),_("disabled",e.currentPage()===e.totalPages())}}function ht(n,t){if(n&1&&(i(0,"div",84)(1,"table",85)(2,"thead")(3,"tr",86)(4,"th",87),l(5,"Detalles"),a(),i(6,"th",87),l(7,"Transacci\xF3n"),a(),i(8,"th",87),l(9,"Cliente"),a(),i(10,"th",88),l(11,"Total"),a(),i(12,"th",88),l(13,"Estado"),a(),i(14,"th",87),l(15,"Fecha"),a(),m(16,Je,2,0,"th",88)(17,Qe,0,0),a()(),i(18,"tbody",89),P(19,pt,31,29,null,null,Ie),a()()(),m(21,ft,14,2,"div",90)),n&2){let e=c();r(16),u(e.isAdmin()?16:17),r(3),V(e.paginatedSales()),r(2),u(e.totalPages()>1?21:-1)}}function vt(n,t){if(n&1){let e=M();i(0,"div",52)(1,"h3",144),l(2,"No se encontraron ventas con los filtros aplicados"),a(),i(3,"p",145),l(4,"Intenta ajustar o limpiar los filtros para ver m\xE1s resultados."),a(),i(5,"button",146),h("click",function(){w(e);let s=c();return I(s.clearFilters())}),l(6," Limpiar filtros "),a()()}}function Ct(n,t){n&1&&l(0," A\xFAn no tienes ventas registradas de tus cursos y proyectos. ")}function bt(n,t){n&1&&l(0," A\xFAn no se ha registrado ninguna transacci\xF3n. ")}function St(n,t){if(n&1&&(i(0,"div",52),g(),i(1,"svg",147),p(2,"path",148),a(),E(),i(3,"h3",144),l(4,"No se encontraron ventas"),a(),i(5,"p",145),m(6,Ct,1,0)(7,bt,1,0),a()()),n&2){let e=c();r(6),u(e.isInstructor()?6:7)}}var Ce=class n{saleService=T($);authService=T(ce);modalService=T(ve);route=T(se);router=T(de);Math=Math;sales=this.saleService.sales;isLoading=this.saleService.isLoading;stats=this.saleService.stats;statsByInstructor=this.saleService.statsByInstructor;currentUser=this.authService.user;isAdmin=b(()=>this.currentUser()?.rol==="admin");isInstructor=b(()=>this.currentUser()?.rol==="instructor");searchTerm=f("");statusFilter=f("");selectedMonth=f("");selectedYear=f(new Date().getFullYear().toString());months=[{value:"1",label:"Enero"},{value:"2",label:"Febrero"},{value:"3",label:"Marzo"},{value:"4",label:"Abril"},{value:"5",label:"Mayo"},{value:"6",label:"Junio"},{value:"7",label:"Julio"},{value:"8",label:"Agosto"},{value:"9",label:"Septiembre"},{value:"10",label:"Octubre"},{value:"11",label:"Noviembre"},{value:"12",label:"Diciembre"}];years=b(()=>{let t=new Date().getFullYear();return Array.from({length:5},(e,o)=>t-o)});expandedSales=new Set;updatingStatusId=f(null);currentStatusAction=f(null);showInstructorStats=f(!1);currentPage=f(1);itemsPerPage=f(10);paginatedSales=b(()=>{let t=this.sales()||[],e=this.currentPage(),o=this.itemsPerPage(),s=(e-1)*o,d=s+o;return t.slice(s,d)});totalPages=b(()=>{let t=this.sales()?.length||0;return Math.ceil(t/this.itemsPerPage())});pageNumbers=b(()=>{let t=this.totalPages();if(t<=7)return Array.from({length:t},(s,d)=>d+1);let e=this.currentPage(),o=[1];e>3&&o.push("...");for(let s=Math.max(2,e-1);s<=Math.min(t-1,e+1);s++)o.push(s);return e<t-2&&o.push("..."),o.push(t),o});changePage(t){t<1||t>this.totalPages()||this.currentPage.set(t)}previousPage(){this.changePage(this.currentPage()-1)}nextPage(){this.changePage(this.currentPage()+1)}changePerPage(t){this.itemsPerPage.set(t),this.currentPage.set(1)}constructor(){Y(()=>{let t=this.route.snapshot.queryParams;t.status&&this.applyFilterFromNotification(t.status,t.saleId)})}ngOnInit(){this.route.queryParams.subscribe(t=>{t.status?this.applyFilterFromNotification(t.status,t.saleId):this.applyFilters()})}applyFilterFromNotification(t,e){this.statusFilter.set(t),this.saleService.setFilters({status:t}),this.currentPage.set(1),e&&setTimeout(()=>{this.expandedSales.add(e);let o=document.getElementById(`sale-${e}`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("ring-2","ring-lime-400","ring-offset-2","ring-offset-slate-900"),setTimeout(()=>{o.classList.remove("ring-2","ring-lime-400","ring-offset-2","ring-offset-slate-900")},2e3))},300),this.router.navigate([],{relativeTo:this.route,queryParams:{status:null,saleId:null},queryParamsHandling:"merge",replaceUrl:!0})}applyFilters(){this.saleService.setFilters({search:this.searchTerm()||void 0,status:this.statusFilter()||void 0,month:this.selectedMonth()||void 0,year:this.selectedYear()||void 0}),this.currentPage.set(1)}clearFilters(){this.searchTerm.set(""),this.statusFilter.set(""),this.selectedMonth.set(""),this.selectedYear.set(new Date().getFullYear().toString()),this.saleService.clearFilters(),this.currentPage.set(1)}toggleDetails(t){this.expandedSales.has(t)?this.expandedSales.delete(t):this.expandedSales.add(t)}isDetailsVisible(t){return this.expandedSales.has(t)}getProductImageUrl(t){if(!t.product?.imagen)return"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMWUyOTNiIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzY0NzQ4YiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlbjwvdGV4dD48L3N2Zz4=";let e=t.product_type==="course"?"courses/imagen-course":"projects/imagen-project";return`${B.url}${e}/${t.product.imagen}`}async updateStatus(t,e){let o=`\xBFEst\xE1s seguro de que quieres cambiar el estado a "${e}"?`;await this.modalService.confirm({title:"Confirmar Acci\xF3n",message:o,icon:"warning",confirmText:"S\xED, cambiar",cancelText:"Cancelar"})&&(this.updatingStatusId.set(t),this.currentStatusAction.set(e),this.saleService.updateSaleStatus(t,e).subscribe({next:()=>{},error:d=>{this.modalService.alert({title:"Error",message:"Ocurri\xF3 un error al actualizar el estado.",icon:"error"})},complete:()=>{this.updatingStatusId.set(null),this.currentStatusAction.set(null)}}))}toggleInstructorStats(){this.showInstructorStats.update(t=>!t)}buildVoucherUrl(t){return t?`${B.url}sales/voucher-image/${t}`:""}exportSales(){alert("Funcionalidad de exportaci\xF3n pr\xF3ximamente disponible")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=Z({type:n,selectors:[["app-sales"]],decls:114,vars:24,consts:[[1,"bg-slate-950","text-white","min-h-screen"],[1,"container","mx-auto","p-4","sm:p-6","lg:p-8"],[1,"mb-8"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-white"],[1,"text-slate-400","mt-1"],[1,"mt-3","flex","items-center","gap-2","text-xs","text-lime-400"],[1,"flex","items-center","gap-2","px-4","py-2","bg-lime-400","text-slate-900","font-semibold","rounded-lg","hover:bg-lime-300","transition"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-5","gap-6","mb-8"],[1,"bg-gradient-to-br","from-lime-500/20","to-lime-600/10","border","border-lime-500/30","rounded-2xl","p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"w-12","h-12","rounded-xl","bg-lime-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-lime-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-slate-400","text-sm","font-medium","mb-1"],[1,"text-xs","text-orange-400","mt-2"],[1,"text-lime-400","text-sm","mt-2"],[1,"bg-gradient-to-br","from-cyan-500/20","to-cyan-600/10","border","border-cyan-500/30","rounded-2xl","p-6"],[1,"w-12","h-12","rounded-xl","bg-cyan-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-cyan-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"],[1,"text-cyan-400","text-sm","mt-2"],[1,"bg-gradient-to-br","from-green-500/20","to-green-600/10","border","border-green-500/30","rounded-2xl","p-6"],[1,"w-12","h-12","rounded-xl","bg-green-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-green-400","text-sm","mt-2"],[1,"bg-gradient-to-br","from-yellow-500/20","to-yellow-600/10","border","border-yellow-500/30","rounded-2xl","p-6"],[1,"w-12","h-12","rounded-xl","bg-yellow-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-yellow-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-yellow-400","text-sm","mt-2"],[1,"bg-gradient-to-br","from-orange-500/20","to-orange-600/10","border","border-orange-500/30","rounded-2xl","p-6"],[1,"w-12","h-12","rounded-xl","bg-orange-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-orange-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],[1,"text-orange-400","text-sm","mt-2"],[1,"bg-slate-900/50","border","border-white/10","rounded-2xl","p-6","mb-8"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-5","gap-4","mb-4"],[1,"lg:col-span-2"],[1,"block","text-sm","font-medium","text-slate-300","mb-2"],["type","text","placeholder","Transacci\xF3n, cliente...",1,"w-full","bg-slate-800","border","border-slate-700","text-white","text-sm","rounded-lg","focus:ring-lime-500","focus:border-lime-500","p-2.5",3,"ngModelChange","ngModel"],[1,"w-full","bg-slate-800","border","border-slate-700","text-white","text-sm","rounded-lg","focus:ring-lime-500","focus:border-lime-500","p-2.5",3,"ngModelChange","ngModel"],["value",""],["value","Pagado"],["value","Pendiente"],["value","Anulado"],[3,"value"],[1,"text-sm","text-slate-400","hover:text-lime-400","transition",3,"click"],[1,"flex","flex-col","sm:flex-row","items-center","justify-between","gap-4","mb-8"],[1,"flex","justify-center","items-center","py-20"],[1,"text-center","py-20","bg-slate-900/50","border","border-white/10","rounded-2xl"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex","items-center","gap-2","px-4","py-2","bg-lime-400","text-slate-900","font-semibold","rounded-lg","hover:bg-lime-300","transition",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-xl","font-bold","text-white"],[1,"text-slate-400","text-sm","mt-1"],[1,"text-lime-400","hover:text-lime-300","transition",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 15l7-7 7 7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"bg-slate-800/50","border","border-white/5","rounded-xl","p-4"],[1,"flex","items-center","gap-3","mb-3"],[1,"w-10","h-10","rounded-full","bg-lime-500/20","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-lime-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"flex-1"],[1,"text-white","font-semibold"],[1,"grid","grid-cols-2","gap-3"],[1,"bg-slate-900/50","rounded-lg","p-3"],[1,"text-slate-400","text-xs"],[1,"text-white","font-bold"],[1,"text-lime-400","font-bold"],[1,"text-sm","text-slate-400"],[1,"flex","items-center","gap-2"],["for","items-per-page",1,"text-sm","text-slate-400"],["id","items-per-page",1,"bg-slate-800","border","border-slate-700","text-white","text-sm","rounded-lg","px-3","py-1.5","focus:ring-lime-400","focus:border-lime-400",3,"change","value"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-lime-400"],[1,"ml-4","text-slate-300"],[1,"bg-slate-900/50","border","border-white/10","rounded-2xl","overflow-x-auto"],[1,"min-w-full","leading-normal"],[1,"border-b","border-slate-700","bg-slate-800/50","text-left","text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"px-5","py-3"],[1,"px-5","py-3","text-center"],[1,"text-slate-300"],[1,"flex","items-center","justify-center","gap-4","mt-8"],[1,"border-b","border-slate-800","hover:bg-slate-800/70","transition-all","duration-300",3,"id"],[1,"px-5","py-4"],[1,"text-lime-400","hover:text-lime-300","font-medium","text-sm",3,"click"],[1,"px-5","py-4","text-sm","whitespace-nowrap","font-mono"],[1,"flex","items-center"],[1,"text-sm"],[1,"font-medium"],[1,"px-5","py-4","text-center"],[1,"flex","flex-col","items-center","gap-1"],[1,"font-semibold","text-sm",3,"ngClass"],[1,"text-xs","text-lime-400","font-mono"],[1,"flex","flex-col","items-center","text-xs","mt-1","bg-slate-800/80","p-1.5","rounded-md","border","border-slate-700"],[1,"text-xs","font-medium","text-orange-400","flex","items-center","gap-1"],[1,"flex","flex-col","items-center","gap-2"],[1,"inline-flex","items-center","gap-2","py-1.5","px-3","rounded-full","text-xs","font-medium","transition-all",3,"ngClass"],[1,"px-3","py-1","bg-gradient-to-r","from-orange-600","to-red-600","text-white","text-xs","font-bold","rounded-full","shadow-lg","flex","items-center","gap-1.5"],[1,"px-5","py-4","text-sm"],[1,"bg-slate-800/50"],[1,"text-lime-400","flex","items-center","gap-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"],[1,"mt-1","border-t","border-slate-600","pt-1","w-full","text-center"],[1,"text-[10px]","text-gray-400","block","mb-0.5"],[1,"font-bold",3,"ngClass"],[1,"text-[9px]","text-lime-400/80","font-mono"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"],[1,"flex","flex-col","gap-2"],[1,"text-slate-500","text-sm"],["target","_blank",1,"flex","items-center","justify-center","gap-1","w-full","bg-blue-600/20","hover:bg-blue-600/30","text-blue-400","border","border-blue-500/30","text-xs","font-bold","py-1.5","px-3","rounded-md","transition-colors","mb-1",3,"href"],[1,"flex","items-center","justify-center","gap-2"],[1,"bg-lime-500","text-slate-900","text-xs","font-bold","py-2","px-3","rounded-md","hover:bg-lime-400","disabled:bg-slate-600","disabled:cursor-not-allowed","flex","items-center","justify-center","flex-1",3,"disabled"],[1,"bg-red-500/80","text-white","text-xs","font-bold","py-2","px-3","rounded-md","hover:bg-red-500","disabled:bg-slate-600","disabled:cursor-not-allowed","flex","items-center","justify-center","flex-1",3,"click","disabled"],[1,"animate-spin","rounded-full","h-4","w-4","border-b-2","border-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"bg-lime-500","text-slate-900","text-xs","font-bold","py-2","px-3","rounded-md","hover:bg-lime-400","disabled:bg-slate-600","disabled:cursor-not-allowed","flex","items-center","justify-center","flex-1",3,"click","disabled"],[1,"p-4","border-t","border-slate-700"],[1,"text-md","font-semibold","mb-3","text-slate-300"],[1,"space-y-3"],[1,"flex","items-center","p-3","bg-slate-900","rounded-lg","border","border-slate-700"],[1,"w-24","h-16","object-cover","rounded-md","mr-4",3,"src","alt"],[1,"flex-grow"],[1,"font-bold","text-white"],[1,"text-right"],[1,"font-semibold","text-lime-400"],[1,"text-[10px]","text-lime-400/70","font-mono"],[1,"flex","items-center","gap-2","px-4","py-2","rounded-lg","border","border-slate-700","bg-slate-800","text-white","hover:bg-slate-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"hidden","md:flex","items-center","gap-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"min-w-[40px]","px-3","py-2","rounded-lg","border","border-slate-700","hover:bg-slate-700","transition-colors","font-medium","text-sm",3,"bg-lime-400","text-slate-900","bg-slate-800","text-white"],[1,"px-2","text-slate-500"],[1,"min-w-[40px]","px-3","py-2","rounded-lg","border","border-slate-700","hover:bg-slate-700","transition-colors","font-medium","text-sm",3,"click"],[1,"mt-2","text-sm","font-medium","text-slate-300"],[1,"mt-1","text-sm","text-slate-500"],[1,"mt-4","px-4","py-2","bg-lime-400","text-slate-900","font-semibold","rounded-lg","hover:bg-lime-300","transition",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",1,"mx-auto","h-12","w-12","text-slate-600"],["vector-effect","non-scaling-stroke","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"header",2)(3,"div",3)(4,"div")(5,"h1",4),l(6,"Panel de Ventas"),a(),i(7,"p",5),m(8,Me,1,0)(9,Te,1,0),a(),m(10,ke,5,0,"div",6),a(),m(11,Pe,4,0,"button",7),a()(),i(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),g(),i(16,"svg",12),p(17,"path",13),a()()(),E(),i(18,"h3",14),m(19,Ve,1,0)(20,Fe,1,0),a(),i(21,"p",4),l(22),S(23,"number"),a(),m(24,De,3,4,"p",15)(25,je,3,1,"p",16),a(),i(26,"div",17)(27,"div",10)(28,"div",18),g(),i(29,"svg",19),p(30,"path",20),a()()(),E(),i(31,"h3",14),m(32,Be,1,0)(33,Le,1,0),a(),i(34,"p",4),l(35),a(),i(36,"p",21),m(37,Re,1,0)(38,$e,1,0),a()(),i(39,"div",22)(40,"div",10)(41,"div",23),g(),i(42,"svg",24),p(43,"path",25),a()()(),E(),i(44,"h3",14),l(45,"Pagadas"),a(),i(46,"p",4),l(47),a(),i(48,"p",26),l(49,"Completadas exitosamente"),a()(),i(50,"div",27)(51,"div",10)(52,"div",28),g(),i(53,"svg",29),p(54,"path",30),a()()(),E(),i(55,"h3",14),l(56,"Pendientes"),a(),i(57,"p",4),l(58),a(),i(59,"p",31),l(60,"Por confirmar pago"),a()(),i(61,"div",32)(62,"div",10)(63,"div",33),g(),i(64,"svg",34),p(65,"path",35),a()()(),E(),i(66,"h3",14),l(67,"Reembolsadas"),a(),i(68,"p",4),l(69),a(),i(70,"p",36),l(71,"Reembolsos completados"),a()()(),m(72,Ue,11,2,"div",37),i(73,"div",37)(74,"h2",38),l(75,"Filtros de B\xFAsqueda"),a(),i(76,"div",39)(77,"div",40)(78,"label",41),l(79,"Buscar"),a(),i(80,"input",42),j("ngModelChange",function(d){return A(o.searchTerm,d)||(o.searchTerm=d),d}),h("ngModelChange",function(){return o.applyFilters()}),a()(),i(81,"div")(82,"label",41),l(83,"Estado"),a(),i(84,"select",43),j("ngModelChange",function(d){return A(o.statusFilter,d)||(o.statusFilter=d),d}),h("ngModelChange",function(){return o.applyFilters()}),i(85,"option",44),l(86,"Todos"),a(),i(87,"option",45),l(88,"Pagado"),a(),i(89,"option",46),l(90,"Pendiente"),a(),i(91,"option",47),l(92,"Anulado"),a()()(),i(93,"div")(94,"label",41),l(95,"Mes"),a(),i(96,"select",43),j("ngModelChange",function(d){return A(o.selectedMonth,d)||(o.selectedMonth=d),d}),h("ngModelChange",function(){return o.applyFilters()}),i(97,"option",44),l(98,"Todos"),a(),P(99,Oe,2,2,"option",48,ye),a()(),i(101,"div")(102,"label",41),l(103,"A\xF1o"),a(),i(104,"select",43),j("ngModelChange",function(d){return A(o.selectedYear,d)||(o.selectedYear=d),d}),h("ngModelChange",function(){return o.applyFilters()}),P(105,Ye,2,2,"option",48,G),a()()(),i(107,"button",49),h("click",function(){return o.clearFilters()}),l(108," Limpiar filtros "),a()(),m(109,Ze,13,7,"div",50),m(110,qe,4,0,"div",51),m(111,ht,22,2),m(112,vt,7,0,"div",52)(113,St,8,1,"div",52),a()()),e&2&&(r(8),u(o.isInstructor()?8:9),r(2),u(o.isInstructor()?10:-1),r(),u(o.isAdmin()?11:-1),r(8),u(o.isInstructor()?19:20),r(3),C("$",F(23,21,o.stats().totalIngresos,"1.2-2")),r(2),u(o.stats().totalReembolsado>0?24:25),r(8),u(o.isInstructor()?32:33),r(3),v(o.stats().totalVentas),r(2),u(o.isInstructor()?37:38),r(10),v(o.stats().porEstado.pagado),r(11),v(o.stats().porEstado.pendiente),r(11),v(o.stats().porEstado.reembolsado),r(3),u(o.isAdmin()&&o.statsByInstructor().length>0?72:-1),r(8),N("ngModel",o.searchTerm),r(4),N("ngModel",o.statusFilter),r(12),N("ngModel",o.selectedMonth),r(3),V(o.months),r(5),N("ngModel",o.selectedYear),r(),V(o.years()),r(4),u(o.sales().length>0?109:-1),r(),u(o.isLoading()?110:-1),r(),u(!o.isLoading()&&o.paginatedSales().length>0?111:-1),r(),u(!o.isLoading()&&o.sales().length===0&&(o.searchTerm()||o.statusFilter()||o.selectedMonth())?112:!o.isLoading()&&o.sales().length===0?113:-1))},dependencies:[le,ie,he,xe,fe,ue,_e,pe,ge,oe,ae,me],styles:["tr[data-details][_ngcontent-%COMP%]{transition:all .3s ease-in-out}tr[data-details].collapsed[_ngcontent-%COMP%]{display:none}"]})};export{Ce as a};
