import{a as i}from"./chunk-HLLCELQD.js";import{Jc as p,K as c,O as d,T as f,ec as a,j as u,ja as h,z as g}from"./chunk-6JS7X5LE.js";import{a as o,b as r}from"./chunk-I4MTPUBM.js";var m=class n{http=f(p);API_URL=`${i.url}system-config`;state=h({config:null,exchange_rate:null,isLoading:!1,error:null,logoPreloaded:!1});config=a(()=>this.state().config);exchangeRate=a(()=>this.state().exchange_rate);isLoading=a(()=>this.state().isLoading);error=a(()=>this.state().error);getConfig(){this.state().isLoading||this.state().config||(this.state.set(r(o({},this.state()),{isLoading:!0,error:null})),this.http.get(`${this.API_URL}/get-public`).pipe(c(e=>{this.state.set({config:e.config,exchange_rate:e.exchange_rate,isLoading:!1,error:null,logoPreloaded:!1}),this.preloadLogo(e.config)}),g(e=>(this.state.set(r(o({},this.state()),{isLoading:!1,error:e.error?.message||"Error al cargar configuraci\xF3n"})),u(null)))).subscribe())}updateConfig(e){return this.http.put(`${this.API_URL}/update`,e).pipe(c(t=>{this.state.set(r(o({},this.state()),{config:t.config,isLoading:!1,error:null}))}),g(t=>{throw t}))}buildLogoUrl(e){if(!e)return"https://via.placeholder.com/200x80?text=Logo";let t=e.trim();return`${i.url}system-config/logo/${t}`}buildFaviconUrl(e){if(!e)return"https://via.placeholder.com/32x32?text=Fav";let t=e.trim();return`${i.url}system-config/favicon/${t}`}resetState(){this.state.set({config:null,exchange_rate:null,isLoading:!1,error:null,logoPreloaded:!1})}preloadLogo(e){if(!e||this.state().logoPreloaded)return;let t=e.logo?this.buildLogoUrl(e.logo):null;if(!t)return;let s=new Image;s.onload=()=>{this.state.update(l=>r(o({},l),{logoPreloaded:!0}))},s.onerror=()=>{this.state.update(l=>r(o({},l),{logoPreloaded:!0}))},s.src=t}downloadBackup(){return this.http.get(`${this.API_URL}/backup/download`,{responseType:"blob",reportProgress:!0,observe:"events"})}restoreBackup(e){let t=new FormData;return t.append("file",e),this.http.post(`${this.API_URL}/backup/restore`,t,{reportProgress:!0,observe:"events"})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};
