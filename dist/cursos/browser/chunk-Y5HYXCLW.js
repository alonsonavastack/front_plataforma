import{a as $}from"./chunk-PWCTGDF2.js";import{e as L,g as N}from"./chunk-VM3MHBTU.js";import{b as z,c as w,d as A,e as G,f as H,h as U,j as B,o as j,p as R,y as q}from"./chunk-QA5A7GBQ.js";import{$ as x,Ac as F,Gb as r,Hb as S,Ib as D,Ma as s,T as P,Xa as k,Y as u,Z as g,_ as y,ec as V,fb as T,hb as m,ib as p,ja as _,ka as I,nb as h,ob as n,pb as a,qb as d,ub as v,wb as f,yb as c}from"./chunk-6JS7X5LE.js";import{a as M}from"./chunk-I4MTPUBM.js";function K(i,t){i&1&&(n(0,"div",3),d(1,"div",14),a())}function Q(i,t){if(i&1&&(n(0,"div",4),r(1),a()),i&2){let e,o=c();s(),D(" ",(e=o.error())==null?null:e.message," ")}}function W(i,t){i&1&&(n(0,"span",23),d(1,"span",27),r(2," Conectado "),a())}function X(i,t){if(i&1&&(n(0,"div",32)(1,"div",35),y(),n(2,"svg",36),d(3,"path",37),a(),x(),n(4,"span"),r(5),a()()()),i&2){let e,o=c(3);s(5),S((e=o.error())==null?null:e.message)}}function Z(i,t){i&1&&d(0,"span",44)}function ee(i,t){i&1&&r(0," Guardar ")}function te(i,t){if(i&1){let e=v();n(0,"form",38),f("ngSubmit",function(){u(e);let l=c(3);return g(l.savePaypal())}),n(1,"div")(2,"label",39),r(3,"Correo de PayPal"),a(),d(4,"input",40),a(),n(5,"div",41)(6,"button",42),f("click",function(){u(e);let l=c(3);return g(l.toggleManualEntry())}),r(7," Cancelar "),a(),n(8,"button",43),m(9,Z,1,0,"span",44)(10,ee,1,0),a()()()}if(i&2){let e=c(3);h("formGroup",e.paypalForm),s(8),h("disabled",e.paypalForm.invalid||e.isSaving()==="paypal"),s(),p(e.isSaving()==="paypal"?9:10)}}function ne(i,t){i&1&&(d(0,"span",44),n(1,"span"),r(2,"Conectando..."),a())}function ie(i,t){i&1&&(n(0,"span"),r(1,"Conectar mi cuenta PayPal"),a())}function ae(i,t){if(i&1){let e=v();n(0,"button",45),f("click",function(){u(e);let l=c(3);return g(l.initiatePaypalConnect())}),m(1,ne,3,0)(2,ie,2,0,"span"),a(),n(3,"div",46)(4,"button",47),f("click",function(){u(e);let l=c(3);return g(l.toggleManualEntry())}),r(5," \xBFProblemas para conectar? Ingr\xE9salo manualmente "),a()()}if(i&2){let e=c(3);h("disabled",e.isSaving()==="paypal"),s(),p(e.isSaving()==="paypal"?1:2)}}function oe(i,t){if(i&1){let e=v();n(0,"button",48),f("click",function(){u(e);let l=c(3);return g(l.cancelEditPaypal())}),r(1," Cancelar "),a()}}function re(i,t){if(i&1&&(n(0,"div",25)(1,"div")(2,"label",28),y(),n(3,"svg",29),d(4,"path",30),a(),r(5," Conectar con PayPal "),a(),x(),n(6,"p",31),r(7," Para recibir tus pagos de forma segura, conecta tu cuenta verificada. Ser\xE1s redirigido a PayPal para autorizar la conexi\xF3n. "),a(),m(8,X,6,1,"div",32),m(9,te,11,3,"form",33)(10,ae,6,2),a(),m(11,oe,2,0,"button",34),a()),i&2){let e,o=c(2);s(8),p(((e=o.error())==null?null:e.section)==="paypal"?8:-1),s(),p(o.manualEntryMode()?9:10),s(2),p(o.hasPaypal()?11:-1)}}function le(i,t){if(i&1){let e=v();n(0,"div",26)(1,"div",49)(2,"div",50)(3,"p",51),r(4,"Cuenta Conectada"),a(),n(5,"span",52),r(6," VERIFICADA "),a()(),n(7,"p",53),r(8),a(),n(9,"p",54),r(10,"Lista para recibir pagos autom\xE1ticos"),a()(),n(11,"div",41)(12,"button",55),f("click",function(){u(e);let l=c(2);return g(l.editPaypal())}),y(),n(13,"svg",56),d(14,"path",57),a(),r(15," Modificar "),a(),x(),n(16,"button",58),f("click",function(){u(e);let l=c(2);return g(l.confirmDeletePaypal())}),y(),n(17,"svg",59),d(18,"path",60),a()()()()}if(i&2){let e,o=c(2);s(8),S((e=o.config())==null?null:e.paypal_email)}}function se(i,t){if(i&1&&(n(0,"div",5)(1,"div",15),d(2,"div",16),n(3,"div",17)(4,"div",18)(5,"div",19),y(),n(6,"svg",20),d(7,"path",21),a()(),x(),n(8,"div")(9,"h3",22),r(10," PayPal "),m(11,W,3,0,"span",23),a(),n(12,"p",24),r(13,"Pagos internacionales r\xE1pidos y seguros"),a()()()(),m(14,re,12,3,"div",25)(15,le,19,1,"div",26),a()()),i&2){let e=c();s(11),p(e.hasPaypal()&&!e.editingPaypal()?11:-1),s(3),p(!e.hasPaypal()||e.editingPaypal()?14:15)}}function ce(i,t){i&1&&(n(0,"div",6)(1,"p",61),r(2,"No se pudo cargar la configuraci\xF3n."),a()())}function de(i,t){i&1&&(n(0,"span"),r(1,"Eliminando..."),a())}function me(i,t){i&1&&(n(0,"span"),r(1,"Eliminar"),a())}function pe(i,t){if(i&1){let e=v();n(0,"div",7)(1,"div",62)(2,"div",63)(3,"div",64),y(),n(4,"svg",65),d(5,"path",66),a()(),x(),n(6,"div",67)(7,"h3",68),r(8," Confirmar Eliminaci\xF3n "),a(),n(9,"div",2)(10,"p"),r(11,"\xBFEst\xE1s seguro de que deseas eliminar esta configuraci\xF3n de PayPal?"),a(),n(12,"p",69),r(13,"Esta acci\xF3n no se puede deshacer."),a()()()(),n(14,"div",70)(15,"button",71),f("click",function(){u(e);let l=c();return g(l.cancelDelete())}),r(16," Cancelar "),a(),n(17,"button",72),f("click",function(){u(e);let l=c();return g(l.executeDelete())}),m(18,de,2,0,"span")(19,me,2,0,"span"),a()()()()}if(i&2){let e=c();T("inert",e.showDeleteModal()?null:""),s(15),h("disabled",e.isSaving()==="delete"),s(2),h("disabled",e.isSaving()==="delete"),s(),p(e.isSaving()==="delete"?18:19)}}var O=class i{instructorPaymentService=P($);route=P(L);router=P(N);config=this.instructorPaymentService.paymentConfig;isLoading=this.instructorPaymentService.isLoadingPaymentConfig;isSaving=_("");error=_(null);success=_(null);publicSettings=_(null);paypalForm=new H({paypal_email:new U("",[w.required,w.email])});editingPaypal=_(!1);manualEntryMode=_(!1);showDeleteModal=_(!1);deleteTarget=_(null);constructor(){I(()=>{let t=this.config();t&&(t.paypal_email||t.paypal_connected)?this.populateForms(t):(this.paypalForm.reset(),this.editingPaypal.set(!1))})}ngOnInit(){let t=this.router.url||"";if(t.includes("/instructor-payment-config")&&!t.includes("/dashboard")){let o=M({},this.route.snapshot.queryParams);o.section="instructor-payment-config",this.router.navigate(["/dashboard"],{queryParams:o,replaceUrl:!0});return}this.instructorPaymentService.reloadPaymentConfig(),this.instructorPaymentService.getPublicPaymentConfig().subscribe({next:o=>{this.publicSettings.set(o.settings)},error:o=>{console.error("Error loading public settings:",o)}}),this.route.queryParams.subscribe(o=>{let l=o.code,C=o.state;l&&C&&this.handlePaypalCallback(l,C)})}initiatePaypalConnect(){let t=this.publicSettings();if(!t||!t.paypal?.active){this.error.set({section:"paypal",message:"La conexi\xF3n con PayPal no est\xE1 disponible en este momento. Contacta al administrador."});return}this.isSaving.set("paypal");let e=t.paypal.clientId,o=t.paypal.mode;if(!e){this.error.set({section:"paypal",message:"Error de configuraci\xF3n: No se encontr\xF3 el Client ID de PayPal."}),this.isSaving.set("");return}let C=`${window.location.href.split("?")[0]}?section=instructor-payment-config`,b="openid profile email",E=Math.random().toString(36).substring(7),Y=Math.random().toString(36).substring(7);localStorage.setItem("paypal_oauth_state",E);let J=`${o==="live"?"https://www.paypal.com":"https://www.sandbox.paypal.com"}/connect?response_type=code&client_id=${e}&scope=${encodeURIComponent(b)}&redirect_uri=${encodeURIComponent(C)}&state=${E}&nonce=${Y}`;window.location.href=J}handlePaypalCallback(t,e){this.isSaving.set("paypal");let o=localStorage.getItem("paypal_oauth_state");localStorage.removeItem("paypal_oauth_state"),this.router.navigate([],{queryParams:{code:null,state:null},queryParamsHandling:"merge",replaceUrl:!0});let C=`${window.location.href.split("?")[0]}?section=instructor-payment-config`;this.instructorPaymentService.connectPaypal(t,C).subscribe({next:b=>{b.success&&(this.instructorPaymentService.reloadPaymentConfig(),this.loadConfig(),this.success.set({section:"paypal",message:"\xA1Cuenta de PayPal conectada y verificada exitosamente!"}),setTimeout(()=>this.clearMessages(),5e3)),this.isSaving.set("")},error:b=>{console.error("Error connecting PayPal:",b),this.error.set({section:"paypal",message:b.error?.message||"Error al conectar la cuenta. Intenta nuevamente."}),this.isSaving.set("")}})}loadConfig(){this.instructorPaymentService.reloadPaymentConfig()}populateForms(t){t.paypal_email&&this.paypalForm.patchValue({paypal_email:t.paypal_email})}editPaypal(){this.editingPaypal.set(!0),this.clearMessages()}toggleManualEntry(){this.manualEntryMode.update(t=>!t),this.clearMessages()}cancelEditPaypal(){this.editingPaypal.set(!1),this.config()?.paypal_email&&this.paypalForm.patchValue({paypal_email:this.config().paypal_email}),this.clearMessages()}savePaypal(){if(this.paypalForm.invalid)return;this.isSaving.set("paypal"),this.clearMessages();let t={paypal_email:this.paypalForm.value.paypal_email};this.instructorPaymentService.updatePaypalConfig(t).subscribe({next:e=>{e.success?(this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"paypal",message:"Cuenta de PayPal actualizada correctamente."}),this.editingPaypal.set(!1),this.manualEntryMode.set(!1),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"paypal",message:e.message||"Error al actualizar."}),this.isSaving.set("")},error:e=>{this.error.set({section:"paypal",message:e.error?.message||"Error al conectar con el servidor."}),this.isSaving.set("")}})}confirmDeletePaypal(){this.deleteTarget.set("paypal"),this.showDeleteModal.set(!0)}deletePaypal(){this.isSaving.set("delete"),this.instructorPaymentService.deletePaypalConfig().subscribe({next:t=>{t.success?(this.paypalForm.reset(),this.editingPaypal.set(!1),this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"paypal",message:"Cuenta de PayPal eliminada correctamente."}),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"paypal",message:t.message||"Error al eliminar."}),this.isSaving.set(""),this.closeDeleteModal()},error:t=>{this.error.set({section:"paypal",message:t.error?.message||"Error al eliminar configuraci\xF3n."}),this.isSaving.set(""),this.closeDeleteModal()}})}cancelDelete(){this.showDeleteModal.set(!1),this.deleteTarget.set(null)}closeDeleteModal(){this.showDeleteModal.set(!1),this.deleteTarget.set(null)}executeDelete(){this.deletePaypal()}setPreferredMethod(t){this.isSaving.set("preferred"),this.clearMessages(),this.instructorPaymentService.updatePreferredMethod(t).subscribe({next:e=>{e.success?(this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"preferred",message:"M\xE9todo de pago preferido actualizado."}),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"preferred",message:e.message||"Error al actualizar."}),this.isSaving.set("")},error:e=>{this.error.set({section:"preferred",message:e.error?.message||"Error al conectar con el servidor."}),this.isSaving.set("")}})}clearMessages(){this.error.set(null),this.success.set(null)}hasPaypal=V(()=>{let t=this.config();return!!(t?.paypal_email||t?.paypal_connected)});static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-instructor-payment-config"]],decls:20,vars:4,consts:[[1,"space-y-8"],[1,"text-3xl","font-bold","text-slate-100"],[1,"mt-2","text-sm","text-slate-400"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-500/10","border","border-red-500/50","text-red-400","px-4","py-3","rounded-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-8"],[1,"text-center","py-12"],["aria-hidden","true",1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-4"],[1,"flex","items-start"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-blue-400","mt-0.5","mr-3","flex-shrink-0"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"text-sm","font-medium","text-blue-300","mb-1"],[1,"text-sm","text-blue-200/70"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-lime-400"],[1,"bg-slate-800/50","rounded-lg","p-6","border","border-slate-700","h-full","relative","overflow-hidden","group","hover:border-blue-500/30","transition-all"],[1,"absolute","-right-6","-top-6","w-24","h-24","bg-blue-600/10","rounded-full","group-hover:bg-blue-600/20","transition-all"],[1,"flex","items-center","justify-between","mb-6","relative","z-10"],[1,"flex","items-center","space-x-4"],[1,"bg-blue-600/20","p-3","rounded-xl","border","border-blue-500/20"],["fill","currentColor","viewBox","0 0 24 24",1,"h-8","w-8","text-blue-500"],["d","M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.946 5.05-4.336 6.794-9.067 6.794h-2.13l-2.765 17.556a.641.641 0 0 1-.633.74l-.004-.007-.406-10.28z"],[1,"text-xl","font-bold","text-slate-100","flex","items-center","gap-2"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-semibold","bg-green-500/10","text-green-400","border","border-green-500/20"],[1,"text-sm","text-slate-400"],[1,"relative","z-10","space-y-5"],[1,"relative","z-10"],[1,"w-1.5","h-1.5","rounded-full","bg-green-400","mr-1.5","animate-pulse"],[1,"block","text-sm","font-medium","text-slate-300","mb-1.5","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-[#0070BA]"],["d","M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.875.812 5.498-.773 4.125-2.854 6.42-6.526 6.42H10.51a.641.641 0 0 0-.633.527l-2.074 11.23a.64.64 0 0 1-.727.52z"],[1,"text-sm","text-slate-400","mb-4","bg-slate-900/50","p-3","rounded-lg","border","border-slate-700/50"],[1,"mb-4","bg-red-500/10","border","border-red-500/50","text-red-400","px-4","py-3","rounded-lg","text-sm"],[1,"space-y-4",3,"formGroup"],["type","button",1,"w-full","px-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors"],[1,"flex","gap-2"],["fill","none","fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-slate-300","mb-1"],["type","email","formControlName","paypal_email","placeholder","ejemplo@correo.com",1,"w-full","bg-slate-700/50","border","border-slate-600","rounded-lg","px-4","py-2.5","text-white","placeholder-slate-500","focus:ring-2","focus:ring-blue-500/50","focus:border-blue-500","outline-none","transition-all"],[1,"flex","gap-3"],["type","button",1,"flex-1","px-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors",3,"click"],["type","submit",1,"flex-1","px-4","py-2.5","bg-blue-600","hover:bg-blue-500","text-white","rounded-lg","font-bold","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"inline-block","w-4","h-4","border-2","border-white/30","border-t-white","rounded-full","animate-spin"],["type","button",1,"w-full","bg-[#0070BA]","hover:bg-[#005EA6]","text-white","font-bold","py-3","px-4","rounded-lg","transition-all","shadow-lg","flex","justify-center","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed","mb-3",3,"click","disabled"],[1,"text-center"],["type","button",1,"text-xs","text-slate-400","hover:text-blue-400","underline","transition-colors",3,"click"],["type","button",1,"w-full","px-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors",3,"click"],[1,"bg-slate-900/50","rounded-xl","p-5","mb-5","border","border-slate-700/50"],[1,"flex","justify-between","items-start","mb-2"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded","text-[10px]","font-bold","bg-blue-500/10","text-blue-400","border","border-blue-500/20"],[1,"text-lg","font-medium","text-white","truncate"],[1,"text-xs","text-slate-500","mt-1"],[1,"flex-1","py-2.5","px-4","bg-slate-700/50","hover:bg-slate-700","text-slate-200","rounded-lg","transition-all","flex","justify-center","items-center","gap-2","border","border-slate-600/50","hover:border-slate-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Desconectar cuenta",1,"px-4","py-2.5","bg-red-500/10","hover:bg-red-500/20","text-red-400","rounded-lg","transition-all","border","border-red-500/10","hover:border-red-500/30",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-slate-400"],[1,"bg-slate-800","rounded-lg","shadow-xl","max-w-md","w-full","p-6","border","border-slate-700"],[1,"flex","items-start","mb-4"],[1,"flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-red-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"ml-3","flex-1"],[1,"text-lg","font-medium","text-slate-100"],[1,"mt-2","font-medium","text-slate-300"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","font-medium","transition-colors","disabled:opacity-50",3,"click","disabled"]],template:function(e,o){if(e&1&&(n(0,"div",0)(1,"div")(2,"h1",1),r(3,"Configuraci\xF3n de Pagos"),a(),n(4,"p",2),r(5," Administra c\xF3mo quieres recibir tus ganancias. "),a()(),m(6,K,2,0,"div",3),m(7,Q,2,1,"div",4),m(8,se,16,2,"div",5)(9,ce,3,0,"div",6),m(10,pe,20,4,"div",7),n(11,"div",8)(12,"div",9),y(),n(13,"svg",10),d(14,"path",11),a(),x(),n(15,"div")(16,"h3",12),r(17," Seguridad de tus datos "),a(),n(18,"p",13),r(19," Todos tus datos bancarios est\xE1n encriptados con AES-256. Tu informaci\xF3n est\xE1 segura y solo ser\xE1 usada para procesar tus pagos. "),a()()()()()),e&2){let l;s(6),p(o.isLoading()?6:-1),s(),p(((l=o.error())==null?null:l.section)==="load"?7:-1),s(),p(!o.isLoading()&&o.config()?8:!o.isLoading()&&!o.config()?9:-1),s(2),p(o.showDeleteModal()?10:-1)}},dependencies:[F,q,B,z,A,G,R,j],encapsulation:2})};export{O as a};
