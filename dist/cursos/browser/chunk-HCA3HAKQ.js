import{b as k}from"./chunk-VF3RCM2S.js";import{e as I,g as R}from"./chunk-VM3MHBTU.js";import"./chunk-TCGJFX72.js";import{x as D}from"./chunk-QA5A7GBQ.js";import{a as T}from"./chunk-F4KIANN2.js";import{$ as g,Eb as b,Gb as r,Hb as w,Ib as V,Jb as S,Ma as a,Ta as E,Xa as M,Y as h,Z as v,_ as p,ec as C,hb as c,ib as u,ja as l,rb as i,sb as s,tb as f,ub as y,vb as _,xb as x,yb as m}from"./chunk-6JS7X5LE.js";import"./chunk-I4MTPUBM.js";function N(o,n){if(o&1&&(i(0,"p",9),r(1),s()),o&2){let t=m();a(),V(" \u{1F4F1} ",t.maskedPhone()," ")}}function F(o,n){if(o&1&&(i(0,"div",10)(1,"p",17),p(),i(2,"svg",18),f(3,"path",19),s(),g(),i(4,"span"),r(5),s()()()),o&2){let t=m();a(5),w(t.errorMessage())}}function P(o,n){if(o&1&&(i(0,"div",11)(1,"p",20),p(),i(2,"svg",18),f(3,"path",21),s(),g(),i(4,"span"),r(5),s()()()),o&2){let t=m();a(5),w(t.successMessage())}}function H(o,n){if(o&1){let t=y();i(0,"div",12)(1,"div",22),p(),i(2,"svg",23),f(3,"path",24),s()(),g(),i(4,"h3",25),r(5,"Paso 1: Vincula tu cuenta"),s(),i(6,"p",26),r(7," Para recibir tu c\xF3digo de verificaci\xF3n, primero debes iniciar el bot de Telegram de la plataforma. "),s(),i(8,"button",27),x("click",function(){h(t);let d=m();return v(d.openTelegram())}),i(9,"span",28),r(10,"Iniciar Bot de Telegram"),s(),p(),i(11,"svg",29),f(12,"path",30),s()(),g(),i(13,"p",31),r(14,' Al hacer clic, se abrir\xE1 Telegram. Presiona "Iniciar" y recibir\xE1s tu c\xF3digo. '),s(),i(15,"div",32)(16,"button",33),x("click",function(){h(t);let d=m();return v(d.showInput.set(!0))}),r(17," Ya tengo un c\xF3digo, ingresarlo manualmente "),s()()()}}function j(o,n){if(o&1&&(i(0,"p",37),r(1),s()),o&2){let t=m(2);a(),S(" \u26A0\uFE0F Te quedan ",t.attemptsRemaining()," ",t.attemptsRemaining()===1?"intento":"intentos"," ")}}function z(o,n){if(o&1&&(i(0,"div",38)(1,"p",42),p(),i(2,"svg",43),f(3,"path",44),s(),g(),i(4,"span"),r(5,"Expira en: "),i(6,"strong",45),r(7),s()()()()),o&2){let t=m(2);a(7),w(t.timeRemaining())}}function A(o,n){o&1&&(i(0,"div",38)(1,"p",46),r(2," \u23F0 El c\xF3digo ha expirado "),s()())}function $(o,n){o&1&&(i(0,"span",40),p(),i(1,"svg",47),f(2,"circle",48)(3,"path",49),s(),g(),i(4,"span"),r(5,"Verificando..."),s()())}function B(o,n){o&1&&(i(0,"span"),r(1,"Verificar C\xF3digo"),s())}function G(o,n){o&1&&(i(0,"span",40),p(),i(1,"svg",47),f(2,"circle",48)(3,"path",49),s(),g(),i(4,"span"),r(5,"Reenviando..."),s()())}function X(o,n){if(o&1&&(i(0,"span"),r(1),s()),o&2){let t=m(2);a(),V("Reenviar en ",t.resendTimeRemaining())}}function q(o,n){o&1&&(i(0,"span",40)(1,"span"),r(2,"Reenviar C\xF3digo"),s()())}function U(o,n){if(o&1){let t=y();i(0,"div",13)(1,"div",34)(2,"label",35),r(3," C\xF3digo de Verificaci\xF3n "),s(),i(4,"input",36),x("input",function(d){h(t);let L=m();return v(L.onOtpInput(d))}),s(),c(5,j,2,2,"p",37),s(),c(6,z,8,1,"div",38)(7,A,3,0,"div",38),i(8,"button",39),x("click",function(){h(t);let d=m();return v(d.verifyCode())}),c(9,$,6,0,"span",40)(10,B,2,0,"span"),s(),i(11,"button",41),x("click",function(){h(t);let d=m();return v(d.resendCode())}),c(12,G,6,0,"span",40)(13,X,2,1,"span")(14,q,3,0,"span",40),s()()}if(o&2){let t,e=m();a(4),b("border-slate-700",!e.errorMessage())("border-red-500",e.errorMessage()),_("value",e.otpCode())("disabled",e.isVerifying()||e.countdown()===0),a(),u(e.attemptsRemaining()<3&&e.attemptsRemaining()>0?5:-1),a(),u(e.countdown()>0?6:7),a(2),b("bg-lime-500",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("hover:bg-lime-600",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("text-slate-900",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("bg-slate-700",!e.isCodeValid()||e.isVerifying()||e.countdown()===0)("text-slate-400",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),_("disabled",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),a(),u(e.isVerifying()?9:10),a(2),b("border-cyan-500",e.canResend()||e.resendCountdown()===0)("text-cyan-400",e.canResend()||e.resendCountdown()===0)("hover:bg-cyan-500/10",e.canResend()||e.resendCountdown()===0)("focus:ring-cyan-400",e.canResend()||e.resendCountdown()===0)("border-slate-700",!e.canResend()&&e.resendCountdown()>0)("text-slate-500",!e.canResend()&&e.resendCountdown()>0)("focus:ring-slate-400",!e.canResend()&&e.resendCountdown()>0)("animate-pulse",e.canResend()&&((t=e.errorMessage())==null?null:t.includes("inicial"))),_("disabled",e.isResending()||!e.canResend()&&e.resendCountdown()>0),a(),u(e.isResending()?12:!e.canResend()&&e.resendCountdown()>0?13:14)}}var O=class o{constructor(n,t,e){this.authService=n;this.router=t;this.route=e}otpCode=l("");userId=l(null);phone=l(null);isVerifying=l(!1);isResending=l(!1);canResend=l(!1);countdown=l(600);resendCountdown=l(0);errorMessage=l(null);successMessage=l(null);attemptsRemaining=l(3);countdownInterval;resendInterval;timeRemaining=C(()=>{let n=this.countdown(),t=Math.floor(n/60),e=n%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`});resendTimeRemaining=C(()=>`${this.resendCountdown()}s`);maskedPhone=C(()=>{let n=this.phone();if(!n||n.length<10)return n;let t=n.substring(0,2),e=n.substring(2,5),d=n.substring(n.length-4);return`+${t} ${e} XXXX ${d}`});isCodeValid=C(()=>{let n=this.otpCode();return n.length===6&&/^\d+$/.test(n)});telegramLink=C(()=>{let n=T.telegramBot,t=this.userId();return!n||!t?null:`https://t.me/${n}?start=${t}`});openTelegram(){let n=this.telegramLink();n&&(window.open(n,"_blank"),this.showInput.set(!0))}ngOnInit(){this.route.queryParams.subscribe(n=>{let t=n.userId,e=n.phone,d=n.error;if(!t){this.router.navigate(["/register"]);return}this.userId.set(t),this.phone.set(e||null),d==="otp_not_sent"&&(this.errorMessage.set("\u26A0\uFE0F Paso 1: Vincula tu cuenta con Telegram para recibir el c\xF3digo."),this.canResend.set(!0))}),this.startExpirationCountdown()}showInput=l(!1);openTelegramInput(){this.showInput.set(!0),this.countdown()===0&&this.resendCode()}ngOnDestroy(){this.clearTimers()}startExpirationCountdown(){this.clearTimers(),this.countdownInterval=setInterval(()=>{let n=this.countdown();n>0?this.countdown.set(n-1):(this.clearTimers(),this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."))},1e3)}startResendCountdown(){this.resendInterval&&clearInterval(this.resendInterval),this.canResend.set(!1),this.resendCountdown.set(60),this.resendInterval=setInterval(()=>{let n=this.resendCountdown();n>1?this.resendCountdown.set(n-1):(clearInterval(this.resendInterval),this.resendCountdown.set(0),this.canResend.set(!0))},1e3)}clearTimers(){this.countdownInterval&&clearInterval(this.countdownInterval),this.resendInterval&&clearInterval(this.resendInterval)}onOtpInput(n){let e=n.target.value.replace(/\D/g,"");e.length>6&&(e=e.substring(0,6)),this.otpCode.set(e),this.errorMessage.set(null)}verifyCode(){if(!this.isCodeValid()){this.errorMessage.set("Por favor, ingresa un c\xF3digo de 6 d\xEDgitos");return}let n=this.userId();if(!n){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isVerifying.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.verifyOtp(n,this.otpCode()).subscribe({next:t=>{this.successMessage.set(t.message||"\xA1Cuenta verificada exitosamente!"),this.clearTimers(),setTimeout(()=>{},2e3)},error:t=>{this.isVerifying.set(!1),t.status===400?(this.errorMessage.set(t.error.message_text||"C\xF3digo incorrecto"),t.error.attemptsRemaining!==void 0&&(this.attemptsRemaining.set(t.error.attemptsRemaining),t.error.attemptsRemaining===0&&this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."))):t.status===403?(this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."),this.attemptsRemaining.set(0)):t.status===410?(this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."),this.clearTimers()):this.errorMessage.set(t.error?.message_text||"Ocurri\xF3 un error. Int\xE9ntalo de nuevo."),this.otpCode.set("")},complete:()=>{this.isVerifying.set(!1)}})}resendCode(){if(!this.canResend()&&this.resendCountdown()>0){this.errorMessage.set(`Debes esperar ${this.resendCountdown()} segundos antes de reenviar`);return}let n=this.userId();if(!n){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isResending.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.resendOtp(n).subscribe({next:t=>{this.successMessage.set(t.message||"C\xF3digo reenviado exitosamente"),this.countdown.set(600),this.startExpirationCountdown(),this.startResendCountdown(),this.attemptsRemaining.set(3),this.otpCode.set(""),this.showInput.set(!0)},error:t=>{t.status===429?t.error.waitSeconds?(this.errorMessage.set(t.error.message_text),this.resendCountdown.set(t.error.waitSeconds),this.startResendCountdown()):this.errorMessage.set(t.error.message_text||"Has alcanzado el l\xEDmite de reenv\xEDos"):this.errorMessage.set(t.error?.message_text||"Error al reenviar el c\xF3digo")},complete:()=>{this.isResending.set(!1)}})}goToRegister(){this.clearTimers(),this.router.navigate(["/register"])}static \u0275fac=function(t){return new(t||o)(E(k),E(R),E(I))};static \u0275cmp=M({type:o,selectors:[["app-verify-otp"]],decls:22,vars:5,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","py-8","sm:py-12","px-4"],[1,"w-full","max-w-md","mx-auto"],[1,"bg-slate-800","border","border-white/10","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"w-16","h-16","bg-lime-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-lime-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-300","text-sm"],[1,"text-lime-400","font-mono","text-sm","mt-2"],[1,"mb-4","p-4","bg-red-500/10","border","border-red-500/30","rounded-lg"],[1,"mb-4","p-4","bg-lime-500/10","border","border-lime-500/30","rounded-lg"],[1,"mb-8","text-center","animate-pulse"],[1,"animate-in","fade-in","slide-in-from-bottom-4","duration-500"],[1,"mt-6","text-center"],["type","button",1,"text-slate-400","hover:text-white","text-sm","transition-colors",3,"click"],[1,"text-slate-500","text-xs"],[1,"text-red-400","text-sm","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-lime-400","text-sm","flex","items-center","gap-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"inline-flex","items-center","justify-center","w-16","h-16","rounded-full","bg-[#229ED9]/20","text-[#229ED9]","mb-4","ring-4","ring-[#229ED9]/10"],["viewBox","0 0 24 24","fill","currentColor",1,"w-8","h-8"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-slate-400","mb-6"],[1,"w-full","flex","items-center","justify-center","gap-3","px-6","py-4","bg-[#229ED9]","hover:bg-[#1f8ub8]","text-white","rounded-xl","shadow-lg","shadow-[#229ED9]/30","transition-all","group",3,"click"],[1,"font-bold","text-lg"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","group-hover:translate-x-1","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14 5l7 7m0 0l-7 7m7-7H3"],[1,"text-xs","text-slate-500","mt-4"],[1,"mt-4","pt-4","border-t","border-white/5"],[1,"text-xs","text-slate-400","hover:text-white","underline",3,"click"],[1,"mb-6"],[1,"block","text-slate-300","text-sm","font-medium","mb-3"],["type","text","inputmode","numeric","maxlength","6","placeholder","000000","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","rounded-lg","text-white","text-center","text-2xl","font-mono","tracking-widest","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:border-transparent","transition-all",3,"input","value","disabled"],[1,"text-yellow-400","text-xs","mt-2","text-center"],[1,"mb-6","text-center"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed","mb-4",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","border-2","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-slate-400","text-sm","flex","items-center","justify-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-white","font-mono"],[1,"text-red-400","text-sm","font-medium"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(),i(5,"svg",5),f(6,"path",6),s()(),g(),i(7,"h1",7),r(8,"Verificaci\xF3n de Cuenta"),s(),i(9,"p",8),r(10," Ingresa el c\xF3digo de 6 d\xEDgitos enviado a tu Telegram "),s(),c(11,N,2,1,"p",9),s(),c(12,F,6,1,"div",10),c(13,P,6,1,"div",11),c(14,H,18,0,"div",12),c(15,U,15,38,"div",13),i(16,"div",14)(17,"button",15),x("click",function(){return e.goToRegister()}),r(18," \u2190 Volver al registro "),s()()(),i(19,"div",14)(20,"p",16),r(21," Si no recibes el c\xF3digo, verifica que tu Telegram est\xE9 activo "),s()()()()),t&2&&(a(11),u(e.maskedPhone()?11:-1),a(),u(e.errorMessage()?12:-1),a(),u(e.successMessage()?13:-1),a(),u(!e.showInput()&&e.telegramLink()?14:-1),a(),u(e.showInput()?15:-1))},dependencies:[D],encapsulation:2})};export{O as VerifyOtpComponent};
