import{a as g}from"./chunk-XM5I3GUE.js";import{Jc as p,K as i,O as u,T as c,ec as n,ja as d}from"./chunk-6JS7X5LE.js";import{a as o,b as r}from"./chunk-I4MTPUBM.js";var l=class a{http=c(p);API_URL=g.url;state=d({discounts:[],config:null,isLoading:!1,error:null});discounts=n(()=>this.state().discounts);config=n(()=>this.state().config);isLoading=n(()=>this.state().isLoading);error=n(()=>this.state().error);stats=n(()=>{let t=this.discounts(),e=Date.now();return{total:t.length,active:t.filter(s=>s.state&&s.end_date_num>=e&&s.start_date_num<=e).length,expired:t.filter(s=>s.end_date_num<e).length,upcoming:t.filter(s=>s.start_date_num>e).length,inactive:t.filter(s=>!s.state).length}});constructor(){this.loadDiscounts().subscribe()}loadDiscounts(){return this.state.update(t=>r(o({},t),{isLoading:!0})),this.http.get(`${this.API_URL}discount/list`).pipe(i({next:t=>{this.state.update(e=>r(o({},e),{discounts:t.discounts,isLoading:!1,error:null}))},error:t=>{this.state.update(e=>r(o({},e),{discounts:[],isLoading:!1,error:t}))}}))}loadConfig(){return this.http.get(`${this.API_URL}discount/config_all`).pipe(i({next:t=>{this.state.update(e=>r(o({},e),{config:t}))},error:t=>{}}))}getDiscount(t){return this.http.get(`${this.API_URL}discount/show/${t}`)}createDiscount(t){return this.http.post(`${this.API_URL}discount/register`,t).pipe(i(()=>this.loadDiscounts().subscribe()))}updateDiscount(t){return this.http.post(`${this.API_URL}discount/update`,t).pipe(i(()=>this.loadDiscounts().subscribe()))}deleteDiscount(t){return this.http.delete(`${this.API_URL}discount/remove/${t}`).pipe(i(()=>this.loadDiscounts().subscribe()))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{l as a};
