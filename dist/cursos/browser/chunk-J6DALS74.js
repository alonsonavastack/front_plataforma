import{a as R}from"./chunk-NO3WFOJA.js";import{e as V,g as F}from"./chunk-VM3MHBTU.js";import{c as E,f as A,h as H,y as N}from"./chunk-QA5A7GBQ.js";import{a as z}from"./chunk-F4KIANN2.js";import{$ as x,Ac as L,Gb as r,Hb as k,Ib as T,Ma as l,T as v,Xa as M,Y as g,Z as f,_ as y,ec as D,fb as I,hb as m,ib as p,ja as u,ka as w,rb as i,sb as n,tb as c,ub as _,vb as C,xb as h,yb as d}from"./chunk-6JS7X5LE.js";import{a as S}from"./chunk-I4MTPUBM.js";function G(a,t){a&1&&(i(0,"div",3),c(1,"div",14),n())}function $(a,t){if(a&1&&(i(0,"div",4),r(1),n()),a&2){let e,o=d();l(),T(" ",(e=o.error())==null?null:e.message," ")}}function O(a,t){a&1&&(i(0,"span",23),c(1,"span",27),r(2," Conectado "),n())}function Y(a,t){a&1&&(c(0,"span",34),i(1,"span"),r(2,"Conectando..."),n())}function J(a,t){a&1&&(i(0,"span"),r(1,"Conectar mi cuenta PayPal"),n())}function K(a,t){if(a&1){let e=_();i(0,"button",35),h("click",function(){g(e);let s=d(3);return f(s.cancelEditPaypal())}),r(1," Cancelar "),n()}}function Q(a,t){if(a&1){let e=_();i(0,"div",25)(1,"div")(2,"label",28),y(),i(3,"svg",29),c(4,"path",30),n(),r(5," Conectar con PayPal "),n(),x(),i(6,"p",31),r(7," Para recibir tus pagos de forma segura, conecta tu cuenta verificada. Ser\xE1s redirigido a PayPal para autorizar la conexi\xF3n. "),n(),i(8,"button",32),h("click",function(){g(e);let s=d(2);return f(s.initiatePaypalConnect())}),m(9,Y,3,0)(10,J,2,0,"span"),n()(),m(11,K,2,0,"button",33),n()}if(a&2){let e=d(2);l(8),C("disabled",e.isSaving()==="paypal"),l(),p(e.isSaving()==="paypal"?9:10),l(2),p(e.hasPaypal()?11:-1)}}function W(a,t){if(a&1){let e=_();i(0,"div",26)(1,"div",36)(2,"div",37)(3,"p",38),r(4,"Cuenta Conectada"),n(),i(5,"span",39),r(6," VERIFICADA "),n()(),i(7,"p",40),r(8),n(),i(9,"p",41),r(10,"Lista para recibir pagos autom\xE1ticos"),n()(),i(11,"div",42)(12,"button",43),h("click",function(){g(e);let s=d(2);return f(s.editPaypal())}),y(),i(13,"svg",44),c(14,"path",45),n(),r(15," Modificar "),n(),x(),i(16,"button",46),h("click",function(){g(e);let s=d(2);return f(s.confirmDeletePaypal())}),y(),i(17,"svg",47),c(18,"path",48),n()()()()}if(a&2){let e,o=d(2);l(8),k((e=o.config())==null?null:e.paypal_email)}}function X(a,t){if(a&1&&(i(0,"div",5)(1,"div",15),c(2,"div",16),i(3,"div",17)(4,"div",18)(5,"div",19),y(),i(6,"svg",20),c(7,"path",21),n()(),x(),i(8,"div")(9,"h3",22),r(10," PayPal "),m(11,O,3,0,"span",23),n(),i(12,"p",24),r(13,"Pagos internacionales r\xE1pidos y seguros"),n()()()(),m(14,Q,12,3,"div",25)(15,W,19,1,"div",26),n()()),a&2){let e=d();l(11),p(e.hasPaypal()&&!e.editingPaypal()?11:-1),l(3),p(!e.hasPaypal()||e.editingPaypal()?14:15)}}function Z(a,t){a&1&&(i(0,"div",6)(1,"p",49),r(2,"No se pudo cargar la configuraci\xF3n."),n()())}function ee(a,t){a&1&&(i(0,"span"),r(1,"Eliminando..."),n())}function te(a,t){a&1&&(i(0,"span"),r(1,"Eliminar"),n())}function ie(a,t){if(a&1){let e=_();i(0,"div",7)(1,"div",50)(2,"div",51)(3,"div",52),y(),i(4,"svg",53),c(5,"path",54),n()(),x(),i(6,"div",55)(7,"h3",56),r(8," Confirmar Eliminaci\xF3n "),n(),i(9,"div",2)(10,"p"),r(11,"\xBFEst\xE1s seguro de que deseas eliminar esta configuraci\xF3n de PayPal?"),n(),i(12,"p",57),r(13,"Esta acci\xF3n no se puede deshacer."),n()()()(),i(14,"div",58)(15,"button",59),h("click",function(){g(e);let s=d();return f(s.cancelDelete())}),r(16," Cancelar "),n(),i(17,"button",60),h("click",function(){g(e);let s=d();return f(s.executeDelete())}),m(18,ee,2,0,"span")(19,te,2,0,"span"),n()()()()}if(a&2){let e=d();I("inert",e.showDeleteModal()?null:""),l(15),C("disabled",e.isSaving()==="delete"),l(2),C("disabled",e.isSaving()==="delete"),l(),p(e.isSaving()==="delete"?18:19)}}var B=class a{instructorPaymentService=v(R);route=v(V);router=v(F);config=this.instructorPaymentService.paymentConfig;isLoading=this.instructorPaymentService.isLoadingPaymentConfig;isSaving=u("");error=u(null);success=u(null);publicSettings=u(null);paypalForm=new A({paypal_email:new H("",[E.required,E.email])});editingPaypal=u(!1);showDeleteModal=u(!1);deleteTarget=u(null);constructor(){w(()=>{let t=this.config();t&&(t.paypal_email||t.paypal_connected)?this.populateForms(t):(this.paypalForm.reset(),this.editingPaypal.set(!1))})}ngOnInit(){let t=this.router.url||"";if(t.includes("/instructor-payment-config")&&!t.includes("/dashboard")){let o=S({},this.route.snapshot.queryParams);o.section="instructor-payment-config",this.router.navigate(["/dashboard"],{queryParams:o,replaceUrl:!0});return}this.instructorPaymentService.reloadPaymentConfig(),this.instructorPaymentService.getPublicPaymentConfig().subscribe({next:o=>{this.publicSettings.set(o.settings)},error:o=>{console.error("Error loading public settings:",o)}}),this.route.queryParams.subscribe(o=>{let s=o.code,b=o.state;s&&b&&this.handlePaypalCallback(s,b)})}initiatePaypalConnect(){let t=this.publicSettings();if(!t||!t.paypal?.active){this.error.set({section:"paypal",message:"La conexi\xF3n con PayPal no est\xE1 disponible en este momento. Contacta al administrador."});return}this.isSaving.set("paypal");let e=t.paypal.clientId,o=t.paypal.mode;if(!e){this.error.set({section:"paypal",message:"Error de configuraci\xF3n: No se encontr\xF3 el Client ID de PayPal."}),this.isSaving.set("");return}let s=window.location.origin+"/dashboard?section=instructor-payment-config",b=z.paypal.redirectUrl||window.location.origin,U="openid profile email",P=Math.random().toString(36).substring(7),j=Math.random().toString(36).substring(7);localStorage.setItem("paypal_oauth_state",P);let q=`${o==="live"?"https://www.paypal.com":"https://www.sandbox.paypal.com"}/connect?response_type=code&client_id=${e}&scope=${encodeURIComponent(U)}&redirect_uri=${encodeURIComponent(b)}&state=${P}&nonce=${j}`;window.location.href=q}handlePaypalCallback(t,e){this.isSaving.set("paypal");let o=localStorage.getItem("paypal_oauth_state");localStorage.removeItem("paypal_oauth_state"),this.router.navigate([],{queryParams:{code:null,state:null},queryParamsHandling:"merge",replaceUrl:!0}),this.instructorPaymentService.connectPaypal(t).subscribe({next:s=>{s.success&&(this.instructorPaymentService.reloadPaymentConfig(),this.loadConfig(),this.success.set({section:"paypal",message:"\xA1Cuenta de PayPal conectada y verificada exitosamente!"}),setTimeout(()=>this.clearMessages(),5e3)),this.isSaving.set("")},error:s=>{console.error("Error connecting PayPal:",s),this.error.set({section:"paypal",message:s.error?.message||"Error al conectar la cuenta. Intenta nuevamente."}),this.isSaving.set("")}})}loadConfig(){this.instructorPaymentService.reloadPaymentConfig()}populateForms(t){t.paypal_email&&this.paypalForm.patchValue({paypal_email:t.paypal_email})}editPaypal(){this.editingPaypal.set(!0),this.clearMessages()}cancelEditPaypal(){this.editingPaypal.set(!1),this.config()?.paypal_email&&this.paypalForm.patchValue({paypal_email:this.config().paypal_email}),this.clearMessages()}savePaypal(){if(this.paypalForm.invalid)return;this.isSaving.set("paypal"),this.clearMessages();let t={paypal_email:this.paypalForm.value.paypal_email};this.instructorPaymentService.updatePaypalConfig(t).subscribe({next:e=>{e.success?(this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"paypal",message:"Cuenta de PayPal actualizada correctamente."}),this.editingPaypal.set(!1),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"paypal",message:e.message||"Error al actualizar."}),this.isSaving.set("")},error:e=>{this.error.set({section:"paypal",message:e.error?.message||"Error al conectar con el servidor."}),this.isSaving.set("")}})}confirmDeletePaypal(){this.deleteTarget.set("paypal"),this.showDeleteModal.set(!0)}deletePaypal(){this.isSaving.set("delete"),this.instructorPaymentService.deletePaypalConfig().subscribe({next:t=>{t.success?(this.paypalForm.reset(),this.editingPaypal.set(!1),this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"paypal",message:"Cuenta de PayPal eliminada correctamente."}),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"paypal",message:t.message||"Error al eliminar."}),this.isSaving.set(""),this.closeDeleteModal()},error:t=>{this.error.set({section:"paypal",message:t.error?.message||"Error al eliminar configuraci\xF3n."}),this.isSaving.set(""),this.closeDeleteModal()}})}cancelDelete(){this.showDeleteModal.set(!1),this.deleteTarget.set(null)}closeDeleteModal(){this.showDeleteModal.set(!1),this.deleteTarget.set(null)}executeDelete(){this.deletePaypal()}setPreferredMethod(t){this.isSaving.set("preferred"),this.clearMessages(),this.instructorPaymentService.updatePreferredMethod(t).subscribe({next:e=>{e.success?(this.instructorPaymentService.reloadPaymentConfig(),this.success.set({section:"preferred",message:"M\xE9todo de pago preferido actualizado."}),setTimeout(()=>this.clearMessages(),3e3)):this.error.set({section:"preferred",message:e.message||"Error al actualizar."}),this.isSaving.set("")},error:e=>{this.error.set({section:"preferred",message:e.error?.message||"Error al conectar con el servidor."}),this.isSaving.set("")}})}clearMessages(){this.error.set(null),this.success.set(null)}hasPaypal=D(()=>{let t=this.config();return!!(t?.paypal_email||t?.paypal_connected)});static \u0275fac=function(e){return new(e||a)};static \u0275cmp=M({type:a,selectors:[["app-instructor-payment-config"]],decls:20,vars:4,consts:[[1,"space-y-8"],[1,"text-3xl","font-bold","text-slate-100"],[1,"mt-2","text-sm","text-slate-400"],[1,"flex","justify-center","items-center","py-12"],[1,"bg-red-500/10","border","border-red-500/50","text-red-400","px-4","py-3","rounded-lg"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-8"],[1,"text-center","py-12"],["aria-hidden","true",1,"fixed","inset-0","bg-black/50","backdrop-blur-sm","flex","items-center","justify-center","z-50","p-4"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-4"],[1,"flex","items-start"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-blue-400","mt-0.5","mr-3","flex-shrink-0"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"text-sm","font-medium","text-blue-300","mb-1"],[1,"text-sm","text-blue-200/70"],[1,"animate-spin","rounded-full","h-12","w-12","border-b-2","border-lime-400"],[1,"bg-slate-800/50","rounded-lg","p-6","border","border-slate-700","h-full","relative","overflow-hidden","group","hover:border-blue-500/30","transition-all"],[1,"absolute","-right-6","-top-6","w-24","h-24","bg-blue-600/10","rounded-full","group-hover:bg-blue-600/20","transition-all"],[1,"flex","items-center","justify-between","mb-6","relative","z-10"],[1,"flex","items-center","space-x-4"],[1,"bg-blue-600/20","p-3","rounded-xl","border","border-blue-500/20"],["fill","currentColor","viewBox","0 0 24 24",1,"h-8","w-8","text-blue-500"],["d","M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.946 5.05-4.336 6.794-9.067 6.794h-2.13l-2.765 17.556a.641.641 0 0 1-.633.74l-.004-.007-.406-10.28z"],[1,"text-xl","font-bold","text-slate-100","flex","items-center","gap-2"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-semibold","bg-green-500/10","text-green-400","border","border-green-500/20"],[1,"text-sm","text-slate-400"],[1,"relative","z-10","space-y-5"],[1,"relative","z-10"],[1,"w-1.5","h-1.5","rounded-full","bg-green-400","mr-1.5","animate-pulse"],[1,"block","text-sm","font-medium","text-slate-300","mb-1.5","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-[#0070BA]"],["d","M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.875.812 5.498-.773 4.125-2.854 6.42-6.526 6.42H10.51a.641.641 0 0 0-.633.527l-2.074 11.23a.64.64 0 0 1-.727.52z"],[1,"text-sm","text-slate-400","mb-4","bg-slate-900/50","p-3","rounded-lg","border","border-slate-700/50"],["type","button",1,"w-full","bg-[#0070BA]","hover:bg-[#005EA6]","text-white","font-bold","py-3","px-4","rounded-lg","transition-all","shadow-lg","flex","justify-center","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"w-full","px-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors"],[1,"inline-block","w-4","h-4","border-2","border-white/30","border-t-white","rounded-full","animate-spin"],["type","button",1,"w-full","px-4","py-2.5","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors",3,"click"],[1,"bg-slate-900/50","rounded-xl","p-5","mb-5","border","border-slate-700/50"],[1,"flex","justify-between","items-start","mb-2"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded","text-[10px]","font-bold","bg-blue-500/10","text-blue-400","border","border-blue-500/20"],[1,"text-lg","font-medium","text-white","truncate"],[1,"text-xs","text-slate-500","mt-1"],[1,"flex","gap-3"],[1,"flex-1","py-2.5","px-4","bg-slate-700/50","hover:bg-slate-700","text-slate-200","rounded-lg","transition-all","flex","justify-center","items-center","gap-2","border","border-slate-600/50","hover:border-slate-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Desconectar cuenta",1,"px-4","py-2.5","bg-red-500/10","hover:bg-red-500/20","text-red-400","rounded-lg","transition-all","border","border-red-500/10","hover:border-red-500/30",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-slate-400"],[1,"bg-slate-800","rounded-lg","shadow-xl","max-w-md","w-full","p-6","border","border-slate-700"],[1,"flex","items-start","mb-4"],[1,"flex-shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6","text-red-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"ml-3","flex-1"],[1,"text-lg","font-medium","text-slate-100"],[1,"mt-2","font-medium","text-slate-300"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2","bg-slate-700","text-slate-300","rounded-lg","hover:bg-slate-600","font-medium","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"flex-1","px-4","py-2","bg-red-600","text-white","rounded-lg","hover:bg-red-700","font-medium","transition-colors","disabled:opacity-50",3,"click","disabled"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div")(2,"h1",1),r(3,"Configuraci\xF3n de Pagos"),n(),i(4,"p",2),r(5," Administra c\xF3mo quieres recibir tus ganancias. "),n()(),m(6,G,2,0,"div",3),m(7,$,2,1,"div",4),m(8,X,16,2,"div",5)(9,Z,3,0,"div",6),m(10,ie,20,4,"div",7),i(11,"div",8)(12,"div",9),y(),i(13,"svg",10),c(14,"path",11),n(),x(),i(15,"div")(16,"h3",12),r(17," Seguridad de tus datos "),n(),i(18,"p",13),r(19," Todos tus datos bancarios est\xE1n encriptados con AES-256. Tu informaci\xF3n est\xE1 segura y solo ser\xE1 usada para procesar tus pagos. "),n()()()()()),e&2){let s;l(6),p(o.isLoading()?6:-1),l(),p(((s=o.error())==null?null:s.section)==="load"?7:-1),l(),p(!o.isLoading()&&o.config()?8:!o.isLoading()&&!o.config()?9:-1),l(2),p(o.showDeleteModal()?10:-1)}},dependencies:[L,N],encapsulation:2})};export{B as a};
