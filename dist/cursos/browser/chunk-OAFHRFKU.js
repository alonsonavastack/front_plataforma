import{a as k}from"./chunk-HFV3ACWC.js";import"./chunk-CXIPGNGY.js";import"./chunk-6Z75774O.js";import"./chunk-R5HHEV5R.js";import"./chunk-UD4Q7ATB.js";import"./chunk-YLPMTYEY.js";import"./chunk-7BVW3MIO.js";import"./chunk-T7LC232X.js";import{c as L,e as R}from"./chunk-UKUKXRH6.js";import"./chunk-TCGJFX72.js";import{w as I}from"./chunk-SDJWNAN2.js";import{a as y}from"./chunk-HN3U4OFT.js";import{$ as v,Eb as b,Gb as r,Hb as T,Ib as E,Jb as F,Jc as V,Ma as a,Ta as P,Xa as M,Y as g,Z as f,_,ec as S,hb as c,ib as u,ja as m,nb as x,ob as i,pb as o,qb as w,ub as h,wb as p,yb as d}from"./chunk-6JS7X5LE.js";import"./chunk-I4MTPUBM.js";function N(n,t){n&1&&r(0," Ingresa tu email para recibir un c\xF3digo de recuperaci\xF3n ")}function H(n,t){n&1&&r(0," Ingresa el c\xF3digo de 6 d\xEDgitos enviado a tu Telegram ")}function O(n,t){n&1&&r(0," Ingresa tu nueva contrase\xF1a ")}function q(n,t){if(n&1&&(i(0,"div",9)(1,"p",16),_(),i(2,"svg",17),w(3,"path",18),o(),v(),i(4,"span"),r(5),o()()()),n&2){let e=d();a(5),T(e.errorMessage())}}function j(n,t){if(n&1&&(i(0,"div",10)(1,"p",19),_(),i(2,"svg",17),w(3,"path",20),o(),v(),i(4,"span"),r(5),o()()()),n&2){let e=d();a(5),T(e.successMessage())}}function z(n,t){n&1&&(i(0,"span",25),_(),i(1,"svg",26),w(2,"circle",27)(3,"path",28),o(),v(),i(4,"span"),r(5,"Enviando..."),o()())}function B(n,t){n&1&&(i(0,"span"),r(1,"Enviar C\xF3digo"),o())}function G(n,t){if(n&1){let e=h();i(0,"div",21)(1,"label",22),r(2," Correo Electr\xF3nico "),o(),i(3,"input",23),p("input",function(l){g(e);let C=d();return f(C.email.set(l.target.value))}),o()(),i(4,"button",24),p("click",function(){g(e);let l=d();return f(l.requestRecovery())}),c(5,z,6,0,"span",25)(6,B,2,0,"span"),o()}if(n&2){let e=d();a(3),x("value",e.email()),a(),b("bg-blue-500",e.email()&&!e.isLoading())("hover:bg-blue-600",e.email()&&!e.isLoading())("text-white",e.email()&&!e.isLoading())("bg-slate-700",!e.email()||e.isLoading())("text-slate-400",!e.email()||e.isLoading()),x("disabled",!e.email()||e.isLoading()),a(),u(e.isLoading()?5:6)}}function $(n,t){if(n&1&&(i(0,"p",30),r(1),o()),n&2){let e=d(2);a(),F(" \u26A0\uFE0F Te quedan ",e.attemptsRemaining()," ",e.attemptsRemaining()===1?"intento":"intentos"," ")}}function A(n,t){if(n&1&&(i(0,"div",31)(1,"p",34),_(),i(2,"svg",35),w(3,"path",36),o(),v(),i(4,"span"),r(5,"Expira en: "),i(6,"strong",37),r(7),o()()()()),n&2){let e=d(2);a(7),T(e.timeRemaining())}}function J(n,t){n&1&&(i(0,"div",31)(1,"p",38),r(2," \u23F0 El c\xF3digo ha expirado "),o()())}function K(n,t){n&1&&(i(0,"span",25),_(),i(1,"svg",26),w(2,"circle",27)(3,"path",28),o(),v(),i(4,"span"),r(5,"Verificando..."),o()())}function Q(n,t){n&1&&(i(0,"span"),r(1,"Verificar C\xF3digo"),o())}function U(n,t){n&1&&(i(0,"span",25),_(),i(1,"svg",26),w(2,"circle",27)(3,"path",28),o(),v(),i(4,"span"),r(5,"Reenviando..."),o()())}function W(n,t){if(n&1&&(i(0,"span"),r(1),o()),n&2){let e=d(2);a(),E("Reenviar en ",e.resendTimeRemaining())}}function X(n,t){n&1&&(i(0,"span"),r(1,"Reenviar C\xF3digo"),o())}function Y(n,t){if(n&1){let e=h();i(0,"div",21)(1,"label",22),r(2," C\xF3digo de Recuperaci\xF3n "),o(),i(3,"input",29),p("input",function(l){g(e);let C=d();return f(C.onOtpInput(l))}),o(),c(4,$,2,2,"p",30),o(),c(5,A,8,1,"div",31)(6,J,3,0,"div",31),i(7,"button",32),p("click",function(){g(e);let l=d();return f(l.verifyRecoveryCode())}),c(8,K,6,0,"span",25)(9,Q,2,0,"span"),o(),i(10,"button",33),p("click",function(){g(e);let l=d();return f(l.resendRecoveryCode())}),c(11,U,6,0,"span",25)(12,W,2,1,"span")(13,X,2,0,"span"),o()}if(n&2){let e=d();a(3),b("border-slate-700",!e.errorMessage())("border-red-500",e.errorMessage()),x("value",e.otpCode())("disabled",e.isLoading()||e.countdown()===0),a(),u(e.attemptsRemaining()<3&&e.attemptsRemaining()>0?4:-1),a(),u(e.countdown()>0?5:6),a(2),b("bg-blue-500",e.isCodeValid()&&!e.isLoading()&&e.countdown()>0)("hover:bg-blue-600",e.isCodeValid()&&!e.isLoading()&&e.countdown()>0)("text-white",e.isCodeValid()&&!e.isLoading()&&e.countdown()>0)("bg-slate-700",!e.isCodeValid()||e.isLoading()||e.countdown()===0)("text-slate-400",!e.isCodeValid()||e.isLoading()||e.countdown()===0),x("disabled",!e.isCodeValid()||e.isLoading()||e.countdown()===0),a(),u(e.isLoading()?8:9),a(2),b("border-cyan-500",e.canResend()||e.resendCountdown()===0)("text-cyan-400",e.canResend()||e.resendCountdown()===0)("hover:bg-cyan-500/10",e.canResend()||e.resendCountdown()===0)("focus:ring-cyan-400",e.canResend()||e.resendCountdown()===0)("border-slate-700",!e.canResend()&&e.resendCountdown()>0)("text-slate-500",!e.canResend()&&e.resendCountdown()>0)("focus:ring-slate-400",!e.canResend()&&e.resendCountdown()>0),x("disabled",e.isLoading()||!e.canResend()&&e.resendCountdown()>0),a(),u(e.isLoading()?11:!e.canResend()&&e.resendCountdown()>0?12:13)}}function Z(n,t){n&1&&(i(0,"span",25),_(),i(1,"svg",26),w(2,"circle",27)(3,"path",28),o(),v(),i(4,"span"),r(5,"Restableciendo..."),o()())}function ee(n,t){n&1&&(i(0,"span"),r(1,"Restablecer Contrase\xF1a"),o())}function te(n,t){if(n&1){let e=h();i(0,"div",39)(1,"div")(2,"label",22),r(3," Nueva Contrase\xF1a "),o(),i(4,"input",40),p("input",function(l){g(e);let C=d();return f(C.newPassword.set(l.target.value))}),o()(),i(5,"div")(6,"label",22),r(7," Confirmar Nueva Contrase\xF1a "),o(),i(8,"input",41),p("input",function(l){g(e);let C=d();return f(C.confirmPassword.set(l.target.value))}),o()()(),i(9,"button",42),p("click",function(){g(e);let l=d();return f(l.resetPassword())}),c(10,Z,6,0,"span",25)(11,ee,2,0,"span"),o()}if(n&2){let e=d();a(4),x("value",e.newPassword()),a(4),x("value",e.confirmPassword()),a(),b("bg-blue-500",e.isPasswordValid()&&!e.isLoading())("hover:bg-blue-600",e.isPasswordValid()&&!e.isLoading())("text-white",e.isPasswordValid()&&!e.isLoading())("bg-slate-700",!e.isPasswordValid()||e.isLoading())("text-slate-400",!e.isPasswordValid()||e.isLoading()),x("disabled",!e.isPasswordValid()||e.isLoading()),a(),u(e.isLoading()?10:11)}}function ne(n,t){if(n&1){let e=h();i(0,"button",13),p("click",function(){g(e);let l=d();return f(l.goBackToEmail())}),r(1," \u2190 Cambiar email "),o()}}function ie(n,t){if(n&1){let e=h();i(0,"button",13),p("click",function(){g(e);let l=d();return f(l.goBackToOtp())}),r(1," \u2190 Volver a verificaci\xF3n "),o()}}var D=class n{constructor(t,e,s){this.http=t;this.router=e;this.route=s}email=m("");otpCode=m("");newPassword=m("");confirmPassword=m("");currentStep=m("email");isLoading=m(!1);errorMessage=m(null);successMessage=m(null);countdown=m(600);resendCountdown=m(0);canResend=m(!1);attemptsRemaining=m(3);countdownInterval;resendInterval;timeRemaining=S(()=>{let t=this.countdown(),e=Math.floor(t/60),s=t%60;return`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`});resendTimeRemaining=S(()=>`${this.resendCountdown()}s`);isCodeValid=S(()=>{let t=this.otpCode();return t.length===6&&/^\d+$/.test(t)});isPasswordValid=S(()=>{let t=this.newPassword(),e=this.confirmPassword();return t.length>=6&&t===e});ngOnInit(){this.route.queryParams.subscribe(t=>{let e=t.step,s=t.email;e==="otp"&&s?(this.currentStep.set("otp"),this.email.set(s),this.startExpirationCountdown()):e==="password"&&s&&(this.currentStep.set("password"),this.email.set(s))})}ngOnDestroy(){this.clearTimers()}requestRecovery(){let t=this.email().trim();if(!t){this.errorMessage.set("Por favor ingresa tu email");return}this.isLoading.set(!0),this.errorMessage.set(null),this.http.post(`${y.url}users/request-password-recovery`,{email:t}).subscribe({next:e=>{this.isLoading.set(!1),this.successMessage.set("C\xF3digo enviado. Revisa tu Telegram."),setTimeout(()=>{this.router.navigate(["/forgot-password"],{queryParams:{step:"otp",email:t}})},1500)},error:e=>{this.isLoading.set(!1),this.errorMessage.set(e.error?.message_text||e.error?.message||"Error al solicitar recuperaci\xF3n. Verifica tu email.")}})}verifyRecoveryCode(){let t=this.email(),e=this.otpCode();if(!this.isCodeValid()){this.errorMessage.set("Por favor ingresa un c\xF3digo v\xE1lido de 6 d\xEDgitos");return}this.isLoading.set(!0),this.errorMessage.set(null),this.http.post(`${y.url}users/verify-recovery-otp`,{email:t,code:e}).subscribe({next:s=>{this.isLoading.set(!1),this.successMessage.set("C\xF3digo verificado correctamente."),localStorage.setItem("recoveryToken",s.recoveryToken),setTimeout(()=>{this.router.navigate(["/forgot-password"],{queryParams:{step:"password",email:t}})},1500)},error:s=>{this.isLoading.set(!1),s.error?.attemptsRemaining!==void 0&&this.attemptsRemaining.set(s.error.attemptsRemaining),this.errorMessage.set(s.error?.message_text||s.error?.message||"C\xF3digo incorrecto. Int\xE9ntalo de nuevo.")}})}resetPassword(){let t=this.newPassword(),e=this.confirmPassword(),s=localStorage.getItem("recoveryToken");if(!this.isPasswordValid()){this.errorMessage.set("Las contrase\xF1as deben coincidir y tener al menos 6 caracteres");return}if(!s){this.errorMessage.set("Token de recuperaci\xF3n no encontrado. Solicita un nuevo c\xF3digo.");return}this.isLoading.set(!0),this.errorMessage.set(null),this.http.post(`${y.url}users/reset-password`,{recoveryToken:s,newPassword:t}).subscribe({next:l=>{this.isLoading.set(!1),this.successMessage.set("Contrase\xF1a restablecida exitosamente. Redirigiendo al login..."),localStorage.removeItem("recoveryToken"),setTimeout(()=>{this.router.navigate(["/login"])},2e3)},error:l=>{this.isLoading.set(!1),this.errorMessage.set(l.error?.message_text||l.error?.message||"Error al restablecer la contrase\xF1a. Int\xE9ntalo de nuevo.")}})}resendRecoveryCode(){let t=this.email();if(!t){this.errorMessage.set("Email no encontrado");return}this.isLoading.set(!0),this.errorMessage.set(null),this.http.post(`${y.url}users/resend-recovery-otp`,{email:t}).subscribe({next:e=>{this.isLoading.set(!1),this.successMessage.set("C\xF3digo reenviado. Revisa tu Telegram."),this.countdown.set(600),this.resendCountdown.set(60),this.canResend.set(!1),this.startExpirationCountdown(),this.startResendCountdown()},error:e=>{this.isLoading.set(!1),e.error?.waitSeconds&&(this.resendCountdown.set(e.error.waitSeconds),this.startResendCountdown()),this.errorMessage.set(e.error?.message_text||e.error?.message||"Error al reenviar c\xF3digo. Int\xE9ntalo de nuevo.")}})}onOtpInput(t){let e=t.target.value.replace(/\D/g,"").slice(0,6);this.otpCode.set(e),t.target.value=e}goToLogin(){this.router.navigate(["/login"])}goBackToEmail(){this.currentStep.set("email"),this.router.navigate(["/forgot-password"])}goBackToOtp(){this.currentStep.set("otp"),this.router.navigate(["/forgot-password"],{queryParams:{step:"otp",email:this.email()}})}startExpirationCountdown(){this.clearTimers(),this.countdownInterval=setInterval(()=>{let t=this.countdown();t>0?this.countdown.set(t-1):(this.clearTimers(),this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."),this.canResend.set(!0))},1e3)}startResendCountdown(){this.resendInterval=setInterval(()=>{let t=this.resendCountdown();t>0?this.resendCountdown.set(t-1):(this.canResend.set(!0),clearInterval(this.resendInterval))},1e3)}clearTimers(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null),this.resendInterval&&(clearInterval(this.resendInterval),this.resendInterval=null)}static \u0275fac=function(e){return new(e||n)(P(V),P(R),P(L))};static \u0275cmp=M({type:n,selectors:[["app-forgot-password"]],decls:28,vars:7,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","py-8","sm:py-12","px-4"],[1,"w-full","max-w-md","mx-auto"],[1,"bg-slate-800","border","border-white/10","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"w-16","h-16","bg-blue-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-300","text-sm"],[1,"mb-4","p-4","bg-red-500/10","border","border-red-500/30","rounded-lg"],[1,"mb-4","p-4","bg-green-500/10","border","border-green-500/30","rounded-lg"],[1,"mt-6","text-center","space-y-2"],["type","button",1,"text-slate-400","hover:text-white","text-sm","transition-colors"],["type","button",1,"text-slate-400","hover:text-white","text-sm","transition-colors",3,"click"],[1,"mt-6","text-center"],[1,"text-slate-500","text-xs"],[1,"text-red-400","text-sm","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-green-400","text-sm","flex","items-center","gap-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"mb-6"],[1,"block","text-slate-300","text-sm","font-medium","mb-3"],["type","email","placeholder","tu@correo.com","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","border-slate-700","rounded-lg","text-white","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:border-transparent","transition-all",3,"input","value"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["type","text","inputmode","numeric","maxlength","6","placeholder","000000","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","rounded-lg","text-white","text-center","text-2xl","font-mono","tracking-widest","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:border-transparent","transition-all",3,"input","value","disabled"],[1,"text-yellow-400","text-xs","mt-2","text-center"],[1,"mb-6","text-center"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","mb-4","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","border-2","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"text-slate-400","text-sm","flex","items-center","justify-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-white","font-mono"],[1,"text-red-400","text-sm","font-medium"],[1,"space-y-4"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","border-slate-700","rounded-lg","text-white","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:border-transparent","transition-all",3,"input","value"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","px-4","py-3","bg-slate-900/50","border","border-slate-700","rounded-lg","text-white","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:border-transparent","transition-all",3,"input","value"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","mt-6","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(e,s){e&1&&(w(0,"app-header"),i(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),_(),i(6,"svg",5),w(7,"path",6),o()(),v(),i(8,"h1",7),r(9,"Recuperar Contrase\xF1a"),o(),i(10,"p",8),c(11,N,1,0)(12,H,1,0)(13,O,1,0),o()(),c(14,q,6,1,"div",9),c(15,j,6,1,"div",10),c(16,G,7,13),c(17,Y,14,36),c(18,te,12,14),i(19,"div",11),c(20,ne,2,0,"button",12)(21,ie,2,0,"button",12),i(22,"div")(23,"button",13),p("click",function(){return s.goToLogin()}),r(24," \u2190 Volver al login "),o()()()(),i(25,"div",14)(26,"p",15),r(27," Si no recibes el c\xF3digo, verifica que tu Telegram est\xE9 activo "),o()()()()),e&2&&(a(11),u(s.currentStep()==="email"?11:s.currentStep()==="otp"?12:13),a(3),u(s.errorMessage()?14:-1),a(),u(s.successMessage()?15:-1),a(),u(s.currentStep()==="email"?16:-1),a(),u(s.currentStep()==="otp"?17:-1),a(),u(s.currentStep()==="password"?18:-1),a(2),u(s.currentStep()==="otp"?20:s.currentStep()==="password"?21:-1))},dependencies:[I,k],encapsulation:2})};export{D as ForgotPasswordComponent};
