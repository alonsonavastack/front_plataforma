import{a as s}from"./chunk-F4KIANN2.js";import{Jc as l,O as a,T as r,ec as i,ja as e}from"./chunk-6JS7X5LE.js";var c=class n{http=r(l);notifications=e([]);isLoading=e(!1);lastCheck=e(new Date);pendingReviews=i(()=>this.notifications());count=i(()=>this.notifications().length);hasNotifications=i(()=>this.count()>0);recentCount=i(()=>this.notifications().filter(t=>t.isRecent).length);pollingInterval;constructor(){}startPolling(){this.loadNotifications(),this.pollingInterval=setInterval(()=>{this.loadNotifications()},180*1e3)}stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=void 0)}loadNotifications(){this.isLoading()||(this.isLoading.set(!0),this.http.get(`${s.url}reviews/instructor/pending-replies`).subscribe({next:t=>{this.notifications.set(t.notifications||[]),this.lastCheck.set(new Date),this.isLoading.set(!1)},error:t=>{this.isLoading.set(!1),(t.status===401||t.status===403)&&this.stopPolling()}}))}markAsReplied(t){let o=this.notifications().filter(d=>d._id!==t);this.notifications.set(o)}markAllAsRead(){this.http.post(`${s.url}reviews/instructor/mark-all-read`,{}).subscribe({next:t=>{this.notifications.set([])},error:t=>{alert("Error al marcar las notificaciones como le\xEDdas. Int\xE9ntalo de nuevo.")}})}reload(){this.loadNotifications()}clear(){this.notifications.set([])}ngOnDestroy(){this.stopPolling()}static \u0275fac=function(o){return new(o||n)};static \u0275prov=a({token:n,factory:n.\u0275fac,providedIn:"root"})};export{c as a};
