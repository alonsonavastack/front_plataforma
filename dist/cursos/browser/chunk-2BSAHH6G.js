import{b as D}from"./chunk-N2VNJZVV.js";import{c as R,e as I}from"./chunk-UKUKXRH6.js";import"./chunk-TCGJFX72.js";import{x as k}from"./chunk-QA5A7GBQ.js";import{a as T}from"./chunk-M2BUHLXO.js";import{$ as f,Eb as x,Gb as r,Hb as b,Ib as _,Jb as V,Ma as a,Ta as E,Xa as M,Y as w,Z as y,_ as p,ec as h,hb as m,ib as c,ja as l,rb as i,sb as s,tb as u,ub as S,vb as C,xb as v,yb as g}from"./chunk-6JS7X5LE.js";import"./chunk-I4MTPUBM.js";function L(o,t){if(o&1&&(i(0,"p",9),r(1),s()),o&2){let n=g();a(),_(" \u{1F4F1} ",n.maskedPhone()," ")}}function F(o,t){if(o&1&&(i(0,"div",10)(1,"p",29),p(),i(2,"svg",30),u(3,"path",31),s(),f(),i(4,"span"),r(5),s()()()),o&2){let n=g();a(5),b(n.errorMessage())}}function z(o,t){if(o&1&&(i(0,"div",11)(1,"p",32),p(),i(2,"svg",30),u(3,"path",33),s(),f(),i(4,"span"),r(5),s()()()),o&2){let n=g();a(5),b(n.successMessage())}}function H(o,t){if(o&1&&(i(0,"p",15),r(1),s()),o&2){let n=g();a(),V(" \u26A0\uFE0F Te quedan ",n.attemptsRemaining()," ",n.attemptsRemaining()===1?"intento":"intentos"," ")}}function P(o,t){if(o&1&&(i(0,"div",16)(1,"p",34),p(),i(2,"svg",35),u(3,"path",36),s(),f(),i(4,"span"),r(5,"Expira en: "),i(6,"strong",37),r(7),s()()()()),o&2){let n=g();a(7),b(n.timeRemaining())}}function j(o,t){o&1&&(i(0,"div",16)(1,"p",38),r(2," \u23F0 El c\xF3digo ha expirado "),s()())}function A(o,t){if(o&1){let n=S();i(0,"div",17)(1,"p",39),r(2," \xBFNo recibiste el c\xF3digo? "),s(),i(3,"button",40),v("click",function(){w(n);let d=g();return y(d.openTelegram())}),p(),i(4,"svg",41),u(5,"path",42),s(),f(),i(6,"span",43),r(7,"1. Vincular Telegram"),s()(),i(8,"p",44),r(9,' Haz clic, da "Iniciar" al bot y luego pide reenv\xEDo. '),s()()}}function $(o,t){o&1&&(i(0,"span",19),p(),i(1,"svg",45),u(2,"circle",46)(3,"path",47),s(),f(),i(4,"span"),r(5,"Verificando..."),s()())}function B(o,t){o&1&&(i(0,"span"),r(1,"Verificar C\xF3digo"),s())}function G(o,t){o&1&&(i(0,"span",19),p(),i(1,"svg",45),u(2,"circle",46)(3,"path",47),s(),f(),i(4,"span"),r(5,"Reenviando..."),s()())}function X(o,t){if(o&1&&(i(0,"span"),r(1),s()),o&2){let n=g();a(),_("Reenviar en ",n.resendTimeRemaining())}}function q(o,t){o&1&&(p(),i(0,"svg",48),u(1,"path",49),s())}function U(o,t){if(o&1&&(i(0,"span",19),m(1,q,2,0,":svg:svg",48),i(2,"span"),r(3,"Reenviar C\xF3digo"),s()()),o&2){let n,e=g();a(),c(e.canResend()&&((n=e.errorMessage())!=null&&n.includes("inicial"))?1:-1)}}var O=class o{constructor(t,n,e){this.authService=t;this.router=n;this.route=e}otpCode=l("");userId=l(null);phone=l(null);isVerifying=l(!1);isResending=l(!1);canResend=l(!1);countdown=l(600);resendCountdown=l(0);errorMessage=l(null);successMessage=l(null);attemptsRemaining=l(3);countdownInterval;resendInterval;timeRemaining=h(()=>{let t=this.countdown(),n=Math.floor(t/60),e=t%60;return`${n.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`});resendTimeRemaining=h(()=>`${this.resendCountdown()}s`);maskedPhone=h(()=>{let t=this.phone();if(!t||t.length<10)return t;let n=t.substring(0,2),e=t.substring(2,5),d=t.substring(t.length-4);return`+${n} ${e} XXXX ${d}`});isCodeValid=h(()=>{let t=this.otpCode();return t.length===6&&/^\d+$/.test(t)});telegramLink=h(()=>{let t=T.telegramBot,n=this.userId();return!t||!n?null:`https://t.me/${t}?start=${n}`});openTelegram(){let t=this.telegramLink();t&&window.open(t,"_blank")}ngOnInit(){this.route.queryParams.subscribe(t=>{let n=t.userId,e=t.phone,d=t.error;if(!n){this.router.navigate(["/register"]);return}this.userId.set(n),this.phone.set(e||null),d==="otp_not_sent"&&(this.errorMessage.set('\u26A0\uFE0F No se pudo enviar el c\xF3digo inicial. Por favor, haz clic en "Reenviar C\xF3digo".'),this.canResend.set(!0))}),this.startExpirationCountdown()}ngOnDestroy(){this.clearTimers()}startExpirationCountdown(){this.clearTimers(),this.countdownInterval=setInterval(()=>{let t=this.countdown();t>0?this.countdown.set(t-1):(this.clearTimers(),this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."))},1e3)}startResendCountdown(){this.resendInterval&&clearInterval(this.resendInterval),this.canResend.set(!1),this.resendCountdown.set(60),this.resendInterval=setInterval(()=>{let t=this.resendCountdown();t>1?this.resendCountdown.set(t-1):(clearInterval(this.resendInterval),this.resendCountdown.set(0),this.canResend.set(!0))},1e3)}clearTimers(){this.countdownInterval&&clearInterval(this.countdownInterval),this.resendInterval&&clearInterval(this.resendInterval)}onOtpInput(t){let e=t.target.value.replace(/\D/g,"");e.length>6&&(e=e.substring(0,6)),this.otpCode.set(e),this.errorMessage.set(null)}verifyCode(){if(!this.isCodeValid()){this.errorMessage.set("Por favor, ingresa un c\xF3digo de 6 d\xEDgitos");return}let t=this.userId();if(!t){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isVerifying.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.verifyOtp(t,this.otpCode()).subscribe({next:n=>{this.successMessage.set(n.message||"\xA1Cuenta verificada exitosamente!"),this.clearTimers(),setTimeout(()=>{},2e3)},error:n=>{this.isVerifying.set(!1),n.status===400?(this.errorMessage.set(n.error.message_text||"C\xF3digo incorrecto"),n.error.attemptsRemaining!==void 0&&(this.attemptsRemaining.set(n.error.attemptsRemaining),n.error.attemptsRemaining===0&&this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."))):n.status===403?(this.errorMessage.set("Has excedido el n\xFAmero de intentos. Solicita un nuevo c\xF3digo."),this.attemptsRemaining.set(0)):n.status===410?(this.errorMessage.set("El c\xF3digo ha expirado. Solicita uno nuevo."),this.clearTimers()):this.errorMessage.set(n.error?.message_text||"Ocurri\xF3 un error. Int\xE9ntalo de nuevo."),this.otpCode.set("")},complete:()=>{this.isVerifying.set(!1)}})}resendCode(){if(!this.canResend()&&this.resendCountdown()>0){this.errorMessage.set(`Debes esperar ${this.resendCountdown()} segundos antes de reenviar`);return}let t=this.userId();if(!t){this.errorMessage.set("Error: No se encontr\xF3 el ID del usuario");return}this.isResending.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.authService.resendOtp(t).subscribe({next:n=>{this.successMessage.set(n.message||"C\xF3digo reenviado exitosamente"),this.countdown.set(600),this.startExpirationCountdown(),this.startResendCountdown(),this.attemptsRemaining.set(3),this.otpCode.set("")},error:n=>{n.status===429?n.error.waitSeconds?(this.errorMessage.set(n.error.message_text),this.resendCountdown.set(n.error.waitSeconds),this.startResendCountdown()):this.errorMessage.set(n.error.message_text||"Has alcanzado el l\xEDmite de reenv\xEDos"):this.errorMessage.set(n.error?.message_text||"Error al reenviar el c\xF3digo")},complete:()=>{this.isResending.set(!1)}})}goToRegister(){this.clearTimers(),this.router.navigate(["/register"])}static \u0275fac=function(n){return new(n||o)(E(D),E(I),E(R))};static \u0275cmp=M({type:o,selectors:[["app-verify-otp"]],decls:41,vars:42,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-slate-800","to-slate-900","py-8","sm:py-12","px-4"],[1,"w-full","max-w-md","mx-auto"],[1,"bg-slate-800","border","border-white/10","rounded-2xl","shadow-2xl","p-8"],[1,"text-center","mb-8"],[1,"w-16","h-16","bg-lime-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-lime-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-300","text-sm"],[1,"text-lime-400","font-mono","text-sm","mt-2"],[1,"mb-4","p-4","bg-red-500/10","border","border-red-500/30","rounded-lg"],[1,"mb-4","p-4","bg-lime-500/10","border","border-lime-500/30","rounded-lg"],[1,"mb-6"],[1,"block","text-slate-300","text-sm","font-medium","mb-3"],["type","text","inputmode","numeric","maxlength","6","placeholder","000000","autofocus","",1,"w-full","px-4","py-3","bg-slate-900/50","border","rounded-lg","text-white","text-center","text-2xl","font-mono","tracking-widest","placeholder-slate-600","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:border-transparent","transition-all",3,"input","value","disabled"],[1,"text-yellow-400","text-xs","mt-2","text-center"],[1,"mb-6","text-center"],[1,"mb-6","pt-4","border-t","border-slate-700"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","focus:outline-none","focus:ring-2","focus:ring-lime-400","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"relative","my-6"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-slate-700"],[1,"relative","flex","justify-center","text-sm"],[1,"px-2","bg-slate-800","text-slate-400"],["type","button",1,"w-full","py-3","px-4","rounded-lg","font-medium","transition-all","border-2","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-offset-slate-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mt-6","text-center"],["type","button",1,"text-slate-400","hover:text-white","text-sm","transition-colors",3,"click"],[1,"text-slate-500","text-xs"],[1,"text-red-400","text-sm","flex","items-center","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"text-lime-400","text-sm","flex","items-center","gap-2"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-slate-400","text-sm","flex","items-center","justify-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-white","font-mono"],[1,"text-red-400","text-sm","font-medium"],[1,"text-slate-400","text-sm","text-center","mb-3"],[1,"w-full","flex","items-center","justify-center","gap-2","px-4","py-2","bg-[#229ED9]/10","hover:bg-[#229ED9]/20","border","border-[#229ED9]/30","rounded-lg","transition-colors","group",3,"click"],["viewBox","0 0 24 24","fill","currentColor",1,"w-5","h-5","text-[#229ED9]"],["d","M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"],[1,"text-[#229ED9]","font-medium"],[1,"text-xs","text-slate-500","mt-2","text-center"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"]],template:function(n,e){if(n&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),p(),i(5,"svg",5),u(6,"path",6),s()(),f(),i(7,"h1",7),r(8,"Verificaci\xF3n de Cuenta"),s(),i(9,"p",8),r(10," Ingresa el c\xF3digo de 6 d\xEDgitos enviado a tu Telegram "),s(),m(11,L,2,1,"p",9),s(),m(12,F,6,1,"div",10),m(13,z,6,1,"div",11),i(14,"div",12)(15,"label",13),r(16," C\xF3digo de Verificaci\xF3n "),s(),i(17,"input",14),v("input",function(N){return e.onOtpInput(N)}),s(),m(18,H,2,2,"p",15),s(),m(19,P,8,1,"div",16)(20,j,3,0,"div",16),m(21,A,10,0,"div",17),i(22,"button",18),v("click",function(){return e.verifyCode()}),m(23,$,6,0,"span",19)(24,B,2,0,"span"),s(),i(25,"div",20)(26,"div",21),u(27,"div",22),s(),i(28,"div",23)(29,"span",24),r(30,"\xBFNo recibiste el c\xF3digo?"),s()()(),i(31,"button",25),v("click",function(){return e.resendCode()}),m(32,G,6,0,"span",19)(33,X,2,1,"span")(34,U,4,1,"span",19),s(),i(35,"div",26)(36,"button",27),v("click",function(){return e.goToRegister()}),r(37," \u2190 Volver al registro "),s()()(),i(38,"div",26)(39,"p",28),r(40," Si no recibes el c\xF3digo, verifica que tu Telegram est\xE9 activo "),s()()()()),n&2){let d;a(11),c(e.maskedPhone()?11:-1),a(),c(e.errorMessage()?12:-1),a(),c(e.successMessage()?13:-1),a(4),x("border-slate-700",!e.errorMessage())("border-red-500",e.errorMessage()),C("value",e.otpCode())("disabled",e.isVerifying()||e.countdown()===0),a(),c(e.attemptsRemaining()<3&&e.attemptsRemaining()>0?18:-1),a(),c(e.countdown()>0?19:20),a(2),c(e.telegramLink()?21:-1),a(),x("bg-lime-500",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("hover:bg-lime-600",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("text-slate-900",e.isCodeValid()&&!e.isVerifying()&&e.countdown()>0)("bg-slate-700",!e.isCodeValid()||e.isVerifying()||e.countdown()===0)("text-slate-400",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),C("disabled",!e.isCodeValid()||e.isVerifying()||e.countdown()===0),a(),c(e.isVerifying()?23:24),a(8),x("border-cyan-500",e.canResend()||e.resendCountdown()===0)("text-cyan-400",e.canResend()||e.resendCountdown()===0)("hover:bg-cyan-500/10",e.canResend()||e.resendCountdown()===0)("focus:ring-cyan-400",e.canResend()||e.resendCountdown()===0)("border-slate-700",!e.canResend()&&e.resendCountdown()>0)("text-slate-500",!e.canResend()&&e.resendCountdown()>0)("focus:ring-slate-400",!e.canResend()&&e.resendCountdown()>0)("animate-pulse",e.canResend()&&((d=e.errorMessage())==null?null:d.includes("inicial"))),C("disabled",e.isResending()||!e.canResend()&&e.resendCountdown()>0),a(),c(e.isResending()?32:!e.canResend()&&e.resendCountdown()>0?33:34)}},dependencies:[k],encapsulation:2})};export{O as VerifyOtpComponent};
