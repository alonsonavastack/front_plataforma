import{a as i}from"./chunk-ZGVWU7EJ.js";import{Hc as g,Jc as l,O as d,T as m,ec as n,fc as r,ja as a,o as s}from"./chunk-6JS7X5LE.js";var c=class o{http=m(l);apiUrl=`${i.url}instructor`;_paymentConfig=a(null);_isLoadingPaymentConfig=a(!1);_paymentConfigError=a(null);paymentConfig=n(()=>this._paymentConfig());isLoadingPaymentConfig=n(()=>this._isLoadingPaymentConfig());paymentConfigError=n(()=>this._paymentConfigError());earningsStatusInput=a(void 0);earningsStartDateInput=a(void 0);earningsEndDateInput=a(void 0);earningsPageInput=a(1);earningsLimitInput=a(10);earningsResource=r({loader:()=>{let e=new g,t=this.earningsStatusInput();t&&(e=e.set("status",t));let u=this.earningsStartDateInput();u&&(e=e.set("startDate",u));let p=this.earningsEndDateInput();return p&&(e=e.set("endDate",p)),e=e.set("page",this.earningsPageInput().toString()),e=e.set("limit",this.earningsLimitInput().toString()),s(this.http.get(`${this.apiUrl}/earnings`,{params:e}))}});earnings=n(()=>this.earningsResource.value()?.earnings??[]);earningsPagination=n(()=>this.earningsResource.value()?.pagination??null);isLoadingEarnings=n(()=>this.earningsResource.isLoading());earningsError=n(()=>this.earningsResource.error());statsReloadTrigger=a(0);statsResource=r({loader:()=>(this.statsReloadTrigger(),s(this.http.get(`${this.apiUrl}/earnings/stats`)))});earningsStats=n(()=>{let e=this.statsResource.value();if(!e)return null;let t=e.stats;return{pending:t.pending||{total:0,count:0},available:t.available||{total:0,count:0},paid:t.paid||{total:0,count:0},refunds:t.refunds||{total:0,count:0},total:t.total||{total:0,count:0},total_earned:t.total?.total||0,total_sales:t.totalCoursesSold||0,average_per_sale:parseFloat(t.averagePerSale||0),earnings_by_month:t.byMonth||[]}});isLoadingStats=n(()=>this.statsResource.isLoading());statsError=n(()=>this.statsResource.error());paymentHistoryPageInput=a(1);paymentHistoryLimitInput=a(10);paymentHistoryResource=r({loader:()=>{let e=new g().set("page",this.paymentHistoryPageInput().toString()).set("limit",this.paymentHistoryLimitInput().toString());return s(this.http.get(`${this.apiUrl}/payments/history`,{params:e}))}});paymentHistory=n(()=>this.paymentHistoryResource.value()?.payments??[]);paymentHistoryPagination=n(()=>this.paymentHistoryResource.value()?.pagination??null);isLoadingPaymentHistory=n(()=>this.paymentHistoryResource.isLoading());paymentHistoryError=n(()=>this.paymentHistoryResource.error());setEarningsFilters(e){e.status!==void 0&&this.earningsStatusInput.set(e.status),e.startDate!==void 0&&this.earningsStartDateInput.set(e.startDate),e.endDate!==void 0&&this.earningsEndDateInput.set(e.endDate),e.page!==void 0&&this.earningsPageInput.set(e.page),e.limit!==void 0&&this.earningsLimitInput.set(e.limit)}clearEarningsFilters(){this.earningsStatusInput.set(void 0),this.earningsStartDateInput.set(void 0),this.earningsEndDateInput.set(void 0),this.earningsPageInput.set(1),this.earningsLimitInput.set(10)}setPaymentHistoryPage(e){this.paymentHistoryPageInput.set(e)}setPaymentHistoryLimit(e){this.paymentHistoryLimitInput.set(e)}reloadPaymentConfig(){this._isLoadingPaymentConfig.set(!0),this._paymentConfigError.set(null),this.http.get(`${this.apiUrl}/payment-config`).subscribe({next:e=>{this._paymentConfig.set(e.config),this._isLoadingPaymentConfig.set(!1)},error:e=>{console.error("\u274C [Service] Error al cargar config:",e),this._paymentConfigError.set(e),this._isLoadingPaymentConfig.set(!1)}})}reloadEarnings(){this.earningsResource.reload()}reloadStats(){this.statsReloadTrigger.update(e=>e+1)}reloadPaymentHistory(){this.paymentHistoryResource.reload()}connectPaypal(e,t){return this.http.post(`${this.apiUrl}/payment-config/paypal/connect`,{code:e,redirect_uri:t})}startStripeOnboarding(){return this.http.post(`${i.url}stripe/connect/onboard`,{})}getStripeStatus(){return this.http.get(`${i.url}stripe/connect/status`)}getStripeDashboardLink(){return this.http.get(`${i.url}stripe/connect/dashboard`)}updatePaypalConfig(e){return this.http.post(`${this.apiUrl}/payment-config/paypal`,e)}updatePreferredMethod(e){return this.http.put(`${this.apiUrl}/payment-config`,{preferred_payment_method:e})}deletePaypalConfig(){return this.http.delete(`${this.apiUrl}/payment-config/paypal`)}getPublicPaymentConfig(){let e=`${i.url}payment-settings/public`;return this.http.get(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a};
