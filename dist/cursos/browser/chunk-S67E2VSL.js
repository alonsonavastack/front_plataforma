import{b as h}from"./chunk-C4QL5PZB.js";import{a as g}from"./chunk-ZGVWU7EJ.js";import{Gc as l,Jc as p,O as d,T as n,ec as c,ja as o,ka as u}from"./chunk-6JS7X5LE.js";var f=class i{http=n(p);authService=n(h);reloadTrigger=o(0);purchasesData=o({enrolled_courses:[],projects:[]});loading=o(!1);errorSignal=o(null);constructor(){u(()=>{let e=this.authService.token(),s=this.reloadTrigger();if(!e){this.purchasesData.set({enrolled_courses:[],projects:[]});return}this.loading.set(!0);let r=new l({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}),t=Date.now(),m=`${g.url}profile-student/client?_=${t}`;this.http.get(m,{headers:r}).subscribe({next:a=>{this.purchasesData.set(a),this.loading.set(!1),this.errorSignal.set(null)},error:a=>{console.error("Error loading purchases",a),this.errorSignal.set(a),this.loading.set(!1)}})})}purchasedProductsSet=c(()=>{let e=this.purchasesData();if(!e)return new Set;let s=new Set;return e.enrolled_courses&&e.enrolled_courses.forEach(r=>{let t=r.course?._id||r.course;t&&s.add(t)}),e.projects&&e.projects.forEach(r=>{let t=r._id||r.project?._id;t&&s.add(t)}),s});isLoading=this.loading.asReadonly();isLoaded=c(()=>!this.loading());error=this.errorSignal.asReadonly();isPurchased(e){return this.purchasedProductsSet().has(e)}getPurchasedProducts(){return this.purchasedProductsSet}loadPurchasedProducts(){this.reloadTrigger.update(e=>e+1)}clearPurchases(){this.reloadTrigger.set(0),this.purchasesData.set({enrolled_courses:[],projects:[]})}static \u0275fac=function(s){return new(s||i)};static \u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"})};export{f as a};
