import{a as d}from"./chunk-3WVJGZJK.js";import{a as v}from"./chunk-J4IQXLML.js";import{Jc as j,O as f,T as _,ec as l,ja as a,k as m,ka as p,p as g,z as b}from"./chunk-6JS7X5LE.js";var y=class h{http=_(j);base=v.url;homeData=a({categories:[],courses_top:[],categories_sections:[],courses_banners:[],campaing_banner:null,courses_flash:[],campaing_flash:null,projects_featured:[],courses_featured:[]});homeLoading=a(!1);homeError=a(null);coursesData=a([]);coursesLoading=a(!1);projectsData=a([]);projectsLoading=a(!1);home=this.homeData.asReadonly();isLoadingHome=this.homeLoading.asReadonly();hasErrorHome=l(()=>!!this.homeError());errorHome=this.homeError.asReadonly();allCourses=this.coursesData.asReadonly();allProjects=this.projectsData.asReadonly();isLoadingCourses=this.coursesLoading.asReadonly();isLoadingProjects=this.projectsLoading.asReadonly();featuredCourses=l(()=>{let e=this.home(),s=e.courses_top??[],o=(e.categories_sections??[]).flatMap(t=>t.courses??[]),n=e.courses_banners??[],r=e.courses_flash??[],i=new Map;for(let t of[...s,...o,...n,...r]){let c=t?._id;c&&i.set(c,t)}return Array.from(i.values())});reloadHome(){this.homeLoading.set(!0),this.homeError.set(null);let e=`${this.base}home/list${d({TIME_NOW:Date.now()})}`;this.http.get(e).subscribe({next:s=>{this.homeData.set(s),this.homeLoading.set(!1)},error:s=>{this.homeError.set(s),this.homeLoading.set(!1)}})}reloadAllCourses(){this.coursesLoading.set(!0);let e=`${this.base}home/get_all_courses`;this.http.get(e).pipe(g(s=>s.courses||[])).subscribe({next:s=>{this.coursesData.set(s),this.coursesLoading.set(!1)},error:()=>{this.coursesLoading.set(!1)}})}reloadAllProjects(){this.projectsLoading.set(!0);let e=`${this.base}home/get_all_projects`;this.http.get(e).pipe(g(s=>s.projects||[])).subscribe({next:s=>{this.projectsData.set(s),this.projectsLoading.set(!1)},error:()=>{this.projectsLoading.set(!1)}})}searchCourses(e){let s=`${this.base}home/search_course${d({TIME_NOW:Date.now()})}`,o=(e.q??"").trim(),n={q:o||void 0,search:o||void 0,categorie:e.categorie||void 0,categorie_id:e.categorie||void 0};return this.http.post(s,n).pipe(g(r=>Array.isArray(r)?r:Array.isArray(r?.courses)?r.courses:Array.isArray(r?.data?.courses)?r.data.courses:Array.isArray(r?.data)?r.data:[]),b(r=>m(()=>r)))}coursePublicResource=e=>{let s=a({course:void 0,reviews:[],course_instructor:[],course_relateds:[],student_have_course:!1}),o=a(!1),n=a(null),r="",i=()=>{let t=e();if(!t||t===r)return;r=t,o.set(!0),n.set(null);let c=`${this.base}home/landing-curso/${t}${d({TIME_NOW:Date.now()})}`;this.http.get(c).subscribe({next:u=>{s.set(u),o.set(!1)},error:u=>{n.set(u),o.set(!1)}})};return p(()=>{i()},{allowSignalWrites:!0}),{value:s.asReadonly(),isLoading:o.asReadonly(),hasError:l(()=>!!n()),error:n.asReadonly(),reload:i}};projectPublicResource=e=>{let s=a({project:void 0,reviews:[],project_relateds:[],student_have_project:!1}),o=a(!1),n=a(null),r="",i=()=>{let t=e();if(!t||t===r)return;r=t,o.set(!0),n.set(null);let c=`${this.base}home/landing-project/${t}${d({TIME_NOW:Date.now()})}`;this.http.get(c).subscribe({next:u=>{s.set(u),o.set(!1)},error:u=>{n.set(u),o.set(!1)}})};return p(()=>{i()},{allowSignalWrites:!0}),{value:s.asReadonly(),isLoading:o.asReadonly(),hasError:l(()=>!!n()),error:n.asReadonly(),reload:i}};buildCourseImageUrl(e){return e?`${this.base}courses/imagen-course/${e}`:"https://i.pravatar.cc/300?u=placeholder"}buildProjectImageUrl(e){return e?`${this.base}projects/imagen-project/${e}`:"https://i.pravatar.cc/300?u=placeholder"}downloadProjectFile(e,s){let o=`${this.base}projects/download-file/${e}/${s}`;return this.http.get(o,{responseType:"blob"})}static \u0275fac=function(s){return new(s||h)};static \u0275prov=f({token:h,factory:h.\u0275fac,providedIn:"root"})};export{y as a};
