import{e as I,g as P}from"./chunk-VM3MHBTU.js";import{a as M}from"./chunk-ZGVWU7EJ.js";import{$ as _,Ac as w,Gb as r,Hb as g,Ib as y,Jc as S,Ma as d,T as c,Xa as h,Y as u,Z as p,_ as E,hb as v,ib as b,ja as l,rb as t,sb as o,tb as x,ub as C,xb as f,yb as m}from"./chunk-6JS7X5LE.js";import"./chunk-I4MTPUBM.js";function T(i,n){if(i&1&&(x(0,"div",2),t(1,"h2",3),r(2,"Procesando tu pago..."),o(),t(3,"p",4),r(4,"Espera un momento por favor"),o(),t(5,"p",5),r(6),o()),i&2){let e=m();d(6),g(e.statusMessage())}}function L(i,n){if(i&1){let e=C();t(0,"div",6),E(),t(1,"svg",7),x(2,"path",8),o()(),_(),t(3,"h2",3),r(4,"Error al verificar pago"),o(),t(5,"p",9),r(6),o(),t(7,"button",10),f("click",function(){u(e);let s=m();return p(s.goToHome())}),r(8," Volver al inicio "),o()}if(i&2){let e=m();d(6),g(e.error())}}function V(i,n){if(i&1&&(t(0,"p",14),r(1," Operaci\xF3n: "),t(2,"span",19),r(3),o()()),i&2){let e=m(2);d(3),g(e.paymentId())}}function D(i,n){if(i&1){let e=C();t(0,"div",11),E(),t(1,"svg",12),x(2,"path",13),o()(),_(),t(3,"h2",3),r(4,"\xA1Pago exitoso!"),o(),t(5,"p",9),r(6,"Tu compra se ha procesado correctamente"),o(),v(7,V,4,1,"p",14),t(8,"p",15),r(9),o(),t(10,"div",16)(11,"button",17),f("click",function(){u(e);let s=m();return p(s.goToMyCourses())}),r(12," Ir ahora "),o(),t(13,"button",18),f("click",function(){u(e);let s=m();return p(s.goToHome())}),r(14," Inicio "),o()()}if(i&2){let e=m();d(7),b(e.preferenceId()?7:-1),d(2),y(" \u2728 Redirigiendo a tus compras en ",e.countdown()," segundos... ")}}var k=class i{http=c(S);route=c(I);router=c(P);isLoading=l(!0);error=l(null);preferenceId=l(null);paymentId=l(null);statusMessage=l("Verificando con Mercado Pago...");countdown=l(5);API_URL=M.url;ngOnInit(){this.route.queryParams.subscribe(n=>{this.preferenceId.set(n.preference_id||null),this.paymentId.set(n.payment_id||n.collection_id||null),console.log("\u{1F389} [PaymentSuccess] Par\xE1metros recibidos:",{preference_id:this.preferenceId(),payment_id:this.paymentId()}),this.waitForPaymentConfirmation()})}async waitForPaymentConfirmation(){let n=0,e=10,a=async()=>{n++,this.statusMessage.set(`Verificando pago... (intento ${n}/${e})`);try{await new Promise(s=>setTimeout(s,1e3)),n>=3?(this.isLoading.set(!1),this.startCountdown()):a()}catch(s){console.error("\u274C [PaymentSuccess] Error:",s),n<e?a():(this.error.set("No pudimos verificar tu pago, pero tu compra fue exitosa."),this.isLoading.set(!1))}};a()}startCountdown(){let n=setInterval(()=>{let e=this.countdown();e>1?this.countdown.set(e-1):(clearInterval(n),this.goToMyCourses())},1e3)}goToMyCourses(){this.router.navigate(["/profile-student"],{fragment:"courses"})}goToHome(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-payment-success"]],decls:5,vars:1,consts:[[1,"min-h-screen","bg-slate-900","flex","items-center","justify-center","p-4"],[1,"max-w-md","w-full","bg-slate-800","rounded-lg","border","border-white/10","p-8","text-center"],[1,"animate-spin","rounded-full","h-16","w-16","border-4","border-lime-400","border-t-transparent","mx-auto","mb-6"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-400"],[1,"text-xs","text-slate-500","mt-4"],[1,"w-16","h-16","bg-red-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-6"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","text-red-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-slate-400","mb-6"],[1,"w-full","px-4","py-3","bg-slate-700","hover:bg-slate-600","text-white","font-semibold","rounded-lg","transition",3,"click"],[1,"w-16","h-16","bg-green-500/20","rounded-full","flex","items-center","justify-center","mx-auto","mb-6"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","text-green-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-sm","text-slate-500","mb-2"],[1,"text-xs","text-lime-400","mb-6"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-3","bg-lime-500","hover:bg-lime-600","text-slate-900","font-semibold","rounded-lg","transition",3,"click"],[1,"flex-1","px-4","py-3","bg-slate-700","hover:bg-slate-600","text-white","font-semibold","rounded-lg","transition",3,"click"],[1,"font-mono","text-lime-400"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1),v(2,T,7,1)(3,L,9,1)(4,D,15,2),o()()),e&2&&(d(2),b(a.isLoading()?2:a.error()?3:4))},dependencies:[w],encapsulation:2})};export{k as PaymentSuccessComponent};
